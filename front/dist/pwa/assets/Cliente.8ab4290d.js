import{M as w,O as a,Y as m,R as o,Q as i,ax as M,_ as g,ay as E,az as b,S as c,aA as r,U as y,J as _,P as u,V as Q,T as s,W as j,Z as V,aC as q,b0 as L,b1 as B}from"./index.998bd65e.js";import{d as p,e as U,a as I,C as v}from"./ClosePopup.41fa9c67.js";import{Q as R}from"./QList.919ae4d2.js";import{Q as A,a as S,b as G}from"./QTable.c4638605.js";import{a as D,Q as h}from"./QSelect.16d28045.js";import{Q as N}from"./QPage.369d1f0c.js";import{Q as Z}from"./QPageSticky.21b5b08b.js";import{Q as T,a as O}from"./QForm.b755ba32.js";import{h as F}from"./moment.40bc58bf.js";import{i as Y,v as W,u as J}from"./vue-leaflet.es.2ac3fde6.js";import{_ as H}from"./plugin-vue_export-helper.21dcd24c.js";import"./QBtnGroup.455d75be.js";import"./QMarkupTable.f774539a.js";import"./_commonjsHelpers.dffb1198.js";const K={name:"clientes",components:{LMap:Y,LTileLayer:W,LMarker:J},data(){return{dialogGlobal:!1,filter:"",columns:[{name:"actions",label:"Acciones",align:"center"},{name:"tipo_cliente",label:"Tipo cliente",align:"left",field:"tipo_cliente"},{name:"nombre_cliente",label:"Nombre",align:"left",field:"nombre_cliente"},{name:"telefono_1",label:"Telefono",align:"left",field:"telefono_1"},{name:"telefono_2",label:"Telefono 2",align:"left",field:"telefono_2"},{name:"direccion",label:"Direccion",align:"left",field:"direccion"},{name:"complemento",label:"Complemento",align:"left",field:"complemento"},{name:"ubicacion",label:"Ubicacion",align:"left",field:"ubicacion"},{name:"zona",label:"Zona",align:"left",field:"zona"},{name:"ejecutivo",label:"Ejecutivo",align:"left",field:"ejecutivo"},{name:"region",label:"Region",align:"left",field:"region"},{name:"cumple",label:"Cumplea\xF1os",align:"left",field:"cumple"},{name:"estado",label:"Estado",align:"left",field:"estado"}],tileProviders:[{name:"Mapa",visible:!0,url:"https://mt1.google.com/vt/lyrs=r&x={x}&y={y}&z={z}",attribution:"&copy; Google Maps"},{name:"Satelite",visible:!1,url:"https://mt1.google.com/vt/lyrs=s&x={x}&y={y}&z={z}",attribution:"&copy; Google Maps"}],location:[-17.969753,-67.114749],zoom:15,propietarioBtnBool:!0,encargadoBtnBool:!0,clientes:[],cliente:{region_id:null},zonass:{zona_id:null},ejecutivoss:{ejecutivo_id:null},regions:[],dialog:!1,loading:!1}},mounted(){this.getClientes(),this.getZonas(),this.getEjecutivos(),this.getRegions()},methods:{showGlobal(){this.dialogGlobal=!0},getZonas(){this.loading=!0,this.$axios.get("zonas").then(n=>{this.zonas=n.data.map(t=>({id:t.id,nombre_zona:t.nombre_zona}))}).catch(n=>{console.error("Error al obtener las zonas:",n),this.$q.notify({color:"negative",message:"Error al obtener las zonas. Intenta nuevamente.",icon:"report_problem"})}).finally(()=>{this.loading=!1})},getRegions(){this.$axios.get("/regions").then(n=>{this.regions=n.data}).catch(n=>{console.error("Error al cargar las regiones:",n),this.$q.notify({color:"negative",message:"No se pudo cargar las regiones."})})},getEjecutivos(){this.loading=!0,this.$axios.get("ejecutivos").then(n=>{this.ejecutivos=n.data.map(t=>({id:t.id,apodo:t.apodo}))}).catch(n=>{console.error("Error al obtener los ejecutivos:",n),this.$q.notify({color:"negative",message:"Error al obtener los ejecutivos. Intenta nuevamente.",icon:"report_problem"})}).finally(()=>{this.loading=!1})},showCliente(n){this.cliente=n,this.dialog=!0;const t=n.ubicacion.split(",").map(Number);console.log(t),this.location=t},onMarkerMoveEnd(n){const f=n.target.getLatLng();this.location=[f.lat,f.lng],this.cliente.ubicacion=`${f.lat.toFixed(7)}, ${f.lng.toFixed(7)}`},myLocation(){navigator.geolocation&&navigator.geolocation.getCurrentPosition(n=>{this.location=[n.coords.latitude,n.coords.longitude],this.cliente.ubicacion=`${n.coords.latitude}, ${n.coords.longitude}`})},submit(){this.loading=!0,this.$axios.post("clientes",this.cliente).then(n=>{this.clientes.unshift(n.data),this.dialog=!1}).catch(n=>{console.log(n)}).finally(()=>{this.loading=!1})},dialogClick(){this.dialog=!0,this.cliente={tipo_cliente:"",nombre_cliente:"",telefono_1:"",telefono_2:"",direccion:"",complemento:"",ubicacion:"-17.969753, -67.114749",zona:"",region:"",cumple:F().format("YYYY-MM-DD"),estado:"ACTIVO"}},getClientes(){this.$axios.get("clientes").then(n=>{this.clientes=n.data}).catch(n=>{console.log(n)})}},computed:{esMovil(){return this.$q.screen.lt.md}}},X=n=>(L("data-v-33c2c1ec"),n=n(),B(),n),P={class:"text-h6"},$={class:"row"},ee={class:"col-12"},le={class:"col-12"},oe={class:"col-12"},te={class:"col-12"},ne={class:"col-12"},ie={class:"col-12"},se={class:"col-12"},ae={class:"col-12"},re={style:{height:"250px",width:"100%"}},ue={class:"col-12"},de={class:"col-12"},ce={class:"col-12"},me={class:"col-12"},pe={class:"col-12"},fe={key:1,class:"row"},ge={class:"col-5"},be={style:{height:"150px",width:"100%"}},_e=X(()=>s("div",{class:"text-subtitle2"}," Vista de clientes ",-1)),ve={style:{height:"500px",width:"100%"}};function he(n,t,f,ye,l,d){const C=w("l-tile-layer"),k=w("l-marker"),z=w("l-map");return a(),m(g,null,[o(N,{class:"bg-grey-3 q-pa-xs"},{default:i(()=>[o(E,null,{default:i(()=>[o(b,{class:"q-pa-xs"},{default:i(()=>[o(A,{rows:l.clientes,columns:l.columns,dense:"","wrap-cells":"",flat:"",bordered:"","rows-per-page-options":[0],title:"Clientes",filter:l.filter},{"top-right":i(()=>[o(c,{color:"primary",label:"Mapa",onClick:d.showGlobal,outline:"","no-caps":"",icon:"public",loading:l.loading},null,8,["onClick","loading"]),o(r,{modelValue:l.filter,"onUpdate:modelValue":t[0]||(t[0]=e=>l.filter=e),label:"Buscar",dense:"",outlined:""},{append:i(()=>[o(y,{name:"search"})]),_:1},8,["modelValue"])]),"body-cell-actions":i(e=>[o(S,{props:e},{default:i(()=>[o(G,{label:"Opciones","no-caps":"",size:"10px",dense:"",color:"primary"},{default:i(()=>[o(R,null,{default:i(()=>[_((a(),u(I,{clickable:"",onClick:x=>n.userEdit(e.row)},{default:i(()=>[o(p,{avatar:""},{default:i(()=>[o(y,{name:"edit"})]),_:1}),o(p,null,{default:i(()=>[o(U,null,{default:i(()=>[Q("Editar")]),_:1})]),_:1})]),_:2},1032,["onClick"])),[[v]]),_((a(),u(I,{clickable:"",onClick:x=>n.userDelete(e.row.id)},{default:i(()=>[o(p,{avatar:""},{default:i(()=>[o(y,{name:"delete"})]),_:1}),o(p,null,{default:i(()=>[o(U,null,{default:i(()=>[Q("Eliminar")]),_:1})]),_:1})]),_:2},1032,["onClick"])),[[v]]),_((a(),u(I,{clickable:"",onClick:x=>n.userEditPassword(e.row)},{default:i(()=>[o(p,{avatar:""},{default:i(()=>[o(y,{name:"edit"})]),_:1}),o(p,null,{default:i(()=>[o(U,null,{default:i(()=>[Q("Cambiar contrase\xF1a")]),_:1})]),_:1})]),_:2},1032,["onClick"])),[[v]])]),_:2},1024)]),_:2},1024)]),_:2},1032,["props"])]),"body-cell-role":i(e=>[o(S,{props:e},{default:i(()=>[o(D,{label:e.row.role,color:e.row.role==="Administrador"?"primary":e.row.role==="Gerente"?"info":"positive","text-color":"white",dense:"",size:"14px"},null,8,["label","color"])]),_:2},1032,["props"])]),_:1},8,["rows","columns","filter"])]),_:1})]),_:1})]),_:1}),o(Z,{position:"bottom-right",class:"text-bold",offset:[18,18]},{default:i(()=>[o(c,{fab:"",icon:"add",color:"primary",onClick:d.dialogClick},null,8,["onClick"])]),_:1}),o(M,{modelValue:l.dialog,"onUpdate:modelValue":t[19]||(t[19]=e=>l.dialog=e),position:d.esMovil?void 0:"right",maximized:!0,"transition-show":"slide-left","transition-hide":"slide-right"},{default:i(()=>[o(E,{style:{width:"450px","max-width":"100vw"}},{default:i(()=>[o(b,{class:"row items-center q-px-md bg-primary text-white q-px-none"},{default:i(()=>[_(o(c,{flat:"",round:"",dense:"",icon:"fa-solid fa-arrow-left"},null,512),[[v]]),o(T),s("div",P,j(l.cliente.id?"Editar":"Nuevo")+" cliente",1)]),_:1}),o(b,null,{default:i(()=>[l.cliente.id?(a(),m("div",fe,[s("div",ge,[s("div",be,[o(z,{ref:"map",zoom:l.zoom,"onUpdate:zoom":t[18]||(t[18]=e=>l.zoom=e),"use-global-leaflet":!1,center:l.location,scrollWheelZoom:!1,dragging:!1,touchZoom:!1,doubleClickZoom:!1,boxZoom:!1,keyboard:!1},{default:i(()=>[(a(!0),m(g,null,V(l.tileProviders,e=>(a(),u(C,{key:e.name,name:e.name,visible:e.visible,url:e.url,attribution:e.attribution,"layer-type":"base"},null,8,["name","visible","url","attribution"]))),128)),o(k,{"lat-lng":l.location,ref:"marker"},null,8,["lat-lng"])]),_:1},8,["zoom","center"])])])])):(a(),u(O,{key:0,onSubmit:d.submit},{default:i(()=>[s("div",$,[s("div",ee,[o(h,{dense:"",modelValue:l.cliente.tipo_cliente,"onUpdate:modelValue":t[1]||(t[1]=e=>l.cliente.tipo_cliente=e),options:["FERRETERIA","OBRA","EMPRESA CONSTRUCTORA"],outlined:"",rules:[e=>!!e||"Este campo es requerido"],label:"Tipo"},null,8,["modelValue","rules"])]),s("div",le,[o(r,{dense:"",modelValue:l.cliente.nombre_cliente,"onUpdate:modelValue":t[2]||(t[2]=e=>l.cliente.nombre_cliente=e),outlined:"",label:"Cliente",rules:[e=>!!e||"Este campo es requerido"],onInput:t[3]||(t[3]=e=>l.cliente.nombre_cliente=l.cliente.nombre_cliente.toUpperCase()),style:{"text-transform":"uppercase"}},null,8,["modelValue","rules"])]),s("div",oe,[o(r,{dense:"",modelValue:l.cliente.telefono_1,"onUpdate:modelValue":t[4]||(t[4]=e=>l.cliente.telefono_1=e),outlined:"",label:"Telefono cliente",type:"number",rules:[e=>!!e||"Este campo es requerido"]},null,8,["modelValue","rules"])]),s("div",te,[o(r,{dense:"",modelValue:l.cliente.telefono_2,"onUpdate:modelValue":t[5]||(t[5]=e=>l.cliente.telefono_2=e),outlined:"",label:"Telefono cliente 2",type:"number"},null,8,["modelValue"])]),s("div",ne,[o(r,{dense:"",modelValue:l.cliente.direccion,"onUpdate:modelValue":t[6]||(t[6]=e=>l.cliente.direccion=e),outlined:"",label:"Direcci\xF3n",rules:[e=>!!e||"Este campo es requerido"],onInput:t[7]||(t[7]=e=>l.cliente.direccion=l.cliente.direccion.toUpperCase()),style:{"text-transform":"uppercase"}},null,8,["modelValue","rules"])]),s("div",ie,[o(r,{dense:"",modelValue:l.cliente.complemento,"onUpdate:modelValue":t[8]||(t[8]=e=>l.cliente.complemento=e),outlined:"",label:"Complemento",onInput:t[9]||(t[9]=e=>l.cliente.complemento=l.cliente.complemento.toUpperCase()),style:{"text-transform":"uppercase"}},null,8,["modelValue"])]),s("div",se,[o(r,{dense:"",modelValue:l.cliente.ubicacion,"onUpdate:modelValue":t[10]||(t[10]=e=>l.cliente.ubicacion=e),outlined:"",label:"Ubicacion"},{append:i(()=>[o(c,{flat:"",icon:"fa-solid fa-map-marker-alt",onClick:d.myLocation},null,8,["onClick"])]),_:1},8,["modelValue"])]),s("div",ae,[s("div",re,[o(z,{ref:"map",zoom:l.zoom,"onUpdate:zoom":t[11]||(t[11]=e=>l.zoom=e),"use-global-leaflet":!1,center:l.location},{default:i(()=>[(a(!0),m(g,null,V(l.tileProviders,e=>(a(),u(C,{key:e.name,name:e.name,visible:e.visible,url:e.url,attribution:e.attribution,"layer-type":"base"},null,8,["name","visible","url","attribution"]))),128)),o(k,{"lat-lng":l.location,onMoveend:d.onMarkerMoveEnd,ref:"marker",draggable:!0},null,8,["lat-lng","onMoveend"])]),_:1},8,["zoom","center"])])]),s("div",ue,[o(h,{dense:"",modelValue:l.zonass.zona_id,"onUpdate:modelValue":t[12]||(t[12]=e=>l.zonass.zona_id=e),options:n.zonas,"option-label":"nombre_zona","option-value":"id",outlined:"",rules:[e=>!!e||"Este campo es requerido"],label:"Seleccionar Zona"},null,8,["modelValue","options","rules"])]),s("div",de,[o(h,{dense:"",modelValue:l.ejecutivoss.ejecutivo_id,"onUpdate:modelValue":t[13]||(t[13]=e=>l.ejecutivoss.ejecutivo_id=e),options:n.ejecutivos,"option-label":"apodo","option-value":"id",outlined:"",label:"Seleccionar Ejecutivo",rules:[e=>!!e||"Este campo es requerido"]},null,8,["modelValue","options","rules"])]),s("div",ce,[o(h,{dense:"",modelValue:l.cliente.region_id,"onUpdate:modelValue":t[14]||(t[14]=e=>l.cliente.region_id=e),options:l.regions,"option-value":"id","option-label":"nombre_region",outlined:"",label:"Regi\xF3n",rules:[e=>!!e||"Seleccione una regi\xF3n"]},null,8,["modelValue","options","rules"])]),s("div",me,[o(r,{dense:"",modelValue:l.cliente.cumple,"onUpdate:modelValue":t[15]||(t[15]=e=>l.cliente.cumple=e),outlined:"",label:"Cumplea\xF1os",type:"date"},null,8,["modelValue"])]),s("div",pe,[o(h,{dense:"",modelValue:l.cliente.estado,"onUpdate:modelValue":t[16]||(t[16]=e=>l.cliente.estado=e),options:["ACTIVO","INACTIVO"],outlined:"",rules:[e=>!!e||"Este campo es requerido"],label:"Estado"},null,8,["modelValue","rules"])]),o(q,{align:"right"},{default:i(()=>[o(c,{label:"Cancelar",color:"negative",onClick:t[17]||(t[17]=e=>l.dialog=!1),loading:l.loading},null,8,["loading"]),o(c,{label:"Guardar",color:"primary",type:"submit",loading:l.loading},null,8,["loading"])]),_:1})])]),_:1},8,["onSubmit"]))]),_:1})]),_:1})]),_:1},8,["modelValue","position"]),o(M,{modelValue:l.dialogGlobal,"onUpdate:modelValue":t[21]||(t[21]=e=>l.dialogGlobal=e)},{default:i(()=>[o(E,{style:{width:"650px","max-width":"650px"}},{default:i(()=>[o(b,{class:"q-pa-md row items-center"},{default:i(()=>[_e,o(T),_(o(c,{flat:"",round:"",dense:"",icon:"close"},null,512),[[v]])]),_:1}),o(b,null,{default:i(()=>[s("div",ve,[o(z,{ref:"map",zoom:l.zoom,"onUpdate:zoom":t[20]||(t[20]=e=>l.zoom=e),"use-global-leaflet":!1,center:l.location},{default:i(()=>[(a(!0),m(g,null,V(l.tileProviders,e=>(a(),u(C,{key:e.name,name:e.name,visible:e.visible,url:e.url,attribution:e.attribution,"layer-type":"base"},null,8,["name","visible","url","attribution"]))),128)),(a(!0),m(g,null,V(l.clientes,e=>(a(),u(k,{key:e.id,"lat-lng":[parseFloat(e.lat),parseFloat(e.lng)],onClick:x=>d.showCliente(e)},null,8,["lat-lng","onClick"]))),128))]),_:1},8,["zoom","center"])])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64)}var qe=H(K,[["render",he],["__scopeId","data-v-33c2c1ec"]]);export{qe as default};
