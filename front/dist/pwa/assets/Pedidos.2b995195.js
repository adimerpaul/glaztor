import{R as u,$ as m,U as l,T as i,aD as U,a1 as v,aC as P,aA as b,W as d,aB as s,V as h,S as E,Y as p,aE as y,a0 as k,M as _,Z as n,X as g,aF as w}from"./index.14a741ef.js";import{d as x,e as V,a as F,C as D}from"./ClosePopup.b46939d4.js";import{Q as N,a as T}from"./QSelect.2c61fcd1.js";import{Q as z}from"./QList.7da70530.js";import{Q as I}from"./QPage.45f73780.js";import{Q as A,a as S}from"./QForm.52148441.js";import{Q as M}from"./QMarkupTable.c9a1407f.js";import{h as Q}from"./moment.40bc58bf.js";import{E as Y}from"./Excel.a5e16faf.js";import{_ as q}from"./plugin-vue_export-helper.21dcd24c.js";import"./_commonjsHelpers.a26ce4be.js";const B={name:"Pedidos",data(){return{loading:!1,dialog:!1,clientes:[],fechaInicio:Q().format("YYYY-MM-DD"),fechaFin:Q().format("YYYY-MM-DD"),zonas:[],pedidos:[],productos:[],pedido:{producto_id:null}}},mounted(){this.getZonas(),this.getPedidos(),this.getClientes(),this.getProductos()},methods:{exportExcel(){let t=[{sheet:"Pedidos",columns:[{label:"Fecha",value:"fecha"},{label:"Cliente",value:"cliente"},{label:"Producto",value:"producto"},{label:"Factura",value:"factura"},{label:"Nombre Factura",value:"nombre_factura"},{label:"Nit Factura",value:"nit_factura"},{label:"Direccion",value:"direccion"},{label:"Contacto",value:"contacto"},{label:"Telefono",value:"telefono"},{label:"Telefono2",value:"telefono2"},{label:"Observacion",value:"observacion"},{label:"Chofer",value:"chofer"},{label:"Zona",value:"zona"},{label:"Total",value:"total"},{label:"Estado",value:"estado"},{label:"Fecha Pago",value:"fecha_pago"},{label:"User",value:"user_id"},{label:"Cliente",value:"cliente_id"},{label:"Estado Credito",value:"estadoCredito"},{label:"Total Pagado",value:"totalPagado"}],content:this.pedidos}];Y.export(t,"Reporte de Pedidos")},getZonas(){this.$axios.get("zonas").then(t=>{this.zonas=t.data}).catch(t=>{console.log(t)})},showPreventa(t){this.pedido={...t},this.dialog=!0},submit(){this.loading=!0,this.$axios.put("pedidos/"+this.pedido.id,this.pedido).then(t=>{this.dialog=!1,this.$alert.success("Pedido actualizado correctamente"),this.getPedidos()}).catch(t=>{console.log(t),this.$alert.error("Error al actualizar el pedido")}).finally(()=>{this.loading=!1})},getProductos(){this.$axios.get("productos").then(t=>{this.productos=t.data}).catch(t=>{console.log(t)})},getClientes(){this.$axios.get("clientes").then(t=>{this.clientes=t.data}).catch(t=>{console.log(t)})},addPedido(){this.$router.push({name:"pedidosPage"})},getPedidos(){this.loading=!0,this.$axios.get("pedidos",{params:{fechaInicio:this.fechaInicio,fechaFin:this.fechaFin}}).then(t=>{this.pedidos=t.data,this.loading=!1}).catch(t=>{console.log(t),this.loading=!1})}},computed:{esMovil(){return this.$q.screen.lt.md}}},O={class:"row"},R={class:"col-6 col-md-3"},L={class:"col-6 col-md-3"},Z={class:"col-6 col-md-3 text-left"},G={class:"col-6 col-md-3 text-right"},W={class:"text-h6"},X={class:"text-bold q-pa-xs"},j=d("label",null,"Total",-1),H=d("thead",null,[d("tr",null,[d("th",null,"Producto"),d("th",null,"Cantidad"),d("th",null,"Precio"),d("th",null,"Subtotal")])],-1),J=["onUpdate:modelValue"],K=["onUpdate:modelValue"],$=d("td",{colspan:"3",class:"text-right"},"Total",-1),ee={class:"text-bold"},le={key:0},oe={colspan:"4"};function te(t,a,ae,de,o,c){return u(),m(v,null,[l(I,{class:"bg-grey-3 q-pa-xs"},{default:i(()=>[l(P,null,{default:i(()=>[l(b,{class:"q-pa-xs"},{default:i(()=>[d("div",O,[d("div",R,[l(s,{outlined:"",modelValue:o.fechaInicio,"onUpdate:modelValue":a[0]||(a[0]=e=>o.fechaInicio=e),label:"Fecha Inicio",type:"date",color:"white",dense:""},null,8,["modelValue"])]),d("div",L,[l(s,{outlined:"",modelValue:o.fechaFin,"onUpdate:modelValue":a[1]||(a[1]=e=>o.fechaFin=e),label:"Fecha Fin",type:"date",color:"white",dense:""},null,8,["modelValue"])]),d("div",Z,[l(h,{icon:"search",color:"primary",label:"Buscar",onClick:c.getPedidos,loading:o.loading,"no-caps":""},null,8,["onClick","loading"])]),d("div",G,[l(h,{icon:"get_app",color:"green",label:"Excel",onClick:c.exportExcel,loading:o.loading,"no-caps":""},null,8,["onClick","loading"]),l(h,{icon:"add_circle_outline",color:"green",label:"Nuevo Pedido",onClick:c.addPedido,loading:o.loading,"no-caps":""},null,8,["onClick","loading"])])])]),_:1})]),_:1}),l(b,{class:"q-pa-none"},{default:i(()=>[l(z,{dense:"",class:"rounded-borders"},{default:i(()=>[o.pedidos.length===0?(u(),E(F,{key:0},{default:i(()=>[l(x,null,{default:i(()=>[l(V,{class:"text-h6 text-grey"},{default:i(()=>[p("No hay pedidos")]),_:1})]),_:1})]),_:1})):y("",!0),(u(!0),m(v,null,k(o.pedidos,e=>(u(),E(F,{key:e.id,onClick:r=>c.showPreventa(e),clickable:"",class:"q-my-sm bg-white hover-bg-light-blue",style:{border:"1px solid #e0e0e0","border-radius":"8px"}},{default:i(()=>[l(x,null,{default:i(()=>[l(V,{class:"text-h6"},{default:i(()=>[p(n(e.fecha.substring(0,10)||"Sin propietario")+" ",1),l(g,{name:"check_circle",color:e.estado==="PENDIENTE"?"red":e.estado==="ENTREGADO"?"green":"orange"},null,8,["color"])]),_:2},1024),l(V,{class:"text-subtitle1 text-grey"},{default:i(()=>[p(n(e.direccion)+" ",1),l(T,null,{default:i(()=>[p(n(e.total),1)]),_:2},1024)]),_:2},1024),l(V,{class:"text-caption text-positive"},{default:i(()=>{var r;return[p(n(e.cliente)+" - "+n(e.tipo_construccion)+" - "+n((r=e.user)==null?void 0:r.name)+" - "+n(e.fecha),1)]}),_:2},1024)]),_:2},1024),l(x,{side:""},{default:i(()=>[l(g,{name:"arrow_forward"})]),_:1})]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1})]),_:1}),l(U,{modelValue:o.dialog,"onUpdate:modelValue":a[13]||(a[13]=e=>o.dialog=e),position:c.esMovil?void 0:"right",maximized:!0,"transition-show":"slide-left","transition-hide":"slide-right"},{default:i(()=>[l(P,{style:{width:"450px","max-width":"100vw"}},{default:i(()=>[l(b,{class:"row items-center q-px-md bg-primary text-white q-px-none"},{default:i(()=>[_(l(h,{flat:"",round:"",dense:"",icon:"fa-solid fa-arrow-left"},null,512),[[D]]),l(A),d("div",W,n(o.pedido.id?"Editar":"Nuevo")+" Pedido",1)]),_:1}),l(b,null,{default:i(()=>[l(S,{onSubmit:c.submit,disable:t.$store.user.role!=="Administrador"},{default:i(()=>[l(s,{modelValue:o.pedido.fecha,"onUpdate:modelValue":a[2]||(a[2]=e=>o.pedido.fecha=e),label:"Fecha",outlined:"",disable:t.$store.user.role!=="Administrador",dense:"",type:"date"},null,8,["modelValue","disable"]),l(s,{modelValue:o.pedido.cliente,"onUpdate:modelValue":a[3]||(a[3]=e=>o.pedido.cliente=e),label:"Cliente",outlined:"",dense:""},null,8,["modelValue"]),l(s,{modelValue:o.pedido.nombre_factura,"onUpdate:modelValue":a[4]||(a[4]=e=>o.pedido.nombre_factura=e),label:"Nombre Factura",outlined:"",dense:""},null,8,["modelValue"]),l(s,{modelValue:o.pedido.nit_factura,"onUpdate:modelValue":a[5]||(a[5]=e=>o.pedido.nit_factura=e),label:"Nit Factura",outlined:"",dense:""},null,8,["modelValue"]),l(s,{modelValue:o.pedido.direccion,"onUpdate:modelValue":a[6]||(a[6]=e=>o.pedido.direccion=e),label:"Direccion",outlined:"",dense:""},null,8,["modelValue"]),l(s,{modelValue:o.pedido.contacto,"onUpdate:modelValue":a[7]||(a[7]=e=>o.pedido.contacto=e),label:"Contacto",outlined:"",dense:""},null,8,["modelValue"]),l(s,{modelValue:o.pedido.telefono,"onUpdate:modelValue":a[8]||(a[8]=e=>o.pedido.telefono=e),label:"Telefono",outlined:"",dense:""},null,8,["modelValue"]),l(s,{type:"textarea",modelValue:o.pedido.observacion,"onUpdate:modelValue":a[9]||(a[9]=e=>o.pedido.observacion=e),label:"Observacion",outlined:"",dense:""},null,8,["modelValue"]),l(s,{modelValue:o.pedido.chofer,"onUpdate:modelValue":a[10]||(a[10]=e=>o.pedido.chofer=e),label:"chofer",outlined:"",dense:""},null,8,["modelValue"]),l(N,{modelValue:o.pedido.zona,"onUpdate:modelValue":a[11]||(a[11]=e=>o.pedido.zona=e),label:"zonas",outlined:"",disable:t.$store.user.role!=="Administrador",dense:"",options:o.zonas,"emit-value":"","map-options":"","option-label":"nombre_zona","option-value":"nombre_zona"},null,8,["modelValue","disable","options"]),l(N,{modelValue:o.pedido.estado,"onUpdate:modelValue":a[12]||(a[12]=e=>o.pedido.estado=e),label:"Estado",outlined:"",disable:t.$store.user.role!=="Administrador",dense:"",options:["PENDIENTE","ENTREGADO","ANULADO"]},{after:i(()=>[l(g,{name:"check_circle",color:o.pedido.estado==="PENDIENTE"?"red":o.pedido.estado==="ENTREGADO"?"green":"orange"},null,8,["color"])]),_:1},8,["modelValue","disable"]),d("div",X,[j,d("div",null,n(o.pedido.total),1)]),l(M,{dense:"",flat:"",bordered:"","wrap-cells":""},{default:i(()=>[H,d("tbody",null,[(u(!0),m(v,null,k(o.pedido.detalles,e=>{var r,C;return u(),m("tr",{key:e.id},[d("td",null,[l(g,{name:"delete",onClick:f=>t.sales.splice(t.sales.indexOf(e),1),class:"cursor-pointer",color:"red"},null,8,["onClick"]),p(" "+n((r=e.producto)==null?void 0:r.nombre_pro)+" "+n((C=e.producto)==null?void 0:C.marca_pro),1)]),d("td",null,[_(d("input",{"onUpdate:modelValue":f=>e.cantidad=f,type:"number",style:{width:"50px"},step:"0.01"},null,8,J),[[w,e.cantidad]])]),d("td",null,[_(d("input",{"onUpdate:modelValue":f=>e.precio=f,type:"number",style:{width:"70px"},step:"0.01"},null,8,K),[[w,e.precio]])]),d("td",null,n((e.cantidad*e.precio).toFixed(2)),1)])}),128))]),d("tfoot",null,[d("tr",null,[$,d("td",ee,n(o.pedido.detalles.reduce((e,r)=>e+r.cantidad*r.precio,0).toFixed(2)),1)]),t.$store.user.role==="Administrador"?(u(),m("tr",le,[d("td",oe,[l(h,{"no-caps":"",class:"full-width",color:"blue",loading:o.loading,type:"submit",label:"Actulizar pedido"},null,8,["loading"])])])):y("",!0)])]),_:1})]),_:1},8,["onSubmit","disable"])]),_:1})]),_:1})]),_:1},8,["modelValue","position"])],64)}var ge=q(B,[["render",te]]);export{ge as default};
