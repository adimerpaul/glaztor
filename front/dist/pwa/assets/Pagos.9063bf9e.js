import{R as u,$ as m,U as o,T as s,aD as V,a1 as b,aC as _,aA as g,W as t,aB as h,V as p,S as x,Y as c,aE as E,a0 as w,M as D,Z as d,X as y}from"./index.14a741ef.js";import{d as v,e as f,a as F,C as I}from"./ClosePopup.b46939d4.js";import{Q as N,a as k}from"./QSelect.2c61fcd1.js";import{Q as T}from"./QList.7da70530.js";import{Q as q}from"./QPage.45f73780.js";import{Q as P,a as Q}from"./QForm.52148441.js";import{Q as z}from"./QMarkupTable.c9a1407f.js";import{h as C}from"./moment.40bc58bf.js";import{E as S}from"./Excel.a5e16faf.js";import{_ as Y}from"./plugin-vue_export-helper.21dcd24c.js";import"./_commonjsHelpers.a26ce4be.js";const U={name:"Pedidos",data(){return{loading:!1,dialog:!1,clientes:[],fechaInicio:C().startOf("month").format("YYYY-MM-DD"),fechaFin:C().endOf("month").format("YYYY-MM-DD"),zonas:[],pedidos:[],productos:[],pedido:{producto_id:null},dialogPagos:!1,pago:{monto:"",forma_pago:"EFECTIVO",numero_recibo:"",banco:""}}},mounted(){this.getZonas(),this.getPedidos(),this.getClientes(),this.getProductos()},methods:{exportExcel(){let l=[{sheet:"Pedidos",columns:[{label:"Fecha",value:"fecha"},{label:"Cliente",value:"cliente"},{label:"Producto",value:"producto"},{label:"Factura",value:"factura"},{label:"Nombre Factura",value:"nombre_factura"},{label:"Nit Factura",value:"nit_factura"},{label:"Direccion",value:"direccion"},{label:"Contacto",value:"contacto"},{label:"Telefono",value:"telefono"},{label:"Telefono2",value:"telefono2"},{label:"Observacion",value:"observacion"},{label:"Chofer",value:"chofer"},{label:"Zona",value:"zona"},{label:"Total",value:"total"},{label:"Estado",value:"estado"},{label:"Fecha Pago",value:"fecha_pago"},{label:"User",value:"user_id"},{label:"Cliente",value:"cliente_id"},{label:"Estado Credito",value:"estadoCredito"},{label:"Total Pagado",value:"totalPagado"},{label:"Pagos",value:"pagosRealizados"}],content:this.pedidos}];S.export(l,"Reporte de Pedidos")},showPago(l){this.$store.user.role==="Cobranza"&&(this.dialogPagos=!0,this.pago={...l})},updatePago(l){console.log(l),this.$axios.put("pagos/"+l.id,l).then(i=>{this.$alert.success("Pago actualizado correctamente"),this.getPedidos(),this.dialogPagos=!1,this.dialog=!1}).catch(i=>{console.log(i),this.$alert.error("Error al actualizar el pago")}).finally(()=>{this.loading=!1})},submitPago(){if(this.loading=!0,this.pago.id){this.updatePago(this.pago);return}this.$axios.post("pagos",{...this.pago,pedido_id:this.pedido.id}).then(l=>{this.dialogPagos=!1,this.$alert.success("Pago agregado correctamente"),this.pedido.pagos.push(l.data),this.getPedidos()}).catch(l=>{console.log(l),this.$alert.error("Error al agregar el pago")}).finally(()=>{this.loading=!1})},clickDialogPago(){this.dialogPagos=!0,this.pago={monto:"",forma_pago:"EFECTIVO",numero_recibo:"",banco:"",fecha_pago:C().format("YYYY-MM-DD")}},getZonas(){this.$axios.get("zonas").then(l=>{this.zonas=l.data}).catch(l=>{console.log(l)})},showPreventa(l){this.pedido={...l},this.dialog=!0},submit(){this.loading=!0,this.$axios.put("pedidos/"+this.pedido.id,this.pedido).then(l=>{this.dialog=!1,this.$alert.success("Pedido actualizado correctamente"),this.getPedidos()}).catch(l=>{console.log(l),this.$alert.error("Error al actualizar el pedido")}).finally(()=>{this.loading=!1})},getProductos(){this.$axios.get("productos").then(l=>{this.productos=l.data}).catch(l=>{console.log(l)})},getClientes(){this.$axios.get("clientes").then(l=>{this.clientes=l.data}).catch(l=>{console.log(l)})},addPedido(){this.$router.push({name:"pedidosPage"})},getPedidos(){this.loading=!0,this.$axios.get("pedidosEntregados",{params:{fechaInicio:this.fechaInicio,fechaFin:this.fechaFin}}).then(l=>{this.pedidos=l.data,this.loading=!1}).catch(l=>{console.log(l),this.loading=!1})}},computed:{esMovil(){return this.$q.screen.lt.md}}},M={class:"row"},B={class:"col-6 col-md-3"},R={class:"col-6 col-md-3"},A={class:"col-6 col-md-2 text-left"},O={class:"col-6 col-md-4 text-right"},Z={class:"text-h6"},L={class:"text-bold row items-center"},G={class:"text-bold q-pa-xs"},H=t("label",null,"Total",-1),W=t("thead",null,[t("tr",null,[t("th",null,"Fecha"),t("th",null,"Numero de Recibo"),t("th",null,"Banco"),t("th",null,"Subtotal")])],-1),X=["onClick"],j={class:"text-right"},J={colspan:"2"},K={class:"text-bold text-red"},$=t("td",{class:"text-right"},"Total",-1),ee={class:"text-bold text-right"},oe={class:"text-h6"};function le(l,i,ae,te,a,n){return u(),m(b,null,[o(q,{class:"bg-grey-3 q-pa-xs"},{default:s(()=>[o(_,null,{default:s(()=>[o(g,{class:"q-pa-xs"},{default:s(()=>[t("div",M,[t("div",B,[o(h,{outlined:"",modelValue:a.fechaInicio,"onUpdate:modelValue":i[0]||(i[0]=e=>a.fechaInicio=e),label:"Fecha Inicio",type:"date",color:"white",dense:""},null,8,["modelValue"])]),t("div",R,[o(h,{outlined:"",modelValue:a.fechaFin,"onUpdate:modelValue":i[1]||(i[1]=e=>a.fechaFin=e),label:"Fecha Fin",type:"date",color:"white",dense:""},null,8,["modelValue"])]),t("div",A,[o(p,{icon:"search",color:"primary",label:"Buscar",onClick:n.getPedidos,loading:a.loading,"no-caps":""},null,8,["onClick","loading"])]),t("div",O,[o(p,{icon:"download",color:"green",label:"Exportar",onClick:n.exportExcel,"no-caps":""},null,8,["onClick"])])])]),_:1})]),_:1}),o(g,{class:"q-pa-none"},{default:s(()=>[o(T,{dense:"",class:"rounded-borders"},{default:s(()=>[a.pedidos.length===0?(u(),x(F,{key:0},{default:s(()=>[o(v,null,{default:s(()=>[o(f,{class:"text-h6 text-grey"},{default:s(()=>[c("No hay pedidos")]),_:1})]),_:1})]),_:1})):E("",!0),(u(!0),m(b,null,w(a.pedidos,e=>(u(),x(F,{key:e.id,onClick:r=>n.showPreventa(e),clickable:"",class:"q-my-sm bg-white hover-bg-light-blue",style:{border:"1px solid #e0e0e0","border-radius":"8px"}},{default:s(()=>[o(v,null,{default:s(()=>[o(f,{class:"text-h6"},{default:s(()=>[c(d(e.fecha.substring(0,10)||"Sin propietario")+" ",1),o(y,{name:"check_circle",color:e.estado==="PENDIENTE"?"red":e.estado==="ENTREGADO"?"green":"orange"},null,8,["color"])]),_:2},1024),o(f,{class:"text-subtitle1 text-grey"},{default:s(()=>[c(d(e.direccion)+" ",1),o(k,null,{default:s(()=>[c(d(e.total),1)]),_:2},1024),o(k,{color:e.totalPagado>=e.total?"positive":"negative"},{default:s(()=>[c(d(e.totalPagado),1)]),_:2},1032,["color"])]),_:2},1024),o(f,{class:"text-caption text-positive"},{default:s(()=>{var r;return[c(d(e.cliente)+" - "+d(e.tipo_construccion)+" - "+d((r=e.user)==null?void 0:r.name)+" - "+d(e.fecha),1)]}),_:2},1024)]),_:2},1024),o(v,{side:""},{default:s(()=>[o(y,{name:"arrow_forward"})]),_:1})]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1})]),_:1}),o(V,{modelValue:a.dialog,"onUpdate:modelValue":i[2]||(i[2]=e=>a.dialog=e),position:n.esMovil?void 0:"right",maximized:!0,"transition-show":"slide-left","transition-hide":"slide-right"},{default:s(()=>[o(_,{style:{width:"450px","max-width":"100vw"}},{default:s(()=>[o(g,{class:"row items-center q-px-md bg-primary text-white q-px-none"},{default:s(()=>[D(o(p,{flat:"",round:"",dense:"",icon:"fa-solid fa-arrow-left"},null,512),[[I]]),o(P),t("div",Z,d(a.pedido.id?"Editar":"Nuevo")+" Pedido",1)]),_:1}),o(g,null,{default:s(()=>[o(Q,{onSubmit:n.submit},{default:s(()=>[t("div",L,[t("div",null,"Pagos de "+d(a.pedido.cliente),1),o(P),l.$store.user.role==="Cobranza"?(u(),x(p,{key:0,size:"11px",icon:"add_circle_outline",color:"green",dense:"",label:"Agregar Pago",onClick:n.clickDialogPago,"no-caps":""},null,8,["onClick"])):E("",!0)]),t("div",G,[H,t("div",null,d(a.pedido.total),1)]),o(z,{dense:"",flat:"",bordered:"","wrap-cells":""},{default:s(()=>[W,t("tbody",null,[(u(!0),m(b,null,w(a.pedido.pagos,e=>(u(),m("tr",{key:e.id,onClick:r=>n.showPago(e)},[t("td",null,d(e.fecha_pago)+" "+d(e.hora_pago),1),t("td",null,d(e.numero_recibo),1),t("td",null,d(e.banco),1),t("td",j,d(e.monto),1)],8,X))),128))]),t("tfoot",null,[t("tr",null,[t("td",J,[c(" Deuda "),t("span",K,d((a.pedido.total-a.pedido.pagos.reduce((e,r)=>e+parseFloat(r.monto),0)).toFixed(2)),1)]),$,t("td",ee,d(a.pedido.pagos.reduce((e,r)=>e+parseFloat(r.monto),0).toFixed(2)),1)])])]),_:1})]),_:1},8,["onSubmit"])]),_:1})]),_:1})]),_:1},8,["modelValue","position"]),o(V,{modelValue:a.dialogPagos,"onUpdate:modelValue":i[9]||(i[9]=e=>a.dialogPagos=e)},{default:s(()=>[o(_,{style:{width:"450px","max-width":"100vw"}},{default:s(()=>[o(g,{class:"row items-center q-px-md bg-primary text-white q-px-none"},{default:s(()=>[o(p,{flat:"",round:"",dense:"",icon:"fa-solid fa-arrow-left",onClick:i[3]||(i[3]=e=>a.dialogPagos=!1)}),o(P),t("div",oe,d(a.pago.id?"Editar":"Nuevo")+" Pago ",1)]),_:1}),o(g,null,{default:s(()=>[o(Q,{onSubmit:n.submitPago},{default:s(()=>[o(h,{modelValue:a.pago.fecha_pago,"onUpdate:modelValue":i[4]||(i[4]=e=>a.pago.fecha_pago=e),outlined:"",label:"Fecha de Pago",type:"date",rules:[e=>!!e||"Campo requerido"],dense:""},null,8,["modelValue","rules"]),o(h,{modelValue:a.pago.monto,"onUpdate:modelValue":i[5]||(i[5]=e=>a.pago.monto=e),outlined:"",label:"Monto",type:"number",rules:[e=>!!e||"Campo requerido"],dense:""},null,8,["modelValue","rules"]),o(N,{modelValue:a.pago.forma_pago,"onUpdate:modelValue":i[6]||(i[6]=e=>a.pago.forma_pago=e),outlined:"",label:"Forma de Pago",dense:"",options:["EFECTIVO","TRANSFERENCIA","CHEQUE"],rules:[e=>!!e||"Campo requerido"]},null,8,["modelValue","rules"]),o(h,{modelValue:a.pago.numero_recibo,"onUpdate:modelValue":i[7]||(i[7]=e=>a.pago.numero_recibo=e),outlined:"",label:"N\xFAmero de Recibo",rules:[e=>!!e||"Campo requerido"],dense:""},null,8,["modelValue","rules"]),o(h,{modelValue:a.pago.banco,"onUpdate:modelValue":i[8]||(i[8]=e=>a.pago.banco=e),outlined:"",label:"Banco",dense:"",hint:""},null,8,["modelValue"]),o(p,{type:"submit",class:"full-width",label:a.pago.id?"Actualizar":"Agregar",color:a.pago.id?"primary":"green",loading:a.loading,"no-caps":""},null,8,["label","color","loading"])]),_:1},8,["onSubmit"])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64)}var fe=Y(U,[["render",le]]);export{fe as default};
