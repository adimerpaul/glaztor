import{M as y,O as r,Y as p,R as l,Q as n,ax as U,_ as m,ay as Q,az as g,X as S,P as _,V as b,aB as V,Z as k,S as d,J as L,T as t,W as i,aA as u,aC as q,U as E}from"./index.350bfa02.js";import{d as h,e as f,a as P,C as T}from"./ClosePopup.ffc4827d.js";import{Q as N}from"./QList.e9d1609d.js";import{Q as I}from"./QPage.6ae6b1a7.js";import{Q as D,a as C}from"./QSelect.7b5a54de.js";import{Q as w,a as O}from"./QForm.fd24acbe.js";import{h as F}from"./moment.40bc58bf.js";import{i as Z,v as G,u as Y}from"./vue-leaflet.es.bfc6341e.js";import{_ as R}from"./plugin-vue_export-helper.21dcd24c.js";const A={name:"Preventa",components:{LMap:Z,LTileLayer:G,LMarker:Y},data(){return{tileProviders:[{name:"Mapa",visible:!0,url:"https://mt1.google.com/vt/lyrs=r&x={x}&y={y}&z={z}",attribution:"&copy; Google Maps"},{name:"Satelite",visible:!1,url:"https://mt1.google.com/vt/lyrs=s&x={x}&y={y}&z={z}",attribution:"&copy; Google Maps"}],location:[-17.969753,-67.114749],zoom:15,propietarioBtnBool:!0,encargadoBtnBool:!0,preventas:[],preventa:{},dialog:!1,loading:!1}},mounted(){this.getPreventas()},methods:{onMapClick(a){this.location=[a.latlng.lat,a.latlng.lng],this.preventa.ubicacion=`${a.latlng.lat.toFixed(7)}, ${a.latlng.lng.toFixed(7)}`},openGoogleMaps(){const[a,s]=this.preventa.ubicacion.split(",").map(Number);window.open(`https://www.google.com/maps/search/?api=1&query=${a},${s}`)},deletePreventa(a){this.$alert.dialog("\xBFDesea eliminar la preventa?").onOk(()=>{this.$axios.delete(`preventas/${a.id}`).then(()=>{this.preventas=this.preventas.filter(s=>s.id!==a.id),this.dialog=!1}).catch(s=>{console.log(s)})})},showPreventa(a){this.preventa=a,this.dialog=!0;const s=a.ubicacion.split(",").map(Number);console.log(s),this.location=s},onMarkerMoveEnd(a){const v=a.target.getLatLng();this.location=[v.lat,v.lng],this.preventa.ubicacion=`${v.lat.toFixed(7)}, ${v.lng.toFixed(7)}`},myLocation(){navigator.geolocation&&navigator.geolocation.getCurrentPosition(a=>{this.location=[a.coords.latitude,a.coords.longitude],this.preventa.ubicacion=`${a.coords.latitude}, ${a.coords.longitude}`})},submit(){this.loading=!0,this.$axios.post("preventas",this.preventa).then(a=>{this.preventas.unshift(a.data),this.dialog=!1}).catch(a=>{console.log(a)}).finally(()=>{this.loading=!1})},dialogClick(){this.dialog=!0,this.preventa={fecha:F().format("YYYY-MM-DD"),propietario:"",contratista:"",telefono_propietario:"",telefono_contratista:"",ubicacion:"-17.969753, -67.114749",zona:"",observacion:"",tipo_construccion:"",volumen:"",marca:"",direccion:""}},getPreventas(){this.$axios.get("preventas").then(a=>{this.preventas=a.data}).catch(a=>{console.log(a)})}},computed:{esMovil(){return this.$q.screen.lt.md}}},W=t("div",{class:"text-h5 text-primary"},"Lista de Preventas",-1),J=t("div",{class:"text-body2 text-grey-8"},"Selecciona una preventa para m\xE1s detalles",-1),X={class:"text-h6"},j={class:"row"},H={class:"col-12"},K={class:"col-6 q-pa-xs"},$={class:"col-6 q-pa-xs"},ee={class:"col-12"},oe={class:"col-12"},te={class:"col-12"},le={class:"col-12"},se={class:"col-12"},ae={class:"col-12"},ne={style:{height:"250px",width:"100%"}},ie={class:"col-12"},re={class:"col-12"},ce={class:"col-12"},de={class:"col-12"},ue={class:"col-12"},pe={class:"col-12"},me={key:1,class:"row"},ve={class:"col-12 row items-center"},_e=t("label",{class:"text-grey text-caption"},"Fecha:",-1),ge={class:"text-bold"},be={class:"div"},he={class:"col-6"},fe=t("label",{class:"text-grey text-caption"},"Propietario:",-1),xe={class:"text-bold"},ye={class:"col-6"},Ve=t("label",{class:"text-grey text-caption"},"Contratista:",-1),ke={class:"text-bold"},Ce={class:"col-6"},we=t("label",{class:"text-grey text-caption"},"Tel\xE9fono Propietario:",-1),Be={class:"text-bold"},ze={class:"col-6"},Me=t("label",{class:"text-grey text-caption"},"Tel\xE9fono Contratista:",-1),Qe={class:"text-bold"},Ee={class:"col-12 row items-center"},Pe=t("label",{class:"text-grey text-caption"},"Ubicaci\xF3n:",-1),Ue={class:"text-bold"},Se={class:"div"},Le={class:"col-12"},qe={style:{height:"250px",width:"100%"}},Te={class:"col-12"},Ne=t("label",{class:"text-grey text-caption"},"Direcci\xF3n:",-1),Ie={class:"text-bold"},De={class:"col-6"},Oe=t("label",{class:"text-grey text-caption"},"Zona:",-1),Fe={class:"text-bold"},Ze={class:"col-6"},Ge=t("label",{class:"text-grey text-caption"},"Observaci\xF3n:",-1),Ye={class:"text-bold"},Re={class:"col-6"},Ae=t("label",{class:"text-grey text-caption"},"Tipo Construcci\xF3n:",-1),We={class:"text-bold"},Je={class:"col-6"},Xe=t("label",{class:"text-grey text-caption"},"Volumen:",-1),je={class:"text-bold"},He={class:"col-6"},Ke=t("label",{class:"text-grey text-caption"},"Marca:",-1),$e={class:"text-bold"};function eo(a,s,v,oo,e,c){const B=y("l-tile-layer"),z=y("l-marker"),M=y("l-map");return r(),p(m,null,[l(I,{class:"bg-grey-2 q-pa-md"},{default:n(()=>[l(Q,{flat:"",bordered:"",class:"q-pa-md"},{default:n(()=>[l(g,null,{default:n(()=>[W,J]),_:1}),l(S,{spaced:""}),l(g,{class:"q-pa-none"},{default:n(()=>[l(N,{dense:"",class:"rounded-borders"},{default:n(()=>[e.preventas.length===0?(r(),_(P,{key:0},{default:n(()=>[l(h,null,{default:n(()=>[l(f,{class:"text-h6 text-grey"},{default:n(()=>[b("No hay preventas")]),_:1})]),_:1})]),_:1})):V("",!0),(r(!0),p(m,null,k(e.preventas,o=>(r(),_(P,{key:o.id,onClick:x=>c.showPreventa(o),clickable:"",class:"q-my-sm bg-white hover-bg-light-blue",style:{border:"1px solid #e0e0e0","border-radius":"8px"}},{default:n(()=>[l(h,{avatar:""},{default:n(()=>[l(E,{name:"home",color:"grey",size:"md"})]),_:1}),l(h,null,{default:n(()=>[l(f,{class:"text-h6"},{default:n(()=>[b(i(o.propietario||"Sin propietario")+" "+i(o.telefono_propietario?`(${o.telefono_propietario})`:""),1)]),_:2},1024),l(f,{class:"text-subtitle1 text-grey"},{default:n(()=>[b(i(o.direccion),1)]),_:2},1024),l(f,{class:"text-caption text-positive"},{default:n(()=>{var x;return[b(i(o.zona)+" - "+i(o.tipo_construccion)+" - "+i((x=o.user)==null?void 0:x.name)+" - "+i(o.fecha),1)]}),_:2},1024)]),_:2},1024),l(h,{side:""},{default:n(()=>[l(E,{name:"arrow_forward"})]),_:1})]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1})]),_:1})]),_:1}),l(D,{position:"bottom-right",class:"text-bold",offset:[18,18]},{default:n(()=>[l(d,{fab:"",icon:"add",color:"primary",onClick:c.dialogClick},null,8,["onClick"])]),_:1}),l(U,{modelValue:e.dialog,"onUpdate:modelValue":s[18]||(s[18]=o=>e.dialog=o),position:c.esMovil?void 0:"right",maximized:!0,"transition-show":"slide-left","transition-hide":"slide-right"},{default:n(()=>[l(Q,{style:{width:"450px","max-width":"100vw"}},{default:n(()=>[l(g,{class:"row items-center q-px-md bg-primary text-white q-px-none"},{default:n(()=>[L(l(d,{flat:"",round:"",dense:"",icon:"fa-solid fa-arrow-left"},null,512),[[T]]),l(w),t("div",X,i(e.preventa.id?"Editar":"Nueva")+" preventa",1)]),_:1}),l(g,null,{default:n(()=>[e.preventa.id?(r(),p("div",me,[t("div",ve,[t("div",null,[_e,t("div",ge,i(e.preventa.fecha),1)]),l(w),t("div",be,[l(d,{icon:"delete",color:"negative",onClick:s[16]||(s[16]=o=>c.deletePreventa(e.preventa)),dense:"",flat:""})])]),t("div",he,[fe,t("div",xe,i(e.preventa.propietario),1)]),t("div",ye,[Ve,t("div",ke,i(e.preventa.contratista),1)]),t("div",Ce,[we,t("div",Be,i(e.preventa.telefono_propietario),1)]),t("div",ze,[Me,t("div",Qe,i(e.preventa.telefono_contratista),1)]),t("div",Ee,[t("div",null,[Pe,t("div",Ue,i(e.preventa.ubicacion),1)]),l(w),t("div",Se,[l(d,{icon:"my_location",color:"primary",onClick:c.openGoogleMaps,dense:"",flat:""},null,8,["onClick"])])]),t("div",Le,[t("div",qe,[l(M,{ref:"map",zoom:e.zoom,"onUpdate:zoom":s[17]||(s[17]=o=>e.zoom=o),"use-global-leaflet":!1,center:e.location,scrollWheelZoom:!1,dragging:!1,touchZoom:!1,doubleClickZoom:!1,boxZoom:!1,keyboard:!1},{default:n(()=>[(r(!0),p(m,null,k(e.tileProviders,o=>(r(),_(B,{key:o.name,name:o.name,visible:o.visible,url:o.url,attribution:o.attribution,"layer-type":"base"},null,8,["name","visible","url","attribution"]))),128)),l(z,{"lat-lng":e.location,ref:"marker"},null,8,["lat-lng"])]),_:1},8,["zoom","center"])])]),t("div",Te,[Ne,t("div",Ie,i(e.preventa.direccion),1)]),t("div",De,[Oe,t("div",Fe,i(e.preventa.zona),1)]),t("div",Ze,[Ge,t("div",Ye,i(e.preventa.observacion),1)]),t("div",Re,[Ae,t("div",We,i(e.preventa.tipo_construccion),1)]),t("div",Je,[Xe,t("div",je,i(e.preventa.volumen),1)]),t("div",He,[Ke,t("div",$e,i(e.preventa.marca),1)])])):(r(),_(O,{key:0,onSubmit:c.submit},{default:n(()=>[t("div",j,[t("div",H,[l(u,{dense:"",modelValue:e.preventa.fecha,"onUpdate:modelValue":s[0]||(s[0]=o=>e.preventa.fecha=o),outlined:"",label:"Fecha",type:"date",disable:!0},null,8,["modelValue"])]),t("div",K,[l(d,{label:"Propietario",outline:e.propietarioBtnBool,class:"full-width","no-caps":"",color:"primary",onClick:s[1]||(s[1]=o=>e.propietarioBtnBool=!e.propietarioBtnBool)},null,8,["outline"])]),t("div",$,[l(d,{label:"Encargado",outline:e.encargadoBtnBool,class:"full-width","no-caps":"",color:"primary",onClick:s[2]||(s[2]=o=>e.encargadoBtnBool=!e.encargadoBtnBool)},null,8,["outline"])]),e.propietarioBtnBool?V("",!0):(r(),p(m,{key:0},[t("div",ee,[l(u,{dense:"",modelValue:e.preventa.propietario,"onUpdate:modelValue":s[3]||(s[3]=o=>e.preventa.propietario=o),outlined:"",label:"Propietario",rules:[o=>!!o||"Este campo es requerido"]},null,8,["modelValue","rules"])]),t("div",oe,[l(u,{dense:"",modelValue:e.preventa.telefono_propietario,"onUpdate:modelValue":s[4]||(s[4]=o=>e.preventa.telefono_propietario=o),outlined:"",label:"Telefono Propietario",type:"number"},null,8,["modelValue"])])],64)),e.encargadoBtnBool?V("",!0):(r(),p(m,{key:1},[t("div",te,[l(u,{dense:"",modelValue:e.preventa.contratista,"onUpdate:modelValue":s[5]||(s[5]=o=>e.preventa.contratista=o),outlined:"",label:"Encargado"},null,8,["modelValue"])]),t("div",le,[l(u,{dense:"",modelValue:e.preventa.telefono_contratista,"onUpdate:modelValue":s[6]||(s[6]=o=>e.preventa.telefono_contratista=o),outlined:"",label:"Telefono Encargado",type:"number"},null,8,["modelValue"])])],64)),t("div",se,[l(u,{dense:"",modelValue:e.preventa.ubicacion,"onUpdate:modelValue":s[7]||(s[7]=o=>e.preventa.ubicacion=o),outlined:"",label:"Ubicacion"},{append:n(()=>[l(d,{flat:"",icon:"fa-solid fa-map-marker-alt",onClick:c.myLocation},null,8,["onClick"])]),_:1},8,["modelValue"])]),t("div",ae,[t("div",ne,[l(M,{ref:"map",zoom:e.zoom,"onUpdate:zoom":s[8]||(s[8]=o=>e.zoom=o),"use-global-leaflet":!1,center:e.location,onClick:c.onMapClick},{default:n(()=>[(r(!0),p(m,null,k(e.tileProviders,o=>(r(),_(B,{key:o.name,name:o.name,visible:o.visible,url:o.url,attribution:o.attribution,"layer-type":"base"},null,8,["name","visible","url","attribution"]))),128)),l(z,{"lat-lng":e.location,onMoveend:c.onMarkerMoveEnd,ref:"marker",draggable:!0},null,8,["lat-lng","onMoveend"])]),_:1},8,["zoom","center","onClick"])])]),t("div",ie,[l(u,{dense:"",modelValue:e.preventa.direccion,"onUpdate:modelValue":s[9]||(s[9]=o=>e.preventa.direccion=o),outlined:"",label:"Direccion",rules:[o=>!!o||"Este campo es requerido"]},null,8,["modelValue","rules"])]),t("div",re,[l(C,{dense:"",modelValue:e.preventa.zona,"onUpdate:modelValue":s[10]||(s[10]=o=>e.preventa.zona=o),options:["NORTE","ESTE","SUD","OESTE","CENTRO"],outlined:"",rules:[o=>!!o||"Este campo es requerido"],label:"Zona"},null,8,["modelValue","rules"])]),t("div",ce,[l(C,{dense:"",modelValue:e.preventa.tipo_construccion,"onUpdate:modelValue":s[11]||(s[11]=o=>e.preventa.tipo_construccion=o),outlined:"",label:"Estado de la Obra",options:["Inicio Obra","Columnas","Muralla","Zapata","Sobrecimiento","Losa","Paralizada","Concluida"]},null,8,["modelValue"])]),t("div",de,[l(u,{dense:"",modelValue:e.preventa.volumen,"onUpdate:modelValue":s[12]||(s[12]=o=>e.preventa.volumen=o),outlined:"",label:"Volumen",type:"number"},null,8,["modelValue"])]),t("div",ue,[l(C,{dense:"",modelValue:e.preventa.marca,"onUpdate:modelValue":s[13]||(s[13]=o=>e.preventa.marca=o),outlined:"",label:"Marca",options:["Ecebol","Coboce","Camba","Emisa IP-30","Emisa IP-40","Viacha IP30","Viacha IP40","Viacha P30","Ninguna"]},null,8,["modelValue"])]),t("div",pe,[l(u,{dense:"",modelValue:e.preventa.observacion,"onUpdate:modelValue":s[14]||(s[14]=o=>e.preventa.observacion=o),outlined:"",label:"Observacion"},null,8,["modelValue"])]),l(q,{align:"right"},{default:n(()=>[l(d,{label:"Cancelar",color:"negative",onClick:s[15]||(s[15]=o=>e.dialog=!1),loading:e.loading},null,8,["loading"]),l(d,{label:"Guardar",color:"primary",type:"submit",loading:e.loading},null,8,["loading"])]),_:1})])]),_:1},8,["onSubmit"]))]),_:1})]),_:1})]),_:1},8,["modelValue","position"])],64)}var po=R(A,[["render",eo]]);export{po as default};
