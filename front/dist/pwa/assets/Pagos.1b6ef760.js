import{R as g,$ as _,U as a,T as i,aD as G,a1 as x,aC as V,aA as p,W as r,aB as d,X as C,V as f,S as F,Y as h,aE as W,a0 as X,M as $,Z as n}from"./index.8bd998ce.js";import{d as E,e as v,a as j}from"./format.3ef389eb.js";import{Q as ee,a as J}from"./QSelect.c8fcec14.js";import{Q as oe}from"./QList.1bc64209.js";import{Q as ae}from"./QPage.f0d189ce.js";import{Q as w}from"./QSpace.444d7c09.js";import{Q as le}from"./QMarkupTable.c2c12e36.js";import{Q as K}from"./QForm.8105f686.js";import{C as te}from"./ClosePopup.4ff5eb22.js";import{h as P}from"./moment.40bc58bf.js";import{E as se}from"./Excel.2696a291.js";import{_ as re}from"./plugin-vue_export-helper.21dcd24c.js";import"./index.a93ba69a.js";import"./_commonjsHelpers.a26ce4be.js";const ie={name:"Pedidos",data(){return{loading:!1,dialog:!1,clientes:[],fechaInicio:P().startOf("month").format("YYYY-MM-DD"),fechaFin:P().endOf("month").format("YYYY-MM-DD"),zonas:[],pedidos:[],pedidosAll:[],productos:[],filter:"",pedido:{producto_id:null},dialogPagos:!1,pago:{monto:"",forma_pago:"EFECTIVO",numero_recibo:"",banco:""}}},mounted(){this.getZonas(),this.getPedidos(),this.getClientes(),this.getProductos()},methods:{exportExcel(){let t=[];this.pedidos.forEach(o=>{o.detalles.forEach(m=>{var l,u,e,c,b,y,k,Q,N,D,z,Y,I,R,q,S,M,T,U,A,B,O,Z,H,L;t.push({created_at:P(o.created_at).format("YYYY-MM-DD HH:mm:ss"),fecha:o.fecha,cliente:o.cliente,producto:m.producto.nombre_pro,cantidad:m.cantidad,precio:m.precio,subtotal:m.cantidad*m.precio,factura:o.factura,nombre_factura:o.nombre_factura,nit_factura:o.nit_factura,direccion:o.direccion,contacto:o.contacto,telefono:o.telefono,telefono2:o.telefono2,observacion:o.observacion,chofer:o.chofer,zona:o.zona,totalPagado:o.totalPagado,pagos:o.pagos.length,estado:o.estado,fecha_pago:o.fecha_pago,user:(l=o.user)==null?void 0:l.name,total:o.total,pago1:(u=o.pagos[0])==null?void 0:u.monto,pago2:(e=o.pagos[1])==null?void 0:e.monto,pago3:(c=o.pagos[2])==null?void 0:c.monto,pago4:(b=o.pagos[3])==null?void 0:b.monto,pago5:(y=o.pagos[4])==null?void 0:y.monto,pago6:(k=o.pagos[5])==null?void 0:k.monto,pago7:(Q=o.pagos[6])==null?void 0:Q.monto,pago8:(N=o.pagos[7])==null?void 0:N.monto,numero_recibo1:(D=o.pagos[0])==null?void 0:D.numero_recibo,numero_recibo2:(z=o.pagos[1])==null?void 0:z.numero_recibo,numero_recibo3:(Y=o.pagos[2])==null?void 0:Y.numero_recibo,numero_recibo4:(I=o.pagos[3])==null?void 0:I.numero_recibo,numero_recibo5:(R=o.pagos[4])==null?void 0:R.numero_recibo,numero_recibo6:(q=o.pagos[5])==null?void 0:q.numero_recibo,numero_recibo7:(S=o.pagos[6])==null?void 0:S.numero_recibo,numero_recibo8:(M=o.pagos[7])==null?void 0:M.numero_recibo,fecha_pago1:(T=o.pagos[0])==null?void 0:T.fecha_pago,fecha_pago2:(U=o.pagos[1])==null?void 0:U.fecha_pago,fecha_pago3:(A=o.pagos[2])==null?void 0:A.fecha_pago,fecha_pago4:(B=o.pagos[3])==null?void 0:B.fecha_pago,fecha_pago5:(O=o.pagos[4])==null?void 0:O.fecha_pago,fecha_pago6:(Z=o.pagos[5])==null?void 0:Z.fecha_pago,fecha_pago7:(H=o.pagos[6])==null?void 0:H.fecha_pago,fecha_pago8:(L=o.pagos[7])==null?void 0:L.fecha_pago})})});let s=[{sheet:"Cobranza",columns:[{label:"Fecha del pedido",value:"created_at"},{label:"Fecha de Entrega",value:"fecha"},{label:"Cliente",value:"cliente"},{label:"Producto",value:"producto"},{label:"Cantidad",value:"cantidad"},{label:"Precio",value:"precio"},{label:"Direccion",value:"direccion"},{label:"Observacion",value:"observacion"},{label:"Zona",value:"zona"},{label:"Total",value:"total"},{label:"Estado",value:"estado"},{label:"Fecha Pago",value:"fecha_pago"},{label:"User",value:"user"},{label:"Pago 1",value:"pago1"},{label:"Numero Recibo 1",value:"numero_recibo1"},{label:"Fecha Pago 1",value:"fecha_pago1"},{label:"Pago 2",value:"pago2"},{label:"Numero Recibo 2",value:"numero_recibo2"},{label:"Fecha Pago 2",value:"fecha_pago2"},{label:"Pago 3",value:"pago3"},{label:"Numero Recibo 3",value:"numero_recibo3"},{label:"Fecha Pago 3",value:"fecha_pago3"},{label:"Pago 4",value:"pago4"},{label:"Numero Recibo 4",value:"numero_recibo4"},{label:"Fecha Pago 4",value:"fecha_pago4"},{label:"Pago 5",value:"pago5"},{label:"Numero Recibo 5",value:"numero_recibo5"},{label:"Fecha Pago 5",value:"fecha_pago5"},{label:"Pago 6",value:"pago6"},{label:"Numero Recibo 6",value:"numero_recibo6"},{label:"Fecha Pago 6",value:"fecha_pago6"},{label:"Pago 7",value:"pago7"},{label:"Numero Recibo 7",value:"numero_recibo7"},{label:"Fecha Pago 7",value:"fecha_pago7"},{label:"Pago 8",value:"pago8"},{label:"Numero Recibo 8",value:"numero_recibo8"},{label:"Fecha Pago 8",value:"fecha_pago8"},{label:"Total Pagado",value:"totalPagado"},{label:"Pagos",value:"pagos"}],content:t}];se.export(s,"Reporte de Cobranzas")},showPago(t){const s=this.$store.user;s.role==="Administrador"||s.role==="Ventas"||s.role==="Cobranza"||s.role==="Director"||s.role==="Supervisor"||(this.dialogPagos=!0,this.pago={...t})},updatePago(t){console.log(t),this.$axios.put("pagos/"+t.id,t).then(s=>{this.$alert.success("Pago actualizado correctamente"),this.getPedidos(),this.dialogPagos=!1,this.dialog=!1}).catch(s=>{console.log(s),this.$alert.error("Error al actualizar el pago")}).finally(()=>{this.loading=!1})},submitPago(){if(this.loading=!0,this.pago.id){this.updatePago(this.pago);return}this.$axios.post("pagos",{...this.pago,pedido_id:this.pedido.id}).then(t=>{this.dialogPagos=!1,this.$alert.success("Pago agregado correctamente"),this.pedido.pagos.push(t.data),this.getPedidos()}).catch(t=>{console.log(t),this.$alert.error("Error al agregar el pago")}).finally(()=>{this.loading=!1})},clickDialogPago(){this.dialogPagos=!0,this.pago={monto:"",forma_pago:"EFECTIVO",numero_recibo:"",banco:"",fecha_pago:P().format("YYYY-MM-DD")}},getZonas(){this.$axios.get("zonas").then(t=>{this.zonas=t.data}).catch(t=>{console.log(t)})},showPreventa(t){this.pedido={...t},this.dialog=!0},submit(){this.loading=!0,this.$axios.put("pedidos/"+this.pedido.id,this.pedido).then(t=>{this.dialog=!1,this.$alert.success("Pedido actualizado correctamente"),this.getPedidos()}).catch(t=>{console.log(t),this.$alert.error("Error al actualizar el pedido")}).finally(()=>{this.loading=!1})},getProductos(){this.$axios.get("productos").then(t=>{this.productos=t.data}).catch(t=>{console.log(t)})},getClientes(){this.$axios.get("clientes").then(t=>{this.clientes=t.data}).catch(t=>{console.log(t)})},addPedido(){this.$router.push({name:"pedidosPage"})},getPedidos(){this.loading=!0,this.$axios.get("pedidosEntregados",{params:{fechaInicio:this.fechaInicio,fechaFin:this.fechaFin,filter:this.filter}}).then(t=>{this.pedidos=t.data,this.pedidosAll=t.data,this.loading=!1}).catch(t=>{console.log(t),this.loading=!1})}},computed:{esMovil(){return this.$q.screen.lt.md}}},ne={class:"row"},ce={class:"col-6 col-md-3"},ue={class:"col-6 col-md-3"},ge={class:"col-6 col-md-2 text-right"},de={class:"col-6 col-md-2 text-left"},he={class:"col-6 col-md-2 text-right"},me={class:"text-h6"},pe={class:"text-bold row items-center"},fe={class:"text-bold q-pa-xs"},be=r("label",null,"Total",-1),_e=r("thead",null,[r("tr",null,[r("th",null,"Fecha"),r("th",null,"Numero de Recibo"),r("th",null,"Banco"),r("th",null,"Subtotal")])],-1),ve=["onClick"],Pe={class:"text-right"},xe={colspan:"2"},Ve={class:"text-bold text-red"},Ce=r("td",{class:"text-right"},"Total",-1),Fe={class:"text-bold text-right"},Ee={class:"text-h6"};function we(t,s,o,m,l,u){return g(),_(x,null,[a(ae,{class:"bg-grey-3 q-pa-xs"},{default:i(()=>[a(V,null,{default:i(()=>[a(p,{class:"q-pa-xs"},{default:i(()=>[r("div",ne,[r("div",ce,[a(d,{outlined:"",modelValue:l.fechaInicio,"onUpdate:modelValue":s[0]||(s[0]=e=>l.fechaInicio=e),label:"Fecha Inicio",type:"date",color:"white",dense:""},null,8,["modelValue"])]),r("div",ue,[a(d,{outlined:"",modelValue:l.fechaFin,"onUpdate:modelValue":s[1]||(s[1]=e=>l.fechaFin=e),label:"Fecha Fin",type:"date",color:"white",dense:""},null,8,["modelValue"])]),r("div",ge,[a(d,{modelValue:l.filter,"onUpdate:modelValue":s[2]||(s[2]=e=>l.filter=e),outlined:"",label:"Buscar",dense:""},{prepend:i(()=>[a(C,{name:"search"})]),_:1},8,["modelValue"])]),r("div",de,[a(f,{icon:"search",color:"primary",label:"Buscar",onClick:u.getPedidos,loading:l.loading,"no-caps":""},null,8,["onClick","loading"])]),r("div",he,[a(f,{icon:"download",color:"green",label:"Exportar",onClick:u.exportExcel,"no-caps":""},null,8,["onClick"])])])]),_:1})]),_:1}),a(p,{class:"q-pa-none"},{default:i(()=>[a(oe,{dense:"",class:"rounded-borders"},{default:i(()=>[l.pedidos.length===0?(g(),F(j,{key:0},{default:i(()=>[a(E,null,{default:i(()=>[a(v,{class:"text-h6 text-grey"},{default:i(()=>[h("No hay pedidos")]),_:1})]),_:1})]),_:1})):W("",!0),(g(!0),_(x,null,X(l.pedidos,e=>(g(),F(j,{key:e.id,onClick:c=>u.showPreventa(e),clickable:"",class:"q-my-sm bg-white hover-bg-light-blue",style:{border:"1px solid #e0e0e0","border-radius":"8px"}},{default:i(()=>[a(E,null,{default:i(()=>[a(v,{class:"text-h6"},{default:i(()=>[h(n(e.fecha.substring(0,10)||"Sin propietario")+" ",1),a(C,{name:"check_circle",color:e.estado==="PENDIENTE"?"red":e.estado==="ENTREGADO"?"green":"orange"},null,8,["color"])]),_:2},1024),a(v,{class:"text-subtitle1 text-grey"},{default:i(()=>[h(n(e.direccion)+" ",1),a(J,null,{default:i(()=>[h(n(e.total),1)]),_:2},1024),a(J,{color:e.totalPagado>=e.total?"positive":"negative",class:"text-white"},{default:i(()=>[h(n((e.total-e.pagos.reduce((c,b)=>c+parseFloat(b.monto),0)).toFixed(2)),1)]),_:2},1032,["color"])]),_:2},1024),a(v,{class:"text-caption text-positive"},{default:i(()=>{var c;return[h(n(e.cliente)+" - "+n(e.tipo_construccion)+" - "+n((c=e.user)==null?void 0:c.name)+" - "+n(e.fecha),1)]}),_:2},1024)]),_:2},1024),a(E,{side:""},{default:i(()=>[a(C,{name:"arrow_forward"})]),_:1})]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1})]),_:1}),a(G,{modelValue:l.dialog,"onUpdate:modelValue":s[3]||(s[3]=e=>l.dialog=e),position:u.esMovil?void 0:"right",maximized:!0,"transition-show":"slide-left","transition-hide":"slide-right"},{default:i(()=>[a(V,{style:{width:"450px","max-width":"100vw"}},{default:i(()=>[a(p,{class:"row items-center q-px-md bg-primary text-white q-px-none"},{default:i(()=>[$(a(f,{flat:"",round:"",dense:"",icon:"fa-solid fa-arrow-left"},null,512),[[te]]),a(w),r("div",me,n(l.pedido.id?"Editar":"Nuevo")+" Pedido",1)]),_:1}),a(p,null,{default:i(()=>[a(K,{onSubmit:u.submit},{default:i(()=>[r("div",pe,[r("div",null,"Pagos de "+n(l.pedido.cliente),1),a(w),t.$store.user.role==="Cobranza"||t.$store.user.role==="Admin"?(g(),F(f,{key:0,size:"11px",icon:"add_circle_outline",color:"green",dense:"",label:"Agregar Pago",onClick:u.clickDialogPago,"no-caps":""},null,8,["onClick"])):W("",!0)]),r("div",fe,[be,r("div",null,n(l.pedido.total),1)]),a(le,{dense:"",flat:"",bordered:"","wrap-cells":""},{default:i(()=>[_e,r("tbody",null,[(g(!0),_(x,null,X(l.pedido.pagos,e=>(g(),_("tr",{key:e.id,onClick:c=>u.showPago(e)},[r("td",null,n(e.fecha_pago)+" "+n(e.hora_pago),1),r("td",null,n(e.numero_recibo),1),r("td",null,n(e.banco),1),r("td",Pe,n(e.monto),1)],8,ve))),128))]),r("tfoot",null,[r("tr",null,[r("td",xe,[h(" Deuda "),r("span",Ve,n((l.pedido.total-l.pedido.pagos.reduce((e,c)=>e+parseFloat(c.monto),0)).toFixed(2)),1)]),Ce,r("td",Fe,n(l.pedido.pagos.reduce((e,c)=>e+parseFloat(c.monto),0).toFixed(2)),1)])])]),_:1})]),_:1},8,["onSubmit"])]),_:1})]),_:1})]),_:1},8,["modelValue","position"]),a(G,{modelValue:l.dialogPagos,"onUpdate:modelValue":s[10]||(s[10]=e=>l.dialogPagos=e)},{default:i(()=>[a(V,{style:{width:"450px","max-width":"100vw"}},{default:i(()=>[a(p,{class:"row items-center q-px-md bg-primary text-white q-px-none"},{default:i(()=>[a(f,{flat:"",round:"",dense:"",icon:"fa-solid fa-arrow-left",onClick:s[4]||(s[4]=e=>l.dialogPagos=!1)}),a(w),r("div",Ee,n(l.pago.id?"Editar":"Nuevo")+" Pago ",1)]),_:1}),a(p,null,{default:i(()=>[a(K,{onSubmit:u.submitPago},{default:i(()=>[a(d,{modelValue:l.pago.fecha_pago,"onUpdate:modelValue":s[5]||(s[5]=e=>l.pago.fecha_pago=e),outlined:"",label:"Fecha de Pago",type:"date",rules:[e=>!!e||"Campo requerido"],dense:""},null,8,["modelValue","rules"]),a(d,{modelValue:l.pago.monto,"onUpdate:modelValue":s[6]||(s[6]=e=>l.pago.monto=e),outlined:"",label:"Monto",type:"number",rules:[e=>!!e||"Campo requerido"],dense:""},null,8,["modelValue","rules"]),a(ee,{modelValue:l.pago.forma_pago,"onUpdate:modelValue":s[7]||(s[7]=e=>l.pago.forma_pago=e),outlined:"",label:"Forma de Pago",dense:"",options:["EFECTIVO","TRANSFERENCIA","CHEQUE"],rules:[e=>!!e||"Campo requerido"]},null,8,["modelValue","rules"]),a(d,{modelValue:l.pago.numero_recibo,"onUpdate:modelValue":s[8]||(s[8]=e=>l.pago.numero_recibo=e),outlined:"",label:"N\xFAmero de Recibo",rules:[e=>!!e||"Campo requerido"],dense:""},null,8,["modelValue","rules"]),a(d,{modelValue:l.pago.banco,"onUpdate:modelValue":s[9]||(s[9]=e=>l.pago.banco=e),outlined:"",label:"Banco",dense:"",hint:""},null,8,["modelValue"]),a(f,{type:"submit",class:"full-width",label:l.pago.id?"Actualizar":"Agregar",color:l.pago.id?"primary":"green",loading:l.loading,"no-caps":""},null,8,["label","color","loading"])]),_:1},8,["onSubmit"])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64)}var Ae=re(ie,[["render",we]]);export{Ae as default};
