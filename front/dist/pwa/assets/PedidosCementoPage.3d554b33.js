import{T as s,a1 as r,W as n,V as i,aG as Q,a3 as p,Y as o,aF as g,aD as _,aE as c,$ as C,X as V,a2 as v,_ as m,Z as a,a5 as A,M as x,a4 as z,aH as k}from"./index.8e5efdfb.js";import{Q as B}from"./QImg.2b5ac115.js";import{Q as y}from"./QSelect.7f7f9668.js";import{Q as w}from"./QSpace.1f3d3d67.js";import{Q as P}from"./QMarkupTable.f4b57dd0.js";import{Q as L}from"./QPage.8f9149b4.js";import{Q as T}from"./QForm.4421addc.js";import{C as D}from"./ClosePopup.3be4487d.js";import{h as U}from"./moment.40bc58bf.js";import{_ as q}from"./plugin-vue_export-helper.21dcd24c.js";import"./format.7d90d4c2.js";const F={name:"Pedidos",data(){return{loading:!1,filter:"",clientes:[],clientesAll:[],productoCemento:[],productoCementoAll:[],zonas:[],sales:[],pedido:{},dialogPedido:!1,trailer:"LOCAL"}},mounted(){this.getClientes(),this.getProductos(),this.getZonas()},methods:{openCalculate(t){console.log(t);let l=0;t.tipo_pro==="BA"?l=t.cantidadVenta*t.precioVenta:l=t.cantidadVenta*t.precioVenta*t.producto.tonelada,this.$q.dialog({title:"Calcular",message:"Ingrese el total de toneladas",prompt:{model:l,type:"text"},cancel:!0,persistent:!0}).onOk(b=>{let f=0;t.tipo_pro==="BA"?f=t.cantidadVenta:f=t.cantidadVenta*t.producto.tonelada,t.precioVenta=b/f}).onCancel(()=>{}).onDismiss(()=>{})},getZonas(){this.$axios.get("zonas").then(t=>{this.zonas=t.data}).catch(t=>{console.log(t)})},filterClientes(t,l){if(t===""){l(()=>{this.clientes=this.clientesAll});return}const b=t.toLowerCase();l(()=>{this.clientes=this.clientesAll.filter(f=>f.nombre_cliente.toLowerCase().indexOf(b)>-1)})},submit(){this.loading=!0,this.pedido.trailer=this.trailer,this.$axios.post("pedidosCemento",{...this.pedido,detalles:this.sales.map(t=>({id:t.producto.id,cantidadVenta:t.cantidadVenta,precioVenta:t.precioVenta,tipo_pro:t.tipo_pro}))}).then(t=>{this.$alert.success("Pedido guardado"),this.dialogPedido=!1,this.sales=[],this.$router.push("/pedidoCemento")}).catch(t=>{console.log(t),this.$alert.error(t.response.data.message)}).finally(()=>{this.loading=!1})},dialogPedidoClick(){if(this.sales.length===0)return this.$alert.error("No hay productoCemento en el carrito"),!1;this.dialogPedido=!0,this.pedido={fecha_hora:U().format("YYYY-MM-DD"),nombre_factura:"",nit_factura:"",contacto:"",direccion:"",telefono:"",telefono2:"",fecha_pago:U().format("YYYY-MM-DD"),observacion:""}},changeDirecionTelefono(){const t=this.clientes.find(l=>l.id===this.pedido.cliente_id);this.pedido.direccion=t.direccion,this.pedido.telefono=t.telefono_1,this.pedido.telefono2=t.telefono_2,this.pedido.contacto=t.nombre_cliente},agregarProducto(t){if(parseInt(t.cantidad)===0)return this.$alert.error("Producto sin stock"),!1;this.sales.push({producto:t,cantidadVenta:1,precioVenta:t.precio,tipo_pro:"BA"})},filterProductos(){this.productoCemento=this.productoCementoAll.filter(t=>t.nombre.toLowerCase().includes(this.filter.toLowerCase())||t.marca_pro.toLowerCase().includes(this.filter.toLowerCase()))},getProductos(){this.$axios.get("productosCementoActivo").then(t=>{this.productoCemento=t.data,this.productoCementoAll=t.data}).catch(t=>{console.log(t)})},getClientes(){this.$axios.get("clientes").then(t=>{this.clientes=t.data,this.clientesAll=t.data}).catch(t=>{console.log(t)})}},computed:{esMovil(){return this.$q.screen.lt.md},totalVenta(){let t=0;return this.sales.forEach(l=>{l.tipo_pro==="BA"?t+=l.cantidadVenta*l.precioVenta:t+=l.cantidadVenta*l.precioVenta*l.producto.tonelada}),t}}},S={class:"row"},Y={class:"col-12 col-md-7 q-pa-xs"},M={class:"row"},O={class:"col-12"},I={class:"absolute-bottom",style:{padding:"0",margin:"0"}},N={class:"row items-center",style:{"font-size":"9px"}},R={style:{display:"flex","justify-content":"space-between","font-size":"12px"}},E={class:"col-12 col-md-5 q-pa-xs"},Z={class:"row items-center"},G=o("thead",null,[o("tr",null,[o("th",null,"Producto"),o("th",null,"Cant."),o("th",null,"Cant. Real"),o("th",null,"Precio"),o("th",null,"Subtotal")])],-1),j=["onUpdate:modelValue"],H=["onUpdate:modelValue"],W=o("td",{colspan:"3",class:"text-right text-bold"},"Total",-1),X={class:"text-bold"},J={colspan:"4"},K={class:"row items-center"},$=o("div",{class:"text-h6"},"Realizar pedido",-1),ee={class:"row"},oe={class:"col-12 col-md-6"},te={class:"col-12 col-md-6"},le={class:"col-12 col-md-3"},de={class:"col-12 col-md-3"},ne={class:"col-12 col-md-3"},ie={class:"col-12 col-md-3"},ae={class:"col-12 col-md-4"},se={class:"col-12 col-md-4"},re={class:"col-12 col-md-4"},ce={class:"col-12"},ue={class:"col-12"},pe=o("thead",null,[o("tr",null,[o("th",null,"Producto"),o("th",null,"Cantidad"),o("th",null,"Precio"),o("th",null,"Subtotal")])],-1),me=o("td",{colspan:"3",class:"text-right"},"Total",-1),fe={class:"text-bold"};function he(t,l,b,f,d,u){return s(),r(p,null,[n(L,{class:"bg-grey-3 q-pa-xs"},{default:i(()=>[o("div",S,[o("div",Y,[n(g,{flat:"",bordered:""},{default:i(()=>[n(_,{class:"q-pa-xs"},{default:i(()=>[o("div",M,[o("div",O,[n(c,{modelValue:d.filter,"onUpdate:modelValue":[l[1]||(l[1]=e=>d.filter=e),u.filterProductos],filled:"",standout:"",placeholder:"Buscar producto",dense:"",clearable:""},{prepend:i(()=>[n(C,{name:"search"})]),before:i(()=>[n(V,{flat:"",round:"",dense:"",icon:"arrow_back",onClick:l[0]||(l[0]=e=>this.$router.go(-1))})]),_:1},8,["modelValue","onUpdate:modelValue"])]),(s(!0),r(p,null,v(d.productoCemento,e=>(s(),r("div",{class:"col-4 col-md-3",key:e.id},[n(g,{flat:"",bordered:"",class:"q-ma-xs cursor-pointer",onClick:h=>u.agregarProducto(e)},{default:i(()=>[n(_,{class:"q-pa-none"},{default:i(()=>[n(B,{src:t.$url+".."+e.foto,alt:e.nombre,class:"full-width",style:{height:"130px"}},{default:i(()=>[o("div",I,[o("div",N,[o("div",null,a(e.nombre),1),o("div",null,a(e.marca_pro),1)]),o("div",R,[o("div",null,a(e.precio)+" Bs. ",1),o("div",{class:z("text-bold "+(e.cantidad=="0"?"text-negative":"text-positive"))},a(e.cantidad),3)])])]),_:2},1032,["src","alt"])]),_:2},1024)]),_:2},1032,["onClick"])]))),128))])]),_:1})]),_:1})]),o("div",E,[n(g,{flat:"",bordered:""},{default:i(()=>[n(_,{class:"q-pa-xs"},{default:i(()=>[o("div",Z,[m(" Carrito de compras "),n(y,{modelValue:d.trailer,"onUpdate:modelValue":l[2]||(l[2]=e=>d.trailer=e),outlined:"",dense:"",options:["LOCAL","TRAILER","OTRO"]},null,8,["modelValue"]),n(w),n(V,{dense:"",flat:"",color:"red",icon:"delete",label:"Limpiar",onClick:l[3]||(l[3]=e=>d.sales=[]),"no-caps":""})]),n(P,{dense:"",flat:"",bordered:"","wrap-cells":""},{default:i(()=>[G,o("tbody",null,[(s(!0),r(p,null,v(d.sales,e=>(s(),r("tr",{key:e.producto.id},[o("td",null,[n(C,{name:"delete",onClick:h=>d.sales.splice(d.sales.indexOf(e),1),class:"cursor-pointer",color:"red"},null,8,["onClick"]),m(" "+a(e.producto.nombre)+" "+a(e.producto.marca_pro),1)]),o("td",null,[x(o("input",{"onUpdate:modelValue":h=>e.cantidadVenta=h,type:"number",style:{width:"50px"},filled:""},null,8,j),[[k,e.cantidadVenta]])]),o("td",null,[e.tipo_pro=="BA"?(s(),r(p,{key:0},[m(a(e.cantidadVenta),1)],64)):(s(),r(p,{key:1},[m(a(e.cantidadVenta*e.producto.tonelada),1)],64))]),o("td",null,[x(o("input",{"onUpdate:modelValue":h=>e.precioVenta=h,type:"number",style:{width:"70px"},filled:""},null,8,H),[[k,e.precioVenta]])]),o("td",null,[e.tipo_pro=="BA"?(s(),r(p,{key:0},[m(a((e.cantidadVenta*e.precioVenta).toFixed(2)),1)],64)):(s(),r(p,{key:1},[m(a((e.cantidadVenta*e.precioVenta*e.producto.tonelada).toFixed(2)),1)],64)),n(C,{name:"calculate",onClick:h=>u.openCalculate(e),class:"cursor-pointer",color:"primary"},null,8,["onClick"])])]))),128))]),o("tfoot",null,[o("tr",null,[W,o("td",X,[d.sales.length>0?(s(),r(p,{key:0},[m(a(u.totalVenta)+" Bs ",1)],64)):A("",!0)])]),o("tr",null,[o("td",J,[n(V,{"no-caps":"",class:"full-width",icon:"save",color:"positive",label:"Realizar pedido",onClick:u.dialogPedidoClick},null,8,["onClick"])])])])]),_:1})]),_:1})]),_:1})])])]),_:1}),n(Q,{modelValue:d.dialogPedido,"onUpdate:modelValue":l[15]||(l[15]=e=>d.dialogPedido=e)},{default:i(()=>[n(g,{style:{width:"650px","max-width":"90vw"}},{default:i(()=>[n(_,{class:"bg-primary text-white q-pb-none"},{default:i(()=>[o("div",K,[$,n(w),x(n(V,{flat:"",round:"",dense:"",icon:"close"},null,512),[[D]])])]),_:1}),n(_,{class:"q-mt-none"},{default:i(()=>[n(T,{onSubmit:u.submit},{default:i(()=>[o("div",ee,[o("div",oe,[n(y,{modelValue:d.pedido.cliente_id,"onUpdate:modelValue":[l[4]||(l[4]=e=>d.pedido.cliente_id=e),u.changeDirecionTelefono],onFilter:u.filterClientes,rules:[e=>!!e||"Seleccione un cliente"],filled:"","emit-value":"","map-options":"",standout:"","use-input":"",label:"Cliente",options:d.clientes,"option-value":"id","option-label":"nombre_cliente",dense:"",clearable:""},null,8,["modelValue","onFilter","onUpdate:modelValue","rules","options"])]),o("div",te,[n(c,{modelValue:d.pedido.direccion,"onUpdate:modelValue":l[5]||(l[5]=e=>d.pedido.direccion=e),filled:"",standout:"",label:"Direcci\xF3n",dense:"",hint:""},null,8,["modelValue"])]),o("div",le,[n(c,{modelValue:d.pedido.telefono,"onUpdate:modelValue":l[6]||(l[6]=e=>d.pedido.telefono=e),filled:"",standout:"",label:"Tel\xE9fono",dense:"",hint:""},null,8,["modelValue"])]),o("div",de,[n(c,{modelValue:d.pedido.telefono2,"onUpdate:modelValue":l[7]||(l[7]=e=>d.pedido.telefono2=e),filled:"",standout:"",label:"Tel\xE9fono 2",dense:"",hint:""},null,8,["modelValue"])]),o("div",ne,[n(c,{modelValue:d.pedido.fecha_hora,"onUpdate:modelValue":l[8]||(l[8]=e=>d.pedido.fecha_hora=e),filled:"",standout:"",label:"Fecha de Entrega",type:"date",dense:""},null,8,["modelValue"])]),o("div",ie,[n(c,{modelValue:d.pedido.nombre_factura,"onUpdate:modelValue":l[9]||(l[9]=e=>d.pedido.nombre_factura=e),filled:"",standout:"",label:"Nombre factura",dense:"",hint:""},null,8,["modelValue"])]),o("div",ae,[n(c,{modelValue:d.pedido.nit_factura,"onUpdate:modelValue":l[10]||(l[10]=e=>d.pedido.nit_factura=e),filled:"",standout:"",label:"NIT factura",dense:"",hint:""},null,8,["modelValue"])]),o("div",se,[n(c,{modelValue:d.pedido.fecha_pago,"onUpdate:modelValue":l[11]||(l[11]=e=>d.pedido.fecha_pago=e),filled:"",type:"date",standout:"",label:"Fecha de pago",dense:""},null,8,["modelValue"])]),o("div",re,[n(y,{modelValue:d.pedido.zona_id,"onUpdate:modelValue":l[12]||(l[12]=e=>d.pedido.zona_id=e),filled:"",standout:"",label:"Zona",options:d.zonas,"option-value":"nombre_zona","option-label":"nombre_zona","emit-value":"","map-options":"",rules:[e=>!!e||"Seleccione una zona"],dense:""},null,8,["modelValue","options","rules"])]),o("div",ce,[n(c,{modelValue:d.pedido.contacto,"onUpdate:modelValue":l[13]||(l[13]=e=>d.pedido.contacto=e),filled:"",standout:"",label:"Contacto",dense:"",hint:""},null,8,["modelValue"])]),o("div",ue,[n(c,{modelValue:d.pedido.observacion,"onUpdate:modelValue":l[14]||(l[14]=e=>d.pedido.observacion=e),filled:"",standout:"",label:"Observaci\xF3n",dense:"",hint:""},null,8,["modelValue"])])]),n(P,{dense:"",flat:"",bordered:"","wrap-cells":""},{default:i(()=>[pe,o("tbody",null,[(s(!0),r(p,null,v(d.sales,e=>(s(),r("tr",{key:e.producto.id},[o("td",null,a(e.producto.nombre),1),o("td",null,a(e.cantidadVenta),1),o("td",null,a(e.precioVenta),1),o("td",null,a((e.cantidadVenta*e.precioVenta).toFixed(2)),1)]))),128))]),o("tfoot",null,[o("tr",null,[me,o("td",fe,a(u.totalVenta)+" Bs ",1)])])]),_:1}),n(V,{loading:d.loading,"no-caps":"",class:"full-width",icon:"save",color:"positive",label:"Guardar pedido",type:"submit"},null,8,["loading"])]),_:1},8,["onSubmit"])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64)}var Ue=q(F,[["render",he]]);export{Ue as default};
