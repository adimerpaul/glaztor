import{R as u,$ as m,U as l,T as a,aD as Q,a1 as v,aC as z,aA as f,W as t,aB as d,V as b,S as E,Y as c,aE as y,a0 as k,M as C,Z as i,X as g,aF as S}from"./index.fb39ef5c.js";import{d as D,e as V,a as w,C as U}from"./ClosePopup.128ae44a.js";import{Q as F,a as $}from"./QSelect.02a30944.js";import{Q as T}from"./QList.0be7a149.js";import{Q as I}from"./QPage.1546c910.js";import{Q as A,a as M}from"./QForm.17abe237.js";import{Q as Y}from"./QMarkupTable.47561889.js";import{h as N}from"./moment.40bc58bf.js";import{E as q}from"./Excel.343f1006.js";import{_ as B}from"./plugin-vue_export-helper.21dcd24c.js";import"./index.a93ba69a.js";import"./_commonjsHelpers.a26ce4be.js";const O={name:"Pedidos",data(){return{loading:!1,dialog:!1,clientes:[],fechaInicio:N().format("YYYY-MM-DD"),fechaFin:N().format("YYYY-MM-DD"),zonas:[],pedidos:[],productos:[],pedido:{producto_id:null}}},mounted(){this.getZonas(),this.getPedidos(),this.getClientes(),this.getProductos()},methods:{exportExcel(){let e=[{sheet:"Pedidos",columns:[{label:"Fecha",value:"fecha"},{label:"Cliente",value:"cliente"},{label:"Producto",value:"producto"},{label:"Factura",value:"factura"},{label:"Nombre Factura",value:"nombre_factura"},{label:"Nit Factura",value:"nit_factura"},{label:"Direccion",value:"direccion"},{label:"Contacto",value:"contacto"},{label:"Telefono",value:"telefono"},{label:"Telefono2",value:"telefono2"},{label:"Observacion",value:"observacion"},{label:"Chofer",value:"chofer"},{label:"Zona",value:"zona"},{label:"Total",value:"total"},{label:"Estado",value:"estado"},{label:"Fecha Pago",value:"fecha_pago"},{label:"User",value:"user_id"}],content:this.pedidos}];q.export(e,"Reporte de Pedidos")},getZonas(){this.$axios.get("zonas").then(e=>{this.zonas=e.data}).catch(e=>{console.log(e)})},showPreventa(e){this.pedido={...e},this.dialog=!0},submit(){this.loading=!0,this.$axios.put("pedidos/"+this.pedido.id,this.pedido).then(e=>{this.dialog=!1,this.$alert.success("Pedido actualizado correctamente"),this.getPedidos()}).catch(e=>{console.log(e),this.$alert.error("Error al actualizar el pedido")}).finally(()=>{this.loading=!1})},getProductos(){this.$axios.get("productos").then(e=>{this.productos=e.data}).catch(e=>{console.log(e)})},getClientes(){this.$axios.get("clientes").then(e=>{this.clientes=e.data}).catch(e=>{console.log(e)})},addPedido(){this.$router.push({name:"pedidosPage"})},getPedidos(){this.loading=!0,this.$axios.get("pedidos",{params:{fechaInicio:this.fechaInicio,fechaFin:this.fechaFin}}).then(e=>{this.pedidos=e.data,this.loading=!1}).catch(e=>{console.log(e),this.loading=!1})}},computed:{esMovil(){return this.$q.screen.lt.md}}},R={class:"row"},L={class:"col-6 col-md-3"},Z={class:"col-6 col-md-3"},G={class:"col-6 col-md-3 text-left"},W={class:"col-6 col-md-3 text-right"},X={class:"text-h6"},_={class:"text-bold q-pa-xs"},j=t("label",null,"Total",-1),H=t("thead",null,[t("tr",null,[t("th",null,"Producto"),t("th",null,"Cantidad"),t("th",null,"Precio"),t("th",null,"Subtotal")])],-1),J=["onUpdate:modelValue"],K=["onUpdate:modelValue"],x=t("td",{colspan:"3",class:"text-right"},"Total",-1),ee={class:"text-bold"},oe={key:0},le={colspan:"4"};function re(e,s,se,te,r,p){return u(),m(v,null,[l(I,{class:"bg-grey-3 q-pa-xs"},{default:a(()=>[l(z,null,{default:a(()=>[l(f,{class:"q-pa-xs"},{default:a(()=>[t("div",R,[t("div",L,[l(d,{outlined:"",modelValue:r.fechaInicio,"onUpdate:modelValue":s[0]||(s[0]=o=>r.fechaInicio=o),label:"Fecha Inicio",type:"date",color:"white",dense:""},null,8,["modelValue"])]),t("div",Z,[l(d,{outlined:"",modelValue:r.fechaFin,"onUpdate:modelValue":s[1]||(s[1]=o=>r.fechaFin=o),label:"Fecha Fin",type:"date",color:"white",dense:""},null,8,["modelValue"])]),t("div",G,[l(b,{icon:"search",color:"primary",label:"Buscar",onClick:p.getPedidos,loading:r.loading,"no-caps":""},null,8,["onClick","loading"])]),t("div",W,[l(b,{icon:"get_app",color:"green",label:"Excel",onClick:p.exportExcel,loading:r.loading,"no-caps":""},null,8,["onClick","loading"]),l(b,{icon:"add_circle_outline",color:"green",label:"Nuevo Pedido",onClick:p.addPedido,loading:r.loading,"no-caps":""},null,8,["onClick","loading"])])])]),_:1})]),_:1}),l(f,{class:"q-pa-none"},{default:a(()=>[l(T,{dense:"",class:"rounded-borders"},{default:a(()=>[r.pedidos.length===0?(u(),E(w,{key:0},{default:a(()=>[l(D,null,{default:a(()=>[l(V,{class:"text-h6 text-grey"},{default:a(()=>[c("No hay pedidos")]),_:1})]),_:1})]),_:1})):y("",!0),(u(!0),m(v,null,k(r.pedidos,o=>(u(),E(w,{key:o.id,onClick:n=>p.showPreventa(o),clickable:"",class:"q-my-sm bg-white hover-bg-light-blue",style:{border:"1px solid #e0e0e0","border-radius":"8px"}},{default:a(()=>[l(D,null,{default:a(()=>[l(V,{class:"text-h6"},{default:a(()=>[c(i(o.fecha.substring(0,10)||"Sin propietario")+" ",1),l(g,{name:"check_circle",color:o.estado==="PENDIENTE"?"red":o.estado==="ENTREGADO"?"green":"orange"},null,8,["color"])]),_:2},1024),l(V,{class:"text-subtitle1 text-grey"},{default:a(()=>[c(i(o.direccion)+" ",1),l($,null,{default:a(()=>[c(i(o.total),1)]),_:2},1024)]),_:2},1024),l(V,{class:"text-caption text-positive"},{default:a(()=>{var n;return[c(i(o.cliente)+" - "+i(o.tipo_construccion)+" - "+i((n=o.user)==null?void 0:n.name)+" - "+i(o.fecha),1)]}),_:2},1024)]),_:2},1024),l(D,{side:""},{default:a(()=>[l(g,{name:"arrow_forward"})]),_:1})]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1})]),_:1}),l(Q,{modelValue:r.dialog,"onUpdate:modelValue":s[13]||(s[13]=o=>r.dialog=o),position:p.esMovil?void 0:"right",maximized:!0,"transition-show":"slide-left","transition-hide":"slide-right"},{default:a(()=>[l(z,{style:{width:"450px","max-width":"100vw"}},{default:a(()=>[l(f,{class:"row items-center q-px-md bg-primary text-white q-px-none"},{default:a(()=>[C(l(b,{flat:"",round:"",dense:"",icon:"fa-solid fa-arrow-left"},null,512),[[U]]),l(A),t("div",X,i(r.pedido.id?"Editar":"Nuevo")+" Pedido",1)]),_:1}),l(f,null,{default:a(()=>[l(M,{onSubmit:p.submit,disable:e.$store.user.role=="Ventas"||e.$store.user.role=="Cobranza"||e.$store.user.role=="Director"||e.$store.user.role=="Supervisor"},{default:a(()=>[l(d,{modelValue:r.pedido.fecha,"onUpdate:modelValue":s[2]||(s[2]=o=>r.pedido.fecha=o),label:"Fecha",outlined:"",disable:e.$store.user.role=="Ventas"||e.$store.user.role=="Cobranza"||e.$store.user.role=="Director"||e.$store.user.role=="Supervisor",dense:"",type:"date"},null,8,["modelValue","disable"]),l(d,{modelValue:r.pedido.cliente,"onUpdate:modelValue":s[3]||(s[3]=o=>r.pedido.cliente=o),label:"Cliente",outlined:"",disable:e.$store.user.role=="Ventas"||e.$store.user.role=="Cobranza"||e.$store.user.role=="Director"||e.$store.user.role=="Supervisor",dense:""},null,8,["modelValue","disable"]),l(d,{modelValue:r.pedido.nombre_factura,"onUpdate:modelValue":s[4]||(s[4]=o=>r.pedido.nombre_factura=o),label:"Nombre Factura",outlined:"",disable:e.$store.user.role=="Ventas"||e.$store.user.role=="Cobranza"||e.$store.user.role=="Director"||e.$store.user.role=="Supervisor",dense:""},null,8,["modelValue","disable"]),l(d,{modelValue:r.pedido.nit_factura,"onUpdate:modelValue":s[5]||(s[5]=o=>r.pedido.nit_factura=o),label:"Nit Factura",outlined:"",disable:e.$store.user.role=="Ventas"||e.$store.user.role=="Cobranza"||e.$store.user.role=="Director"||e.$store.user.role=="Supervisor",dense:""},null,8,["modelValue","disable"]),l(d,{modelValue:r.pedido.direccion,"onUpdate:modelValue":s[6]||(s[6]=o=>r.pedido.direccion=o),label:"Direccion",outlined:"",disable:e.$store.user.role=="Ventas"||e.$store.user.role=="Cobranza"||e.$store.user.role=="Director"||e.$store.user.role=="Supervisor",dense:""},null,8,["modelValue","disable"]),l(d,{modelValue:r.pedido.contacto,"onUpdate:modelValue":s[7]||(s[7]=o=>r.pedido.contacto=o),label:"Contacto",outlined:"",disable:e.$store.user.role=="Ventas"||e.$store.user.role=="Cobranza"||e.$store.user.role=="Director"||e.$store.user.role=="Supervisor",dense:""},null,8,["modelValue","disable"]),l(d,{modelValue:r.pedido.telefono,"onUpdate:modelValue":s[8]||(s[8]=o=>r.pedido.telefono=o),label:"Telefono",outlined:"",disable:e.$store.user.role=="Ventas"||e.$store.user.role=="Cobranza"||e.$store.user.role=="Director"||e.$store.user.role=="Supervisor",dense:""},null,8,["modelValue","disable"]),l(d,{type:"textarea",modelValue:r.pedido.observacion,"onUpdate:modelValue":s[9]||(s[9]=o=>r.pedido.observacion=o),label:"Observacion",outlined:"",disable:e.$store.user.role=="Ventas"||e.$store.user.role=="Cobranza"||e.$store.user.role=="Director"||e.$store.user.role=="Supervisor",dense:""},null,8,["modelValue","disable"]),l(d,{modelValue:r.pedido.chofer,"onUpdate:modelValue":s[10]||(s[10]=o=>r.pedido.chofer=o),label:"chofer",outlined:"",disable:e.$store.user.role=="Ventas"||e.$store.user.role=="Cobranza"||e.$store.user.role=="Director"||e.$store.user.role=="Supervisor",dense:""},null,8,["modelValue","disable"]),l(F,{modelValue:r.pedido.zona,"onUpdate:modelValue":s[11]||(s[11]=o=>r.pedido.zona=o),label:"zonas",outlined:"",disable:e.$store.user.role=="Ventas"||e.$store.user.role=="Cobranza"||e.$store.user.role=="Director"||e.$store.user.role=="Supervisor",dense:"",options:r.zonas,"emit-value":"","map-options":"","option-label":"nombre_zona","option-value":"nombre_zona"},null,8,["modelValue","disable","options"]),l(F,{modelValue:r.pedido.estado,"onUpdate:modelValue":s[12]||(s[12]=o=>r.pedido.estado=o),label:"Estado",outlined:"",disable:e.$store.user.role=="Ventas"||e.$store.user.role=="Cobranza"||e.$store.user.role=="Director"||e.$store.user.role=="Supervisor",dense:"",options:["PENDIENTE","ENTREGADO","ANULADO"]},{after:a(()=>[l(g,{name:"check_circle",color:r.pedido.estado==="PENDIENTE"?"red":r.pedido.estado==="ENTREGADO"?"green":"orange"},null,8,["color"])]),_:1},8,["modelValue","disable"]),t("div",_,[j,t("div",null,i(r.pedido.total),1)]),l(Y,{dense:"",flat:"",bordered:"","wrap-cells":""},{default:a(()=>[H,t("tbody",null,[(u(!0),m(v,null,k(r.pedido.detalles,o=>{var n,P;return u(),m("tr",{key:o.id},[t("td",null,[l(g,{name:"delete",onClick:h=>e.sales.splice(e.sales.indexOf(o),1),class:"cursor-pointer",color:"red"},null,8,["onClick"]),c(" "+i((n=o.producto)==null?void 0:n.nombre_pro)+" "+i((P=o.producto)==null?void 0:P.marca_pro),1)]),t("td",null,[C(t("input",{"onUpdate:modelValue":h=>o.cantidad=h,type:"number",style:{width:"50px"},step:"0.01"},null,8,J),[[S,o.cantidad]])]),t("td",null,[C(t("input",{"onUpdate:modelValue":h=>o.precio=h,type:"number",style:{width:"70px"},step:"0.01"},null,8,K),[[S,o.precio]])]),t("td",null,i((o.cantidad*o.precio).toFixed(2)),1)])}),128))]),t("tfoot",null,[t("tr",null,[x,t("td",ee,i(r.pedido.detalles.reduce((o,n)=>o+n.cantidad*n.precio,0).toFixed(2)),1)]),e.$store.user.role==="Administrador"||e.$store.user.role==="Admin"?(u(),m("tr",oe,[t("td",le,[l(b,{"no-caps":"",class:"full-width",color:"blue",loading:r.loading,type:"submit",label:"Actualizar pedido"},null,8,["loading"])])])):y("",!0)])]),_:1})]),_:1},8,["onSubmit","disable"])]),_:1})]),_:1})]),_:1},8,["modelValue","position"])],64)}var Ve=B(O,[["render",re]]);export{Ve as default};
