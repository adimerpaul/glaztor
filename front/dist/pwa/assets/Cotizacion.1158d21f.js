import{R as u,S as m,T as t,U as a,V as s,aB as c,X as p,M as b,Y as g,aC as Q,aA as _,W as h,Z as x,aD as D}from"./index.fb39ef5c.js";import{a as v,d as r,e as V,C}from"./ClosePopup.128ae44a.js";import{Q as y}from"./QList.0be7a149.js";import{Q as k}from"./QBtnDropdown.60722bd4.js";import{Q as w}from"./QTd.544faa51.js";import{Q as U}from"./QTable.7a1fcc98.js";import{Q as F,a as E}from"./QForm.17abe237.js";import{Q as d}from"./QSelect.02a30944.js";import{Q as S}from"./QPage.1546c910.js";import{h as A}from"./moment.40bc58bf.js";import{E as N}from"./Excel.343f1006.js";import{_ as B}from"./plugin-vue_export-helper.21dcd24c.js";import"./QBtnGroup.b6395d86.js";import"./QMarkupTable.47561889.js";import"./index.a93ba69a.js";import"./_commonjsHelpers.a26ce4be.js";const q={name:"CotizacionsPage",data(){return{cotizacions:[],cotizacion:{},cotizacionDialog:!1,loading:!1,filter:"",productosAll:[],products:[],clientes:[],clientesAll:[],zonas:[],marcas:[],actionPeriodo:"",filter:"",columns:[{name:"actions",label:"Acciones",align:"center"},{name:"fecha",label:"Fecha",align:"left",field:"fecha"},{name:"cliente",label:"Cliente",align:"left",field:"cliente"},{name:"marca",label:"Marca",align:"left",field:"marca"},{name:"producto",label:"Producto",align:"left",field:"producto"},{name:"cantidad",label:"Cantidad",align:"left",field:"cantidad"},{name:"zona",label:"Zona",align:"left",field:"zona"},{name:"precio_compra_cf",label:"Precio Compra CF",align:"left",field:"precio_compra_cf"},{name:"precio_compra_sf",label:"Precio Compra SF",align:"left",field:"precio_compra_sf"},{name:"precio_venta_cf",label:"Precio Venta CF",align:"left",field:"precio_venta_cf"},{name:"precio_venta_sf",label:"Precio Venta SF",align:"left",field:"precio_venta_sf"},{name:"observacion",label:"Observaci\xF3n",align:"left",field:"observacion"}]}},mounted(){this.cotizacionsGet(),this.getProductos(),this.getClientes(),this.getZonas()},methods:{exportExcel(){let l=[{sheet:"Cotizacions",columns:[{label:"Fecha",value:"fecha"},{label:"Nombre del cliente",value:"cliente"},{label:"Marca",value:"marca"},{label:"Producto",value:"producto"},{label:"Cantidad",value:"cantidad"},{label:"Zona",value:"zona"},{label:"Precio_compra_cf",value:"precio_compra_cf"},{label:"Precio_compra_sf",value:"precio_compra_sf"},{label:"Precio_venta_cf",value:"precio_venta_cf"},{label:"Precio_venta_sf",value:"precio_venta_sf"},{label:"Observacion",value:"observacion"}],content:this.cotizacions}];N.export(l,"Reporte de Cotizaciones")},getZonas(){this.$axios.get("zonas").then(l=>{this.zonas=l.data}).catch(l=>{console.log(l)})},filterClientes(l,e){if(l===""){e(()=>{this.clientes=this.clientesAll});return}const f=l.toLowerCase();e(()=>{this.clientes=this.clientesAll.filter(z=>z.nombre_cliente.toLowerCase().indexOf(f)>-1)})},getClientes(){this.$axios.get("clientes").then(l=>{this.clientes=l.data,this.clientesAll=l.data}).catch(l=>{console.log(l)})},filterProducts(l){console.log(l),l!==null&&(this.products=this.productosAll.filter(e=>(e==null?void 0:e.marca_pro)===l))},getProductos(){this.$axios.get("productos").then(l=>{this.productosAll=l.data,this.products=this.productosAll,this.products.forEach(e=>{this.marcas.includes(e.marca_pro)||this.marcas.push(e.marca_pro)})}).catch(l=>{console.log(l)})},cotizacionNew(){this.cotizacion={fecha:A().format("YYYY-MM-DD"),cliente:"",marca:"",producto:"",cantidad:0,zona:"",precio_compra_cf:0,precio_compra_sf:0,precio_venta_cf:0,precio_venta_sf:0,observacion:""},this.actionPeriodo="Nueva",this.cotizacionDialog=!0},cotizacionsGet(){this.loading=!0,this.$axios.get("cotizacions").then(l=>{this.cotizacions=l.data}).catch(l=>{this.$alert.error(l.response.data.message)}).finally(()=>{this.loading=!1})},cotizacionPost(){this.loading=!0,this.$axios.post("cotizacions",this.cotizacion).then(l=>{this.cotizacionsGet(),this.cotizacionDialog=!1,this.$alert.success("Cotizacion creada")}).catch(l=>{this.$alert.error(l.response.data.message)}).finally(()=>{this.loading=!1})},cotizacionPut(){this.loading=!0,this.$axios.put("cotizacions/"+this.cotizacion.id,this.cotizacion).then(l=>{this.cotizacionsGet(),this.cotizacionDialog=!1,this.$alert.success("Cotizacion actualizada")}).catch(l=>{this.$alert.error(l.response.data.message)}).finally(()=>{this.loading=!1})},cotizacionEdit(l){this.cotizacion={...l},this.actionPeriodo="Editar",this.cotizacionDialog=!0},cotizacionDelete(l){this.$alert.dialog("\xBFDesea eliminar la cotizacion?").onOk(()=>{this.loading=!0,this.$axios.delete("cotizacions/"+l).then(e=>{this.cotizacionsGet(),this.$alert.success("Cotizacion eliminada")}).catch(e=>{this.$alert.error(e.response.data.message)}).finally(()=>{this.loading=!1})})}}},G={class:"text-right"};function M(l,e,f,z,o,n){return u(),m(S,{class:"q-pa-md"},{default:t(()=>[a(U,{rows:o.cotizacions,columns:o.columns,dense:"","wrap-cells":"",flat:"",bordered:"","rows-per-page-options":[0],title:"Cotizacions",filter:o.filter},{"top-right":t(()=>[a(s,{icon:"download",color:"green",label:"Exportar",onClick:n.exportExcel,"no-caps":""},null,8,["onClick"]),a(s,{color:"primary",label:"Nuevo",onClick:n.cotizacionNew,outline:"","no-caps":"",icon:"add_circle_outline",loading:o.loading},null,8,["onClick","loading"]),a(c,{modelValue:o.filter,"onUpdate:modelValue":e[0]||(e[0]=i=>o.filter=i),label:"Buscar",dense:"",outlined:""},{append:t(()=>[a(p,{name:"search"})]),_:1},8,["modelValue"])]),"body-cell-actions":t(i=>[a(w,{props:i},{default:t(()=>[a(k,{label:"Opciones","no-caps":"",size:"10px",dense:"",color:"primary"},{default:t(()=>[a(y,null,{default:t(()=>[b((u(),m(v,{clickable:"",onClick:P=>n.cotizacionEdit(i.row)},{default:t(()=>[a(r,{avatar:""},{default:t(()=>[a(p,{name:"edit"})]),_:1}),a(r,null,{default:t(()=>[a(V,null,{default:t(()=>[g("Editar")]),_:1})]),_:1})]),_:2},1032,["onClick"])),[[C]]),b((u(),m(v,{clickable:"",onClick:P=>n.cotizacionDelete(i.row.id)},{default:t(()=>[a(r,{avatar:""},{default:t(()=>[a(p,{name:"delete"})]),_:1}),a(r,null,{default:t(()=>[a(V,null,{default:t(()=>[g("Eliminar")]),_:1})]),_:1})]),_:2},1032,["onClick"])),[[C]])]),_:2},1024)]),_:2},1024)]),_:2},1032,["props"])]),_:1},8,["rows","columns","filter"]),a(D,{modelValue:o.cotizacionDialog,"onUpdate:modelValue":e[15]||(e[15]=i=>o.cotizacionDialog=i),persistent:""},{default:t(()=>[a(Q,null,{default:t(()=>[a(_,{class:"q-pb-none row items-center"},{default:t(()=>[h("div",null,x(o.actionPeriodo)+" Cotizacion ",1),a(F),a(s,{icon:"close",flat:"",round:"",dense:"",onClick:e[1]||(e[1]=i=>o.cotizacionDialog=!1)})]),_:1}),a(_,{class:"q-pt-none"},{default:t(()=>[a(E,{onSubmit:e[14]||(e[14]=i=>o.cotizacion.id?n.cotizacionPut():n.cotizacionPost())},{default:t(()=>[a(c,{modelValue:o.cotizacion.fecha,"onUpdate:modelValue":e[2]||(e[2]=i=>o.cotizacion.fecha=i),label:"Fecha",dense:"",outlined:"",type:"date",rules:[i=>!!i||"Campo requerido"]},null,8,["modelValue","rules"]),a(d,{modelValue:o.cotizacion.cliente,"onUpdate:modelValue":e[3]||(e[3]=i=>o.cotizacion.cliente=i),onFilter:n.filterClientes,options:o.clientes,"option-value":"nombre_cliente","option-label":"nombre_cliente","emit-value":"","map-options":"",label:"Cliente",filled:"",dense:"",clearable:"","use-chips":""},null,8,["modelValue","onFilter","options"]),a(d,{modelValue:o.cotizacion.marca,"onUpdate:modelValue":[e[4]||(e[4]=i=>o.cotizacion.marca=i),n.filterProducts],label:"Marca",dense:"",outlined:"","use-input":"",options:o.marcas},null,8,["modelValue","onUpdate:modelValue","options"]),a(d,{modelValue:o.cotizacion.producto,"onUpdate:modelValue":e[5]||(e[5]=i=>o.cotizacion.producto=i),label:"Producto",dense:"",outlined:"","use-input":"","option-label":"nombre_pro","option-value":"nombre_pro","emit-value":"","map-options":"",options:o.products},null,8,["modelValue","options"]),a(c,{modelValue:o.cotizacion.cantidad,"onUpdate:modelValue":e[6]||(e[6]=i=>o.cotizacion.cantidad=i),label:"Cantidad",type:"number",dense:"",outlined:"",rules:[i=>!!i||"Campo requerido"]},null,8,["modelValue","rules"]),a(d,{modelValue:o.cotizacion.zona,"onUpdate:modelValue":e[7]||(e[7]=i=>o.cotizacion.zona=i),filled:"",standout:"",label:"Zona",dense:"",outlined:"",options:o.zonas,"option-value":"nombre_zona","option-label":"nombre_zona","emit-value":"","map-options":""},null,8,["modelValue","options"]),a(c,{modelValue:o.cotizacion.precio_compra_cf,"onUpdate:modelValue":e[8]||(e[8]=i=>o.cotizacion.precio_compra_cf=i),label:"Precio Compra CF",type:"number",dense:"",outlined:""},null,8,["modelValue"]),a(c,{modelValue:o.cotizacion.precio_compra_sf,"onUpdate:modelValue":e[9]||(e[9]=i=>o.cotizacion.precio_compra_sf=i),label:"Precio Compra SF",type:"number",dense:"",outlined:""},null,8,["modelValue"]),a(c,{modelValue:o.cotizacion.precio_venta_cf,"onUpdate:modelValue":e[10]||(e[10]=i=>o.cotizacion.precio_venta_cf=i),label:"Precio Venta CF",type:"number",dense:"",outlined:""},null,8,["modelValue"]),a(c,{modelValue:o.cotizacion.precio_venta_sf,"onUpdate:modelValue":e[11]||(e[11]=i=>o.cotizacion.precio_venta_sf=i),label:"Precio Venta SF",type:"number",dense:"",outlined:""},null,8,["modelValue"]),a(c,{modelValue:o.cotizacion.observacion,"onUpdate:modelValue":e[12]||(e[12]=i=>o.cotizacion.observacion=i),label:"Observaci\xF3n",dense:"",outlined:"",type:"textarea"},null,8,["modelValue"]),h("div",G,[a(s,{color:"negative",label:"Cancelar",onClick:e[13]||(e[13]=i=>o.cotizacionDialog=!1),"no-caps":"",loading:o.loading},null,8,["loading"]),a(s,{color:"primary",label:"Guardar",type:"submit","no-caps":"",loading:o.loading,class:"q-ml-sm"},null,8,["loading"])])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}var le=B(q,[["render",M]]);export{le as default};
