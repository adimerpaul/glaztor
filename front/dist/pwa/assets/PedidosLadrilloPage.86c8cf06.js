import{T as s,a1 as r,W as d,V as n,aG as Q,a3 as p,Y as o,aF as g,aD as _,aE as c,$ as v,X as V,a2 as x,_ as f,Z as a,a5 as B,M as C,a4 as z,aH as k}from"./index.8e5efdfb.js";import{Q as A}from"./QImg.2b5ac115.js";import{Q as w}from"./QSpace.1f3d3d67.js";import{Q as y}from"./QSelect.7f7f9668.js";import{Q as P}from"./QMarkupTable.f4b57dd0.js";import{Q as T}from"./QPage.8f9149b4.js";import{Q as D}from"./QForm.4421addc.js";import{C as q}from"./ClosePopup.3be4487d.js";import{h as U}from"./moment.40bc58bf.js";import{_ as L}from"./plugin-vue_export-helper.21dcd24c.js";import"./format.7d90d4c2.js";const F={name:"Pedidos",data(){return{loading:!1,filter:"",clientes:[],clientesAll:[],productoladrillos:[],productoladrillosAll:[],zonas:[],sales:[],pedido:{},dialogPedido:!1}},mounted(){this.getClientes(),this.getProductos(),this.getZonas()},methods:{openCalculate(l){console.log(l);let t=0;l.tipo_pro==="BA"?t=l.cantidadVenta*l.precioVenta:t=l.cantidadVenta*l.precioVenta*l.producto.tonelada,this.$q.dialog({title:"Calcular",message:"Ingrese el total de toneladas",prompt:{model:t,type:"text"},cancel:!0,persistent:!0}).onOk(b=>{let h=0;l.tipo_pro==="BA"?h=l.cantidadVenta:h=l.cantidadVenta*l.producto.tonelada,l.precioVenta=b/h}).onCancel(()=>{}).onDismiss(()=>{})},getZonas(){this.$axios.get("zonas").then(l=>{this.zonas=l.data}).catch(l=>{console.log(l)})},filterClientes(l,t){if(l===""){t(()=>{this.clientes=this.clientesAll});return}const b=l.toLowerCase();t(()=>{this.clientes=this.clientesAll.filter(h=>h.nombre_cliente.toLowerCase().indexOf(b)>-1)})},submit(){this.loading=!0,this.$axios.post("pedidosLadrillo",{...this.pedido,detalles:this.sales.map(l=>({id:l.producto.id,cantidadVenta:l.cantidadVenta,precioVenta:l.precioVenta,tipo_pro:l.tipo_pro}))}).then(l=>{this.$alert.success("Pedido guardado"),this.dialogPedido=!1,this.sales=[],this.$router.push("/pedidoLadrillo")}).catch(l=>{console.log(l),this.$alert.error(l.response.data.message)}).finally(()=>{this.loading=!1})},dialogPedidoClick(){if(this.sales.length===0)return this.$alert.error("No hay productoladrillos en el carrito"),!1;this.dialogPedido=!0,this.pedido={fecha_hora:U().format("YYYY-MM-DD"),nombre_factura:"",nit_factura:"",contacto:"",direccion:"",telefono:"",telefono2:"",fecha_pago:U().format("YYYY-MM-DD"),observacion:""}},changeDirecionTelefono(){const l=this.clientes.find(t=>t.id===this.pedido.cliente_id);this.pedido.direccion=l.direccion,this.pedido.telefono=l.telefono_1,this.pedido.telefono2=l.telefono_2,this.pedido.contacto=l.nombre_cliente},agregarProducto(l){if(parseInt(l.cantidad_pro)===0)return this.$alert.error("Producto sin stock"),!1;this.sales.push({producto:l,cantidadVenta:1,precioVenta:l.precio_pro,tipo_pro:"BA"})},filterProductos(){this.productoladrillos=this.productoladrillosAll.filter(l=>l.nombre_pro.toLowerCase().includes(this.filter.toLowerCase())||l.marca_pro.toLowerCase().includes(this.filter.toLowerCase()))},getProductos(){this.$axios.get("productoladrillos").then(l=>{this.productoladrillos=l.data,this.productoladrillosAll=l.data}).catch(l=>{console.log(l)})},getClientes(){this.$axios.get("clientes").then(l=>{this.clientes=l.data,this.clientesAll=l.data}).catch(l=>{console.log(l)})}},computed:{esMovil(){return this.$q.screen.lt.md},totalVenta(){let l=0;return this.sales.forEach(t=>{t.tipo_pro==="BA"?l+=t.cantidadVenta*t.precioVenta:l+=t.cantidadVenta*t.precioVenta*t.producto.tonelada}),l}}},S={class:"row"},Y={class:"col-12 col-md-7 q-pa-xs"},M={class:"row"},N={class:"col-12"},I={class:"absolute-bottom",style:{padding:"0",margin:"0"}},E={class:"row items-center",style:{"font-size":"9px"}},O={style:{display:"flex","justify-content":"space-between","font-size":"12px"}},R={class:"col-12 col-md-5 q-pa-xs"},Z={class:"row items-center"},G=o("thead",null,[o("tr",null,[o("th",null,"Producto"),o("th",null,"Tipo"),o("th",null,"Cant."),o("th",null,"Cant. Real"),o("th",null,"Precio"),o("th",null,"Subtotal")])],-1),j=["onUpdate:modelValue"],H=["onUpdate:modelValue"],W=o("td",{colspan:"3",class:"text-right text-bold"},"Total",-1),X={class:"text-bold"},J={colspan:"4"},K={class:"row items-center"},$=o("div",{class:"text-h6"},"Realizar pedido",-1),ee={class:"row"},oe={class:"col-12 col-md-6"},le={class:"col-12 col-md-6"},te={class:"col-12 col-md-3"},de={class:"col-12 col-md-3"},ie={class:"col-12 col-md-3"},ne={class:"col-12 col-md-3"},ae={class:"col-12 col-md-4"},se={class:"col-12 col-md-4"},re={class:"col-12 col-md-4"},ce={class:"col-12"},ue={class:"col-12"},pe=o("thead",null,[o("tr",null,[o("th",null,"Producto"),o("th",null,"Cantidad"),o("th",null,"Precio"),o("th",null,"Subtotal")])],-1),me=o("td",{colspan:"3",class:"text-right"},"Total",-1),fe={class:"text-bold"};function he(l,t,b,h,i,u){return s(),r(p,null,[d(T,{class:"bg-grey-3 q-pa-xs"},{default:n(()=>[o("div",S,[o("div",Y,[d(g,{flat:"",bordered:""},{default:n(()=>[d(_,{class:"q-pa-xs"},{default:n(()=>[o("div",M,[o("div",N,[d(c,{modelValue:i.filter,"onUpdate:modelValue":[t[1]||(t[1]=e=>i.filter=e),u.filterProductos],filled:"",standout:"",placeholder:"Buscar producto",dense:"",clearable:""},{prepend:n(()=>[d(v,{name:"search"})]),before:n(()=>[d(V,{flat:"",round:"",dense:"",icon:"arrow_back",onClick:t[0]||(t[0]=e=>this.$router.go(-1))})]),_:1},8,["modelValue","onUpdate:modelValue"])]),(s(!0),r(p,null,x(i.productoladrillos,e=>(s(),r("div",{class:"col-4 col-md-3",key:e.id},[d(g,{flat:"",bordered:"",class:"q-ma-xs cursor-pointer",onClick:m=>u.agregarProducto(e)},{default:n(()=>[d(_,{class:"q-pa-none"},{default:n(()=>[d(A,{src:l.$url+".."+e.foto_pro,alt:e.nombre_pro,class:"full-width",style:{height:"130px"}},{default:n(()=>[o("div",I,[o("div",E,[o("div",null,a(e.nombre_pro),1),o("div",null,a(e.marca_pro),1)]),o("div",O,[o("div",null,a(e.precio_pro)+" Bs. ",1),o("div",{class:z("text-bold "+(e.cantidad_pro=="0"?"text-negative":"text-positive"))},a(e.cantidad_pro),3)])])]),_:2},1032,["src","alt"])]),_:2},1024)]),_:2},1032,["onClick"])]))),128))])]),_:1})]),_:1})]),o("div",R,[d(g,{flat:"",bordered:""},{default:n(()=>[d(_,{class:"q-pa-xs"},{default:n(()=>[o("div",Z,[f(" Carrito de compras "),d(w),d(V,{dense:"",flat:"",color:"red",icon:"delete",label:"Limpiar",onClick:t[2]||(t[2]=e=>i.sales=[]),"no-caps":""})]),d(P,{dense:"",flat:"",bordered:"","wrap-cells":""},{default:n(()=>[G,o("tbody",null,[(s(!0),r(p,null,x(i.sales,e=>(s(),r("tr",{key:e.producto.id},[o("td",null,[d(v,{name:"delete",onClick:m=>i.sales.splice(i.sales.indexOf(e),1),class:"cursor-pointer",color:"red"},null,8,["onClick"]),f(" "+a(e.producto.nombre_pro)+" "+a(e.producto.marca_pro),1)]),o("td",null,[d(y,{modelValue:e.tipo_pro,"onUpdate:modelValue":m=>e.tipo_pro=m,filled:"",dense:"",options:["BA","TN"]},null,8,["modelValue","onUpdate:modelValue"])]),o("td",null,[C(o("input",{"onUpdate:modelValue":m=>e.cantidadVenta=m,type:"number",style:{width:"50px"},filled:""},null,8,j),[[k,e.cantidadVenta]])]),o("td",null,[e.tipo_pro=="BA"?(s(),r(p,{key:0},[f(a(e.cantidadVenta),1)],64)):(s(),r(p,{key:1},[f(a(e.cantidadVenta*e.producto.tonelada),1)],64))]),o("td",null,[C(o("input",{"onUpdate:modelValue":m=>e.precioVenta=m,type:"number",style:{width:"70px"},filled:""},null,8,H),[[k,e.precioVenta]])]),o("td",null,[e.tipo_pro=="BA"?(s(),r(p,{key:0},[f(a((e.cantidadVenta*e.precioVenta).toFixed(2)),1)],64)):(s(),r(p,{key:1},[f(a((e.cantidadVenta*e.precioVenta*e.producto.tonelada).toFixed(2)),1)],64)),d(v,{name:"calculate",onClick:m=>u.openCalculate(e),class:"cursor-pointer",color:"primary"},null,8,["onClick"])])]))),128))]),o("tfoot",null,[o("tr",null,[W,o("td",X,[i.sales.length>0?(s(),r(p,{key:0},[f(a(u.totalVenta)+" Bs ",1)],64)):B("",!0)])]),o("tr",null,[o("td",J,[d(V,{"no-caps":"",class:"full-width",icon:"save",color:"positive",label:"Realizar pedido",onClick:u.dialogPedidoClick},null,8,["onClick"])])])])]),_:1})]),_:1})]),_:1})])])]),_:1}),d(Q,{modelValue:i.dialogPedido,"onUpdate:modelValue":t[14]||(t[14]=e=>i.dialogPedido=e)},{default:n(()=>[d(g,{style:{width:"650px","max-width":"90vw"}},{default:n(()=>[d(_,{class:"bg-primary text-white q-pb-none"},{default:n(()=>[o("div",K,[$,d(w),C(d(V,{flat:"",round:"",dense:"",icon:"close"},null,512),[[q]])])]),_:1}),d(_,{class:"q-mt-none"},{default:n(()=>[d(D,{onSubmit:u.submit},{default:n(()=>[o("div",ee,[o("div",oe,[d(y,{modelValue:i.pedido.cliente_id,"onUpdate:modelValue":[t[3]||(t[3]=e=>i.pedido.cliente_id=e),u.changeDirecionTelefono],onFilter:u.filterClientes,rules:[e=>!!e||"Seleccione un cliente"],filled:"","emit-value":"","map-options":"",standout:"","use-input":"",label:"Cliente",options:i.clientes,"option-value":"id","option-label":"nombre_cliente",dense:"",clearable:""},null,8,["modelValue","onFilter","onUpdate:modelValue","rules","options"])]),o("div",le,[d(c,{modelValue:i.pedido.direccion,"onUpdate:modelValue":t[4]||(t[4]=e=>i.pedido.direccion=e),filled:"",standout:"",label:"Direcci\xF3n",dense:"",hint:""},null,8,["modelValue"])]),o("div",te,[d(c,{modelValue:i.pedido.telefono,"onUpdate:modelValue":t[5]||(t[5]=e=>i.pedido.telefono=e),filled:"",standout:"",label:"Tel\xE9fono",dense:"",hint:""},null,8,["modelValue"])]),o("div",de,[d(c,{modelValue:i.pedido.telefono2,"onUpdate:modelValue":t[6]||(t[6]=e=>i.pedido.telefono2=e),filled:"",standout:"",label:"Tel\xE9fono 2",dense:"",hint:""},null,8,["modelValue"])]),o("div",ie,[d(c,{modelValue:i.pedido.fecha_hora,"onUpdate:modelValue":t[7]||(t[7]=e=>i.pedido.fecha_hora=e),filled:"",standout:"",label:"Fecha de Entrega",type:"date",dense:""},null,8,["modelValue"])]),o("div",ne,[d(c,{modelValue:i.pedido.nombre_factura,"onUpdate:modelValue":t[8]||(t[8]=e=>i.pedido.nombre_factura=e),filled:"",standout:"",label:"Nombre factura",dense:"",hint:""},null,8,["modelValue"])]),o("div",ae,[d(c,{modelValue:i.pedido.nit_factura,"onUpdate:modelValue":t[9]||(t[9]=e=>i.pedido.nit_factura=e),filled:"",standout:"",label:"NIT factura",dense:"",hint:""},null,8,["modelValue"])]),o("div",se,[d(c,{modelValue:i.pedido.fecha_pago,"onUpdate:modelValue":t[10]||(t[10]=e=>i.pedido.fecha_pago=e),filled:"",type:"date",standout:"",label:"Fecha de pago",dense:""},null,8,["modelValue"])]),o("div",re,[d(y,{modelValue:i.pedido.zona_id,"onUpdate:modelValue":t[11]||(t[11]=e=>i.pedido.zona_id=e),filled:"",standout:"",label:"Zona",options:i.zonas,"option-value":"nombre_zona","option-label":"nombre_zona","emit-value":"","map-options":"",rules:[e=>!!e||"Seleccione una zona"],dense:""},null,8,["modelValue","options","rules"])]),o("div",ce,[d(c,{modelValue:i.pedido.contacto,"onUpdate:modelValue":t[12]||(t[12]=e=>i.pedido.contacto=e),filled:"",standout:"",label:"Contacto",dense:"",hint:""},null,8,["modelValue"])]),o("div",ue,[d(c,{modelValue:i.pedido.observacion,"onUpdate:modelValue":t[13]||(t[13]=e=>i.pedido.observacion=e),filled:"",standout:"",label:"Observaci\xF3n",dense:"",hint:""},null,8,["modelValue"])])]),d(P,{dense:"",flat:"",bordered:"","wrap-cells":""},{default:n(()=>[pe,o("tbody",null,[(s(!0),r(p,null,x(i.sales,e=>(s(),r("tr",{key:e.producto.id},[o("td",null,a(e.producto.nombre_pro),1),o("td",null,a(e.cantidadVenta),1),o("td",null,a(e.precioVenta),1),o("td",null,a((e.cantidadVenta*e.precioVenta).toFixed(2)),1)]))),128))]),o("tfoot",null,[o("tr",null,[me,o("td",fe,a(u.totalVenta)+" Bs ",1)])])]),_:1}),d(V,{loading:i.loading,"no-caps":"",class:"full-width",icon:"save",color:"positive",label:"Guardar pedido",type:"submit"},null,8,["loading"])]),_:1},8,["onSubmit"])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64)}var Ue=L(F,[["render",he]]);export{Ue as default};
