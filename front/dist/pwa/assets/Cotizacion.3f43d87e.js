import{T as u,U as m,V as t,W as a,X as s,aE as c,$ as p,M as b,_ as g,aF as Q,aD as _,Y as h,Z as x,aG as D}from"./index.8e5efdfb.js";import{Q as v,a as d,d as V}from"./format.7d90d4c2.js";import{Q as k}from"./QList.75259ae5.js";import{Q as y}from"./QBtnDropdown.5b46475c.js";import{Q as U}from"./QTd.47060a52.js";import{Q as w}from"./QTable.9ece2fc3.js";import{Q as F}from"./QSpace.1f3d3d67.js";import{Q as r}from"./QSelect.7f7f9668.js";import{Q as E}from"./QForm.4421addc.js";import{Q as S}from"./QPage.8f9149b4.js";import{C}from"./ClosePopup.3be4487d.js";import{h as A}from"./moment.40bc58bf.js";import{E as B}from"./Excel.60733b5e.js";import{_ as N}from"./plugin-vue_export-helper.21dcd24c.js";import"./QBtnGroup.7ea5ef23.js";import"./QMarkupTable.f4b57dd0.js";import"./index.8bd2ab55.js";const G={name:"CotizacionsPage",data(){return{cotizacions:[],cotizacion:{},cotizacionDialog:!1,loading:!1,filter:"",productosAll:[],products:[],clientes:[],clientesAll:[],zonas:[],marcas:[],actionPeriodo:"",filter:"",columns:[{name:"actions",label:"Acciones",align:"center"},{name:"fecha",label:"Fecha",align:"left",field:"fecha"},{name:"cliente",label:"Cliente",align:"left",field:"cliente"},{name:"marca",label:"Marca",align:"left",field:"marca"},{name:"producto",label:"Producto",align:"left",field:"producto"},{name:"cantidad",label:"Cantidad",align:"left",field:"cantidad"},{name:"medida",label:"medida",align:"left",field:"medida"},{name:"zona",label:"Zona",align:"left",field:"zona"},{name:"precio_compra_cf",label:"Precio Compra CF",align:"left",field:"precio_compra_cf"},{name:"precio_compra_sf",label:"Precio Compra SF",align:"left",field:"precio_compra_sf"},{name:"precio_venta_cf",label:"Precio Venta CF",align:"left",field:"precio_venta_cf"},{name:"precio_venta_sf",label:"Precio Venta SF",align:"left",field:"precio_venta_sf"},{name:"observacion",label:"Observaci\xF3n",align:"left",field:"observacion"}]}},mounted(){this.cotizacionsGet(),this.getProductos(),this.getClientes(),this.getZonas()},methods:{exportExcel(){let i=[{sheet:"Cotizacions",columns:[{label:"Fecha",value:"fecha"},{label:"Nombre del cliente",value:"cliente"},{label:"Marca",value:"marca"},{label:"Producto",value:"producto"},{label:"Cantidad",value:"cantidad"},{label:"medida",value:"medida"},{label:"Zona",value:"zona"},{label:"Precio_compra_cf",value:"precio_compra_cf"},{label:"Precio_compra_sf",value:"precio_compra_sf"},{label:"Precio_venta_cf",value:"precio_venta_cf"},{label:"Precio_venta_sf",value:"precio_venta_sf"},{label:"Observacion",value:"observacion"}],content:this.cotizacions}];B.export(i,"Reporte de Cotizaciones")},getZonas(){this.$axios.get("zonas").then(i=>{this.zonas=i.data}).catch(i=>{console.log(i)})},filterClientes(i,e){if(i===""){e(()=>{this.clientes=this.clientesAll});return}const f=i.toLowerCase();e(()=>{this.clientes=this.clientesAll.filter(z=>z.nombre_cliente.toLowerCase().indexOf(f)>-1)})},getClientes(){this.$axios.get("clientes").then(i=>{this.clientes=i.data,this.clientesAll=i.data}).catch(i=>{console.log(i)})},filterProducts(i){console.log(i),i!==null&&(this.products=this.productosAll.filter(e=>(e==null?void 0:e.marca_pro)===i))},getProductos(){this.$axios.get("productos").then(i=>{this.productosAll=i.data,this.products=this.productosAll,this.products.forEach(e=>{this.marcas.includes(e.marca_pro)||this.marcas.push(e.marca_pro)})}).catch(i=>{console.log(i)})},cotizacionNew(){this.cotizacion={fecha:A().format("YYYY-MM-DD"),cliente:"",marca:"",producto:"",cantidad:0,medida:"Bar",zona:"",precio_compra_cf:0,precio_compra_sf:0,precio_venta_cf:0,precio_venta_sf:0,observacion:""},this.actionPeriodo="Nueva",this.cotizacionDialog=!0},cotizacionsGet(){this.loading=!0,this.$axios.get("cotizacions").then(i=>{this.cotizacions=i.data}).catch(i=>{this.$alert.error(i.response.data.message)}).finally(()=>{this.loading=!1})},cotizacionPost(){this.loading=!0,this.$axios.post("cotizacions",this.cotizacion).then(i=>{this.cotizacionsGet(),this.cotizacionDialog=!1,this.$alert.success("Cotizacion creada")}).catch(i=>{this.$alert.error(i.response.data.message)}).finally(()=>{this.loading=!1})},cotizacionPut(){this.loading=!0,this.$axios.put("cotizacions/"+this.cotizacion.id,this.cotizacion).then(i=>{this.cotizacionsGet(),this.cotizacionDialog=!1,this.$alert.success("Cotizacion actualizada")}).catch(i=>{this.$alert.error(i.response.data.message)}).finally(()=>{this.loading=!1})},cotizacionEdit(i){this.cotizacion={...i},this.actionPeriodo="Editar",this.cotizacionDialog=!0},cotizacionDelete(i){this.$alert.dialog("\xBFDesea eliminar la cotizacion?").onOk(()=>{this.loading=!0,this.$axios.delete("cotizacions/"+i).then(e=>{this.cotizacionsGet(),this.$alert.success("Cotizacion eliminada")}).catch(e=>{this.$alert.error(e.response.data.message)}).finally(()=>{this.loading=!1})})}}},M={class:"text-right"};function O(i,e,f,z,o,n){return u(),m(S,{class:"q-pa-md"},{default:t(()=>[a(w,{rows:o.cotizacions,columns:o.columns,dense:"","wrap-cells":"",flat:"",bordered:"","rows-per-page-options":[0],title:"Cotizacions",filter:o.filter},{"top-right":t(()=>[a(s,{icon:"download",color:"green",label:"Exportar",onClick:n.exportExcel,"no-caps":""},null,8,["onClick"]),a(s,{color:"primary",label:"Nuevo",onClick:n.cotizacionNew,outline:"","no-caps":"",icon:"add_circle_outline",loading:o.loading},null,8,["onClick","loading"]),a(c,{modelValue:o.filter,"onUpdate:modelValue":e[0]||(e[0]=l=>o.filter=l),label:"Buscar",dense:"",outlined:""},{append:t(()=>[a(p,{name:"search"})]),_:1},8,["modelValue"])]),"body-cell-actions":t(l=>[a(U,{props:l},{default:t(()=>[a(y,{label:"Opciones","no-caps":"",size:"10px",dense:"",color:"primary"},{default:t(()=>[a(k,null,{default:t(()=>[b((u(),m(v,{clickable:"",onClick:P=>n.cotizacionEdit(l.row)},{default:t(()=>[a(d,{avatar:""},{default:t(()=>[a(p,{name:"edit"})]),_:1}),a(d,null,{default:t(()=>[a(V,null,{default:t(()=>[g("Editar")]),_:1})]),_:1})]),_:2},1032,["onClick"])),[[C]]),b((u(),m(v,{clickable:"",onClick:P=>n.cotizacionDelete(l.row.id)},{default:t(()=>[a(d,{avatar:""},{default:t(()=>[a(p,{name:"delete"})]),_:1}),a(d,null,{default:t(()=>[a(V,null,{default:t(()=>[g("Eliminar")]),_:1})]),_:1})]),_:2},1032,["onClick"])),[[C]])]),_:2},1024)]),_:2},1024)]),_:2},1032,["props"])]),_:1},8,["rows","columns","filter"]),a(D,{modelValue:o.cotizacionDialog,"onUpdate:modelValue":e[16]||(e[16]=l=>o.cotizacionDialog=l),persistent:""},{default:t(()=>[a(Q,null,{default:t(()=>[a(_,{class:"q-pb-none row items-center"},{default:t(()=>[h("div",null,x(o.actionPeriodo)+" Cotizacion ",1),a(F),a(s,{icon:"close",flat:"",round:"",dense:"",onClick:e[1]||(e[1]=l=>o.cotizacionDialog=!1)})]),_:1}),a(_,{class:"q-pt-none"},{default:t(()=>[a(E,{onSubmit:e[15]||(e[15]=l=>o.cotizacion.id?n.cotizacionPut():n.cotizacionPost())},{default:t(()=>[a(c,{modelValue:o.cotizacion.fecha,"onUpdate:modelValue":e[2]||(e[2]=l=>o.cotizacion.fecha=l),label:"Fecha",dense:"",outlined:"",type:"date",disable:!0},null,8,["modelValue"]),a(r,{modelValue:o.cotizacion.cliente,"onUpdate:modelValue":[e[3]||(e[3]=l=>o.cotizacion.cliente=l),i.changeDirecionTelefono],onFilter:n.filterClientes,rules:[l=>!!l||"Seleccione un cliente"],filled:"","emit-value":"","map-options":"",standout:"","use-input":"",label:"Cliente",options:o.clientes,"option-value":"id","option-label":"nombre_cliente",dense:"",clearable:""},null,8,["modelValue","onFilter","onUpdate:modelValue","rules","options"]),a(r,{modelValue:o.cotizacion.marca,"onUpdate:modelValue":[e[4]||(e[4]=l=>o.cotizacion.marca=l),n.filterProducts],label:"Marca",dense:"",outlined:"","use-input":"",options:o.marcas},null,8,["modelValue","onUpdate:modelValue","options"]),a(r,{modelValue:o.cotizacion.producto,"onUpdate:modelValue":e[5]||(e[5]=l=>o.cotizacion.producto=l),label:"Producto",dense:"",outlined:"","use-input":"","option-label":"nombre_pro","option-value":"nombre_pro","emit-value":"","map-options":"",options:o.products},null,8,["modelValue","options"]),a(c,{modelValue:o.cotizacion.cantidad,"onUpdate:modelValue":e[6]||(e[6]=l=>o.cotizacion.cantidad=l),label:"Cantidad",type:"number",dense:"",outlined:"",rules:[l=>!!l||"Campo requerido"]},null,8,["modelValue","rules"]),a(r,{modelValue:o.cotizacion.medida,"onUpdate:modelValue":e[7]||(e[7]=l=>o.cotizacion.medida=l),filled:"",standout:"",label:"Medida",dense:"",outlined:"",options:[{label:"Bar",value:"bar"},{label:"Ton",value:"ton"},{label:"Kg",value:"kg"}],"option-value":"value","option-label":"label","emit-value":"","map-options":""},null,8,["modelValue"]),a(r,{modelValue:o.cotizacion.zona,"onUpdate:modelValue":e[8]||(e[8]=l=>o.cotizacion.zona=l),filled:"",standout:"",label:"Zona",dense:"",outlined:"",options:o.zonas,"option-value":"nombre_zona","option-label":"nombre_zona","emit-value":"","map-options":""},null,8,["modelValue","options"]),a(c,{modelValue:o.cotizacion.precio_compra_cf,"onUpdate:modelValue":e[9]||(e[9]=l=>o.cotizacion.precio_compra_cf=l),label:"Precio Compra CF",type:"number",dense:"",outlined:""},null,8,["modelValue"]),a(c,{modelValue:o.cotizacion.precio_compra_sf,"onUpdate:modelValue":e[10]||(e[10]=l=>o.cotizacion.precio_compra_sf=l),label:"Precio Compra SF",type:"number",dense:"",outlined:""},null,8,["modelValue"]),a(c,{modelValue:o.cotizacion.precio_venta_cf,"onUpdate:modelValue":e[11]||(e[11]=l=>o.cotizacion.precio_venta_cf=l),label:"Precio Venta CF",type:"number",dense:"",outlined:""},null,8,["modelValue"]),a(c,{modelValue:o.cotizacion.precio_venta_sf,"onUpdate:modelValue":e[12]||(e[12]=l=>o.cotizacion.precio_venta_sf=l),label:"Precio Venta SF",type:"number",dense:"",outlined:""},null,8,["modelValue"]),a(c,{modelValue:o.cotizacion.observacion,"onUpdate:modelValue":e[13]||(e[13]=l=>o.cotizacion.observacion=l),label:"Observaci\xF3n",dense:"",outlined:"",type:"textarea"},null,8,["modelValue"]),h("div",M,[a(s,{color:"negative",label:"Cancelar",onClick:e[14]||(e[14]=l=>o.cotizacionDialog=!1),"no-caps":"",loading:o.loading},null,8,["loading"]),a(s,{color:"primary",label:"Guardar",type:"submit","no-caps":"",loading:o.loading,class:"q-ml-sm"},null,8,["loading"])])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}var ie=N(G,[["render",O]]);export{ie as default};
