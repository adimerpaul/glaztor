import{T as p,a1 as f,W as t,V as a,aG as T,a3 as D,aF as S,aD as V,Y as s,aE as n,X as h,$ as g,U as F,_ as b,a5 as U,a2 as k,M as C,Z as d,aH as L}from"./index.8e5efdfb.js";import{Q as P,a as w}from"./QSelect.7f7f9668.js";import{a as z,d as E,Q}from"./format.7d90d4c2.js";import{Q as A}from"./QList.75259ae5.js";import{Q as O}from"./QPage.8f9149b4.js";import{Q as _}from"./QSpace.1f3d3d67.js";import{Q as I}from"./QMarkupTable.f4b57dd0.js";import{Q as Y}from"./QForm.4421addc.js";import{C as G}from"./ClosePopup.3be4487d.js";import{h as N}from"./moment.40bc58bf.js";import{E as M}from"./Excel.60733b5e.js";import{_ as R}from"./plugin-vue_export-helper.21dcd24c.js";import"./index.8bd2ab55.js";const $={name:"Pedidos",data(){return{loading:!1,dialog:!1,clientes:[],fechaInicio:N().format("YYYY-MM-DD"),fechaFin:N().format("YYYY-MM-DD"),zonas:[],pedidosLadrillo:[],pedidosLadrilloAll:[],estados:["PENDIENTE","ENTREGADO","ANULADO","REZAGO","TODOS"],estado:"TODOS",productos:[],pedido:{producto_id:null}}},mounted(){this.getZonas(),this.getPedidos(),this.getClientes(),this.getProductos()},methods:{exportExcel(){let e=[];this.pedidosLadrillo.forEach(i=>{i.detalles.forEach(m=>{var l;e.push({created_at:N(i.created_at).format("YYYY-MM-DD HH:mm:ss"),fecha:i.fecha,cliente:i.cliente,producto:m.producto.nombre_pro,cantidad:m.cantidad,precio:m.precio,subtotal:m.cantidad*m.precio,factura:i.factura,nombre_factura:i.nombre_factura,nit_factura:i.nit_factura,direccion:i.direccion,contacto:i.contacto,telefono:i.telefono,telefono2:i.telefono2,observacion:i.observacion,chofer:i.chofer,zona:i.zona,total:i.total,estado:i.estado,fecha_pago:i.fecha_pago,user:(l=i.user)==null?void 0:l.name})})});let r=[{sheet:"Pedidos",columns:[{label:"Fecha del pedido",value:"created_at"},{label:"Fecha de Entrega",value:"fecha"},{label:"Cliente",value:"cliente"},{label:"Producto",value:"producto"},{label:"Cantidad",value:"cantidad"},{label:"Precio",value:"precio"},{label:"Subtotal",value:"subtotal"},{label:"Factura",value:"factura"},{label:"Nombre Factura",value:"nombre_factura"},{label:"Nit Factura",value:"nit_factura"},{label:"Direccion",value:"direccion"},{label:"Contacto",value:"contacto"},{label:"Telefono",value:"telefono"},{label:"Telefono2",value:"telefono2"},{label:"Observacion",value:"observacion"},{label:"Chofer",value:"chofer"},{label:"Zona",value:"zona"},{label:"Total",value:"total"},{label:"Estado",value:"estado"},{label:"Fecha Pago",value:"fecha_pago"},{label:"User",value:"user"}],content:e}];M.export(r,"Reporte de Pedidos")},getZonas(){this.$axios.get("zonas").then(e=>{this.zonas=e.data}).catch(e=>{console.log(e)})},showPreventa(e){this.pedido={...e},this.dialog=!0},submit(){this.loading=!0,this.$axios.put("pedidosLadrillo/"+this.pedido.id,this.pedido).then(e=>{this.dialog=!1,this.$alert.success("Pedido actualizado correctamente"),this.getPedidos()}).catch(e=>{console.log(e),this.$alert.error("Error al actualizar el pedido")}).finally(()=>{this.loading=!1})},getProductos(){this.$axios.get("productos").then(e=>{this.productos=e.data}).catch(e=>{console.log(e)})},getClientes(){this.$axios.get("clientes").then(e=>{this.clientes=e.data}).catch(e=>{console.log(e)})},addPedido(){this.$router.push("pedidosLadrilloPage")},getPedidosFilter(){console.log(this.estado),this.estado==="TODOS"?this.pedidosLadrillo=this.pedidosLadrilloAll:this.pedidosLadrillo=this.pedidosLadrilloAll.filter(e=>e.estado===this.estado)},getPedidos(){this.loading=!0,this.$axios.get("pedidosLadrillo",{params:{fechaInicio:this.fechaInicio,fechaFin:this.fechaFin}}).then(e=>{this.pedidosLadrillo=e.data,this.pedidosLadrilloAll=e.data,this.loading=!1}).catch(e=>{console.log(e),this.loading=!1})}},computed:{esMovil(){return this.$q.screen.lt.md}}},q={class:"row"},Z=s("div",{class:"col-12 bg-orange text-white q-pa-xs text-bold text-center"}," Pedidos Ladrillo ",-1),B={class:"col-6 col-md-2"},H={class:"col-6 col-md-2"},x={class:"col-6 col-md-2 text-left"},W={class:"col-6 col-md-2 text-left"},X={class:"col-6 col-md-2 text-right"},j={class:"col-6 col-md-2 text-right"},J={class:"text-h6"},K={class:"text-bold q-pa-xs"},ee=s("label",null,"Total",-1),oe=s("thead",null,[s("tr",null,[s("th",null,"Producto"),s("th",null,"Cantidad"),s("th",null,"Precio"),s("th",null,"Subtotal")])],-1),le=["onUpdate:modelValue"],te=["onUpdate:modelValue"],re=s("td",{colspan:"3",class:"text-right"},"Total",-1),se={class:"text-bold"},ae={key:0},ie={colspan:"4"};function de(e,r,i,m,l,c){return p(),f(D,null,[t(O,{class:"bg-grey-3 q-pa-xs"},{default:a(()=>[t(S,null,{default:a(()=>[t(V,{class:"q-pa-xs"},{default:a(()=>[s("div",q,[Z,s("div",B,[t(n,{outlined:"",modelValue:l.fechaInicio,"onUpdate:modelValue":r[0]||(r[0]=o=>l.fechaInicio=o),label:"Fecha Inicio",type:"date",color:"white",dense:""},null,8,["modelValue"])]),s("div",H,[t(n,{outlined:"",modelValue:l.fechaFin,"onUpdate:modelValue":r[1]||(r[1]=o=>l.fechaFin=o),label:"Fecha Fin",type:"date",color:"white",dense:""},null,8,["modelValue"])]),s("div",x,[t(h,{icon:"search",color:"primary",label:"Buscar",onClick:c.getPedidos,loading:l.loading,"no-caps":""},null,8,["onClick","loading"])]),s("div",W,[t(P,{modelValue:l.estado,"onUpdate:modelValue":[r[2]||(r[2]=o=>l.estado=o),c.getPedidosFilter],label:"Estado",outlined:"",dense:"",options:l.estados},{after:a(()=>[t(g,{name:"check_circle",color:l.estado==="PENDIENTE"?"red":l.estado==="ENTREGADO"?"green":l.estado==="REZAGO"?"blue":"orange"},null,8,["color"])]),_:1},8,["modelValue","options","onUpdate:modelValue"])]),s("div",X,[t(h,{icon:"get_app",color:"green",label:"Excel",onClick:c.exportExcel,loading:l.loading,"no-caps":""},null,8,["onClick","loading"])]),s("div",j,[t(h,{icon:"add_circle_outline",color:"green",label:"Nuevo Pedido",onClick:c.addPedido,loading:l.loading,"no-caps":""},null,8,["onClick","loading"])])])]),_:1})]),_:1}),t(V,{class:"q-pa-none"},{default:a(()=>[t(A,{dense:"",class:"rounded-borders"},{default:a(()=>[l.pedidosLadrillo.length===0?(p(),F(Q,{key:0},{default:a(()=>[t(z,null,{default:a(()=>[t(E,{class:"text-h6 text-grey"},{default:a(()=>[b("No hay pedidosLadrillo")]),_:1})]),_:1})]),_:1})):U("",!0),(p(!0),f(D,null,k(l.pedidosLadrillo,o=>(p(),F(Q,{key:o.id,onClick:u=>c.showPreventa(o),clickable:"",class:"q-my-sm bg-white hover-bg-light-blue",style:{border:"1px solid #e0e0e0","border-radius":"8px"}},{default:a(()=>[t(z,null,{default:a(()=>[t(E,{class:"text-h6"},{default:a(()=>[b(d(o.fecha.substring(0,10)||"Sin propietario")+" ",1),t(g,{name:"check_circle",color:o.estado==="PENDIENTE"?"red":o.estado==="ENTREGADO"?"green":o.estado==="REZAGO"?"blue":"orange"},null,8,["color"])]),_:2},1024),t(E,{class:"text-subtitle1 text-grey"},{default:a(()=>[b(d(o.direccion)+" ",1),t(w,null,{default:a(()=>[b(d(o.total),1)]),_:2},1024)]),_:2},1024),t(E,{class:"text-caption text-positive"},{default:a(()=>{var u;return[b(d(o.cliente)+" - "+d(o.tipo_construccion)+" - "+d((u=o.user)==null?void 0:u.name)+" - "+d(o.fecha),1)]}),_:2},1024)]),_:2},1024),t(z,{side:""},{default:a(()=>[t(g,{name:"arrow_forward"})]),_:1})]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1})]),_:1}),t(T,{modelValue:l.dialog,"onUpdate:modelValue":r[14]||(r[14]=o=>l.dialog=o),position:c.esMovil?void 0:"right",maximized:!0,"transition-show":"slide-left","transition-hide":"slide-right"},{default:a(()=>[t(S,{style:{width:"450px","max-width":"100vw"}},{default:a(()=>[t(V,{class:"row items-center q-px-md bg-primary text-white q-px-none"},{default:a(()=>[C(t(h,{flat:"",round:"",dense:"",icon:"fa-solid fa-arrow-left"},null,512),[[G]]),t(_),s("div",J,d(l.pedido.id?"Editar":"Nuevo")+" Pedido",1)]),_:1}),t(V,null,{default:a(()=>[t(Y,{onSubmit:c.submit,disable:e.$store.user.role=="Ventas"||e.$store.user.role=="Cobranza"||e.$store.user.role=="Director"||e.$store.user.role=="Supervisor"},{default:a(()=>[t(n,{modelValue:l.pedido.fecha,"onUpdate:modelValue":r[3]||(r[3]=o=>l.pedido.fecha=o),label:"Fecha",outlined:"",disable:e.$store.user.role=="Ventas"||e.$store.user.role=="Cobranza"||e.$store.user.role=="Director"||e.$store.user.role=="Supervisor",dense:"",type:"date"},null,8,["modelValue","disable"]),t(n,{modelValue:l.pedido.cliente,"onUpdate:modelValue":r[4]||(r[4]=o=>l.pedido.cliente=o),label:"Cliente",outlined:"",disable:e.$store.user.role=="Ventas"||e.$store.user.role=="Cobranza"||e.$store.user.role=="Director"||e.$store.user.role=="Supervisor",dense:""},null,8,["modelValue","disable"]),t(n,{modelValue:l.pedido.nombre_factura,"onUpdate:modelValue":r[5]||(r[5]=o=>l.pedido.nombre_factura=o),label:"Nombre Factura",outlined:"",disable:e.$store.user.role=="Ventas"||e.$store.user.role=="Cobranza"||e.$store.user.role=="Director"||e.$store.user.role=="Supervisor",dense:""},null,8,["modelValue","disable"]),t(n,{modelValue:l.pedido.nit_factura,"onUpdate:modelValue":r[6]||(r[6]=o=>l.pedido.nit_factura=o),label:"Nit Factura",outlined:"",disable:e.$store.user.role=="Ventas"||e.$store.user.role=="Cobranza"||e.$store.user.role=="Director"||e.$store.user.role=="Supervisor",dense:""},null,8,["modelValue","disable"]),t(n,{modelValue:l.pedido.direccion,"onUpdate:modelValue":r[7]||(r[7]=o=>l.pedido.direccion=o),label:"Direccion",outlined:"",disable:e.$store.user.role=="Ventas"||e.$store.user.role=="Cobranza"||e.$store.user.role=="Director"||e.$store.user.role=="Supervisor",dense:""},null,8,["modelValue","disable"]),t(n,{modelValue:l.pedido.contacto,"onUpdate:modelValue":r[8]||(r[8]=o=>l.pedido.contacto=o),label:"Contacto",outlined:"",disable:e.$store.user.role=="Ventas"||e.$store.user.role=="Cobranza"||e.$store.user.role=="Director"||e.$store.user.role=="Supervisor",dense:""},null,8,["modelValue","disable"]),t(n,{modelValue:l.pedido.telefono,"onUpdate:modelValue":r[9]||(r[9]=o=>l.pedido.telefono=o),label:"Telefono",outlined:"",disable:e.$store.user.role=="Ventas"||e.$store.user.role=="Cobranza"||e.$store.user.role=="Director"||e.$store.user.role=="Supervisor",dense:""},null,8,["modelValue","disable"]),t(n,{type:"textarea",modelValue:l.pedido.observacion,"onUpdate:modelValue":r[10]||(r[10]=o=>l.pedido.observacion=o),label:"Observacion",outlined:"",disable:e.$store.user.role=="Ventas"||e.$store.user.role=="Cobranza"||e.$store.user.role=="Director"||e.$store.user.role=="Supervisor",dense:""},null,8,["modelValue","disable"]),t(n,{modelValue:l.pedido.chofer,"onUpdate:modelValue":r[11]||(r[11]=o=>l.pedido.chofer=o),label:"chofer",outlined:"",disable:e.$store.user.role=="Ventas"||e.$store.user.role=="Cobranza"||e.$store.user.role=="Director"||e.$store.user.role=="Supervisor",dense:""},null,8,["modelValue","disable"]),t(P,{modelValue:l.pedido.zona,"onUpdate:modelValue":r[12]||(r[12]=o=>l.pedido.zona=o),label:"zonas",outlined:"",disable:e.$store.user.role=="Ventas"||e.$store.user.role=="Cobranza"||e.$store.user.role=="Director"||e.$store.user.role=="Supervisor",dense:"",options:l.zonas,"emit-value":"","map-options":"","option-label":"nombre_zona","option-value":"nombre_zona"},null,8,["modelValue","disable","options"]),t(P,{modelValue:l.pedido.estado,"onUpdate:modelValue":r[13]||(r[13]=o=>l.pedido.estado=o),label:"Estado",outlined:"",disable:e.$store.user.role=="Ventas"||e.$store.user.role=="Cobranza"||e.$store.user.role=="Director"||e.$store.user.role=="Supervisor",dense:"",options:["PENDIENTE","ENTREGADO","ANULADO","REZAGO"]},{after:a(()=>[t(g,{name:"check_circle",color:l.pedido.estado==="PENDIENTE"?"red":l.pedido.estado==="ENTREGADO"?"green":l.pedido.estado==="REZAGO"?"blue":"orange"},null,8,["color"])]),_:1},8,["modelValue","disable"]),s("div",K,[ee,s("div",null,d(l.pedido.total),1)]),t(I,{dense:"",flat:"",bordered:"","wrap-cells":""},{default:a(()=>[oe,s("tbody",null,[(p(!0),f(D,null,k(l.pedido.detalles,o=>{var u,y;return p(),f("tr",{key:o.id},[s("td",null,[t(g,{name:"delete",onClick:v=>e.sales.splice(e.sales.indexOf(o),1),class:"cursor-pointer",color:"red"},null,8,["onClick"]),b(" "+d((u=o.producto)==null?void 0:u.nombre_pro)+" "+d((y=o.producto)==null?void 0:y.marca_pro),1)]),s("td",null,[C(s("input",{"onUpdate:modelValue":v=>o.cantidad=v,type:"number",style:{width:"50px"},step:"0.01"},null,8,le),[[L,o.cantidad]])]),s("td",null,[C(s("input",{"onUpdate:modelValue":v=>o.precio=v,type:"number",style:{width:"70px"},step:"0.01"},null,8,te),[[L,o.precio]])]),s("td",null,d((o.cantidad*o.precio).toFixed(2)),1)])}),128))]),s("tfoot",null,[s("tr",null,[re,s("td",se,d(l.pedido.detalles.reduce((o,u)=>o+u.cantidad*u.precio,0).toFixed(2)),1)]),e.$store.user.role==="Administrador"||e.$store.user.role==="Admin"?(p(),f("tr",ae,[s("td",ie,[t(h,{"no-caps":"",class:"full-width",color:"blue",loading:l.loading,type:"submit",label:"Actualizar pedido"},null,8,["loading"])])])):U("",!0)])]),_:1})]),_:1},8,["onSubmit","disable"])]),_:1})]),_:1})]),_:1},8,["modelValue","position"])],64)}var Ce=R($,[["render",de]]);export{Ce as default};
