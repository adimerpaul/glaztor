import{R as s,$ as r,U as d,T as i,aD as Q,a1 as p,W as o,aC as g,aA as _,aB as c,X as v,V,a0 as C,Y as f,Z as a,aE as B,M as x,a2 as A,aF as k}from"./index.472f576f.js";import{Q as z}from"./QImg.c7b7002d.js";import{Q as w}from"./QSpace.20423384.js";import{Q as y}from"./QSelect.fd622edb.js";import{Q as P}from"./QMarkupTable.c2413f0d.js";import{Q as T}from"./QPage.76eee91d.js";import{Q as D}from"./QForm.404e5d76.js";import{C as q}from"./ClosePopup.69a8fe43.js";import{h as U}from"./moment.40bc58bf.js";import{_ as F}from"./plugin-vue_export-helper.21dcd24c.js";import"./format.6802d7a4.js";const S={name:"Pedidos",data(){return{loading:!1,filter:"",clientes:[],clientesAll:[],productos:[],productosAll:[],zonas:[],sales:[],pedido:{},dialogPedido:!1}},mounted(){this.getClientes(),this.getProductos(),this.getZonas()},methods:{openCalculate(t){console.log(t);let l=0;t.tipo_pro==="BA"?l=t.cantidadVenta*t.precioVenta:l=t.cantidadVenta*t.precioVenta*t.producto.tonelada,this.$q.dialog({title:"Calcular",message:"Ingrese el total de toneladas",prompt:{model:l,type:"text"},cancel:!0,persistent:!0}).onOk(b=>{let h=0;t.tipo_pro==="BA"?h=t.cantidadVenta:h=t.cantidadVenta*t.producto.tonelada,t.precioVenta=b/h}).onCancel(()=>{}).onDismiss(()=>{})},getZonas(){this.$axios.get("zonas").then(t=>{this.zonas=t.data}).catch(t=>{console.log(t)})},filterClientes(t,l){if(t===""){l(()=>{this.clientes=this.clientesAll});return}const b=t.toLowerCase();l(()=>{this.clientes=this.clientesAll.filter(h=>h.nombre_cliente.toLowerCase().indexOf(b)>-1)})},submit(){this.loading=!0,this.$axios.post("pedidos",{...this.pedido,detalles:this.sales.map(t=>({id:t.producto.id,cantidadVenta:t.cantidadVenta,precioVenta:t.precioVenta,tipo_pro:t.tipo_pro}))}).then(t=>{this.$alert.success("Pedido guardado"),this.dialogPedido=!1,this.sales=[],this.$router.push("/pedidos")}).catch(t=>{console.log(t),this.$alert.error(t.response.data.message)}).finally(()=>{this.loading=!1})},dialogPedidoClick(){if(this.sales.length===0)return this.$alert.error("No hay productos en el carrito"),!1;this.dialogPedido=!0,this.pedido={fecha_hora:U().format("YYYY-MM-DD"),nombre_factura:"",nit_factura:"",contacto:"",direccion:"",telefono:"",telefono2:"",fecha_pago:U().format("YYYY-MM-DD"),observacion:""}},changeDirecionTelefono(){const t=this.clientes.find(l=>l.id===this.pedido.cliente_id);this.pedido.direccion=t.direccion,this.pedido.telefono=t.telefono_1,this.pedido.telefono2=t.telefono_2,this.pedido.contacto=t.nombre_cliente},agregarProducto(t){if(parseInt(t.cantidad_pro)===0)return this.$alert.error("Producto sin stock"),!1;this.sales.push({producto:t,cantidadVenta:1,precioVenta:t.precio_pro,tipo_pro:"BA"})},filterProductos(){this.productos=this.productosAll.filter(t=>t.nombre_pro.toLowerCase().includes(this.filter.toLowerCase())||t.marca_pro.toLowerCase().includes(this.filter.toLowerCase()))},getProductos(){this.$axios.get("productos").then(t=>{this.productos=t.data,this.productosAll=t.data}).catch(t=>{console.log(t)})},getClientes(){this.$axios.get("clientes").then(t=>{this.clientes=t.data,this.clientesAll=t.data}).catch(t=>{console.log(t)})}},computed:{esMovil(){return this.$q.screen.lt.md},totalVenta(){let t=0;return this.sales.forEach(l=>{l.tipo_pro==="BA"?t+=l.cantidadVenta*l.precioVenta:t+=l.cantidadVenta*l.precioVenta*l.producto.tonelada}),t}}},Y={class:"row"},L={class:"col-12 col-md-7 q-pa-xs"},M={class:"row"},N={class:"col-12"},I={class:"absolute-bottom",style:{padding:"0",margin:"0"}},R={class:"row items-center",style:{"font-size":"9px"}},E={style:{display:"flex","justify-content":"space-between","font-size":"12px"}},O={class:"col-12 col-md-5 q-pa-xs"},Z={class:"row items-center"},j=o("thead",null,[o("tr",null,[o("th",null,"Producto"),o("th",null,"Tipo"),o("th",null,"Cant."),o("th",null,"Cant. Real"),o("th",null,"Precio"),o("th",null,"Subtotal")])],-1),G=["onUpdate:modelValue"],W=["onUpdate:modelValue"],X=o("td",{colspan:"3",class:"text-right text-bold"},"Total",-1),H={class:"text-bold"},J={colspan:"4"},K={class:"row items-center"},$=o("div",{class:"text-h6"},"Realizar pedido",-1),ee={class:"row"},oe={class:"col-12 col-md-6"},te={class:"col-12 col-md-6"},le={class:"col-12 col-md-3"},de={class:"col-12 col-md-3"},ne={class:"col-12 col-md-3"},ie={class:"col-12 col-md-3"},ae={class:"col-12 col-md-4"},se={class:"col-12 col-md-4"},re={class:"col-12 col-md-4"},ce={class:"col-12"},ue={class:"col-12"},pe=o("thead",null,[o("tr",null,[o("th",null,"Producto"),o("th",null,"Cantidad"),o("th",null,"Precio"),o("th",null,"Subtotal")])],-1),me=o("td",{colspan:"3",class:"text-right"},"Total",-1),fe={class:"text-bold"};function he(t,l,b,h,n,u){return s(),r(p,null,[d(T,{class:"bg-grey-3 q-pa-xs"},{default:i(()=>[o("div",Y,[o("div",L,[d(g,{flat:"",bordered:""},{default:i(()=>[d(_,{class:"q-pa-xs"},{default:i(()=>[o("div",M,[o("div",N,[d(c,{modelValue:n.filter,"onUpdate:modelValue":[l[1]||(l[1]=e=>n.filter=e),u.filterProductos],filled:"",standout:"",placeholder:"Buscar producto",dense:"",clearable:""},{prepend:i(()=>[d(v,{name:"search"})]),before:i(()=>[d(V,{flat:"",round:"",dense:"",icon:"arrow_back",onClick:l[0]||(l[0]=e=>this.$router.push("/pedidos"))})]),_:1},8,["modelValue","onUpdate:modelValue"])]),(s(!0),r(p,null,C(n.productos,e=>(s(),r("div",{class:"col-4 col-md-3",key:e.id},[d(g,{flat:"",bordered:"",class:"q-ma-xs cursor-pointer",onClick:m=>u.agregarProducto(e)},{default:i(()=>[d(_,{class:"q-pa-none"},{default:i(()=>[d(z,{src:t.$url+".."+e.foto_pro,alt:e.nombre_pro,class:"full-width",style:{height:"130px"}},{default:i(()=>[o("div",I,[o("div",R,[o("div",null,a(e.nombre_pro),1),o("div",null,a(e.marca_pro),1)]),o("div",E,[o("div",null,a(e.precio_pro)+" Bs. ",1),o("div",{class:A("text-bold "+(e.cantidad_pro=="0"?"text-negative":"text-positive"))},a(e.cantidad_pro),3)])])]),_:2},1032,["src","alt"])]),_:2},1024)]),_:2},1032,["onClick"])]))),128))])]),_:1})]),_:1})]),o("div",O,[d(g,{flat:"",bordered:""},{default:i(()=>[d(_,{class:"q-pa-xs"},{default:i(()=>[o("div",Z,[f(" Carrito de compras "),d(w),d(V,{dense:"",flat:"",color:"red",icon:"delete",label:"Limpiar",onClick:l[2]||(l[2]=e=>n.sales=[]),"no-caps":""})]),d(P,{dense:"",flat:"",bordered:"","wrap-cells":""},{default:i(()=>[j,o("tbody",null,[(s(!0),r(p,null,C(n.sales,e=>(s(),r("tr",{key:e.producto.id},[o("td",null,[d(v,{name:"delete",onClick:m=>n.sales.splice(n.sales.indexOf(e),1),class:"cursor-pointer",color:"red"},null,8,["onClick"]),f(" "+a(e.producto.nombre_pro)+" "+a(e.producto.marca_pro),1)]),o("td",null,[d(y,{modelValue:e.tipo_pro,"onUpdate:modelValue":m=>e.tipo_pro=m,filled:"",dense:"",options:["BA","TN"]},null,8,["modelValue","onUpdate:modelValue"])]),o("td",null,[x(o("input",{"onUpdate:modelValue":m=>e.cantidadVenta=m,type:"number",style:{width:"50px"},filled:""},null,8,G),[[k,e.cantidadVenta]])]),o("td",null,[e.tipo_pro=="BA"?(s(),r(p,{key:0},[f(a(e.cantidadVenta),1)],64)):(s(),r(p,{key:1},[f(a(e.cantidadVenta*e.producto.tonelada),1)],64))]),o("td",null,[x(o("input",{"onUpdate:modelValue":m=>e.precioVenta=m,type:"number",style:{width:"70px"},filled:""},null,8,W),[[k,e.precioVenta]])]),o("td",null,[e.tipo_pro=="BA"?(s(),r(p,{key:0},[f(a((e.cantidadVenta*e.precioVenta).toFixed(2)),1)],64)):(s(),r(p,{key:1},[f(a((e.cantidadVenta*e.precioVenta*e.producto.tonelada).toFixed(2)),1)],64)),d(v,{name:"calculate",onClick:m=>u.openCalculate(e),class:"cursor-pointer",color:"primary"},null,8,["onClick"])])]))),128))]),o("tfoot",null,[o("tr",null,[X,o("td",H,[n.sales.length>0?(s(),r(p,{key:0},[f(a(u.totalVenta)+" Bs ",1)],64)):B("",!0)])]),o("tr",null,[o("td",J,[d(V,{"no-caps":"",class:"full-width",icon:"save",color:"positive",label:"Realizar pedido",onClick:u.dialogPedidoClick},null,8,["onClick"])])])])]),_:1})]),_:1})]),_:1})])])]),_:1}),d(Q,{modelValue:n.dialogPedido,"onUpdate:modelValue":l[14]||(l[14]=e=>n.dialogPedido=e)},{default:i(()=>[d(g,{style:{width:"650px","max-width":"90vw"}},{default:i(()=>[d(_,{class:"bg-primary text-white q-pb-none"},{default:i(()=>[o("div",K,[$,d(w),x(d(V,{flat:"",round:"",dense:"",icon:"close"},null,512),[[q]])])]),_:1}),d(_,{class:"q-mt-none"},{default:i(()=>[d(D,{onSubmit:u.submit},{default:i(()=>[o("div",ee,[o("div",oe,[d(y,{modelValue:n.pedido.cliente_id,"onUpdate:modelValue":[l[3]||(l[3]=e=>n.pedido.cliente_id=e),u.changeDirecionTelefono],onFilter:u.filterClientes,rules:[e=>!!e||"Seleccione un cliente"],filled:"","emit-value":"","map-options":"",standout:"","use-input":"",label:"Cliente",options:n.clientes,"option-value":"id","option-label":"nombre_cliente",dense:"",clearable:""},null,8,["modelValue","onFilter","onUpdate:modelValue","rules","options"])]),o("div",te,[d(c,{modelValue:n.pedido.direccion,"onUpdate:modelValue":l[4]||(l[4]=e=>n.pedido.direccion=e),filled:"",standout:"",label:"Direcci\xF3n",dense:"",hint:""},null,8,["modelValue"])]),o("div",le,[d(c,{modelValue:n.pedido.telefono,"onUpdate:modelValue":l[5]||(l[5]=e=>n.pedido.telefono=e),filled:"",standout:"",label:"Tel\xE9fono",dense:"",hint:""},null,8,["modelValue"])]),o("div",de,[d(c,{modelValue:n.pedido.telefono2,"onUpdate:modelValue":l[6]||(l[6]=e=>n.pedido.telefono2=e),filled:"",standout:"",label:"Tel\xE9fono 2",dense:"",hint:""},null,8,["modelValue"])]),o("div",ne,[d(c,{modelValue:n.pedido.fecha_hora,"onUpdate:modelValue":l[7]||(l[7]=e=>n.pedido.fecha_hora=e),filled:"",standout:"",label:"Fecha de Entrega",type:"date",dense:""},null,8,["modelValue"])]),o("div",ie,[d(c,{modelValue:n.pedido.nombre_factura,"onUpdate:modelValue":l[8]||(l[8]=e=>n.pedido.nombre_factura=e),filled:"",standout:"",label:"Nombre factura",dense:"",hint:""},null,8,["modelValue"])]),o("div",ae,[d(c,{modelValue:n.pedido.nit_factura,"onUpdate:modelValue":l[9]||(l[9]=e=>n.pedido.nit_factura=e),filled:"",standout:"",label:"NIT factura",dense:"",hint:""},null,8,["modelValue"])]),o("div",se,[d(c,{modelValue:n.pedido.fecha_pago,"onUpdate:modelValue":l[10]||(l[10]=e=>n.pedido.fecha_pago=e),filled:"",type:"date",standout:"",label:"Fecha de pago",dense:""},null,8,["modelValue"])]),o("div",re,[d(y,{modelValue:n.pedido.zona_id,"onUpdate:modelValue":l[11]||(l[11]=e=>n.pedido.zona_id=e),filled:"",standout:"",label:"Zona",options:n.zonas,"option-value":"nombre_zona","option-label":"nombre_zona","emit-value":"","map-options":"",rules:[e=>!!e||"Seleccione una zona"],dense:""},null,8,["modelValue","options","rules"])]),o("div",ce,[d(c,{modelValue:n.pedido.contacto,"onUpdate:modelValue":l[12]||(l[12]=e=>n.pedido.contacto=e),filled:"",standout:"",label:"Contacto",dense:"",hint:""},null,8,["modelValue"])]),o("div",ue,[d(c,{modelValue:n.pedido.observacion,"onUpdate:modelValue":l[13]||(l[13]=e=>n.pedido.observacion=e),filled:"",standout:"",label:"Observaci\xF3n",dense:"",hint:""},null,8,["modelValue"])])]),d(P,{dense:"",flat:"",bordered:"","wrap-cells":""},{default:i(()=>[pe,o("tbody",null,[(s(!0),r(p,null,C(n.sales,e=>(s(),r("tr",{key:e.producto.id},[o("td",null,a(e.producto.nombre_pro),1),o("td",null,a(e.cantidadVenta),1),o("td",null,a(e.precioVenta),1),o("td",null,a((e.cantidadVenta*e.precioVenta).toFixed(2)),1)]))),128))]),o("tfoot",null,[o("tr",null,[me,o("td",fe,a(u.totalVenta)+" Bs ",1)])])]),_:1}),d(V,{loading:n.loading,"no-caps":"",class:"full-width",icon:"save",color:"positive",label:"Guardar pedido",type:"submit"},null,8,["loading"])]),_:1},8,["onSubmit"])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64)}var Ue=F(S,[["render",he]]);export{Ue as default};
