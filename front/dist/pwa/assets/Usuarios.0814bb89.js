import{$ as n,a0 as u,a1 as o,a2 as s,a3 as m,aH as d,F as p,C as f,a6 as g,aI as D,aG as Q,a4 as w,a5 as x,aK as P,aJ as _}from"./index.9c72f88d.js";import{Q as h,b as i,a as b}from"./format.89ba0050.js";import{Q as U}from"./QList.12c1a32d.js";import{Q as y}from"./QBtnDropdown.6f220dc2.js";import{Q as v}from"./QTd.bd37c471.js";import{a as G,Q as k}from"./QSelect.d21464ce.js";import{Q as E}from"./QTable.4e618a11.js";import{Q as N}from"./QSpace.41e1f98e.js";import{Q as q}from"./QForm.a9dcb4d2.js";import{Q as z}from"./QPage.215302fc.js";import{C as V}from"./ClosePopup.49e3c41f.js";import"./moment.40bc58bf.js";import{_ as S}from"./plugin-vue_export-helper.21dcd24c.js";import"./QBtnGroup.33606e46.js";import"./QMarkupTable.cfe36cec.js";const I={name:"UsuariosPage",data(){return{users:[],user:{},userDialog:!1,loading:!1,actionPeriodo:"",gestiones:[],filter:"",columns:[{name:"actions",label:"Acciones",align:"center"},{name:"name",label:"Nombre",align:"left",field:"name"},{name:"username",label:"Usuario",align:"left",field:"username"},{name:"role",label:"Rol",align:"left",field:"role"},{name:"email",label:"Email",align:"left",field:"email"},{name:"empresa",label:"Empresa",align:"left",field:"empresa"}],roles:["Administrador","Director","Ventas","Cobranza","Supervisor"]}},mounted(){this.usersGet()},methods:{colorGet(a){switch(a){case"Administrador":return"red";case"Director":return"blue";case"Ventas":return"green";case"Cobranza":return"orange";case"Supervisor":return"purple"}},areasGet(){this.loading=!0,this.$axios.get("areas").then(a=>{this.areas=a.data}).catch(a=>{this.$alert.error(a.response.data.message)}).finally(()=>{this.loading=!1})},userNew(){this.user={name:"",email:"",password:"",area_id:1,username:"",cargo:"",role:"Ventas",empresa:"Glaztor"},this.actionPeriodo="Nuevo",this.userDialog=!0},usersGet(){this.loading=!0,this.$axios.get("users").then(a=>{this.users=a.data}).catch(a=>{this.$alert.error(a.response.data.message)}).finally(()=>{this.loading=!1})},gestionGet(){this.loading=!0,this.$axios.get("gestiones").then(a=>{this.gestiones=a.data,this.loading=!1}).catch(a=>{this.$alert.error(a.response.data.message),this.loading=!1})},userPost(){this.loading=!0,this.$axios.post("users",this.user).then(a=>{this.usersGet(),this.userDialog=!1,this.$alert.success("Usuario creado")}).catch(a=>{this.$alert.error(a.response.data.message)}).finally(()=>{this.loading=!1})},userPut(){this.loading=!0,this.$axios.put("users/"+this.user.id,this.user).then(a=>{this.usersGet(),this.userDialog=!1,this.$alert.success("Usuario actualizado")}).catch(a=>{this.$alert.error(a.response.data.message)}).finally(()=>{this.loading=!1})},userEditPassword(a){this.user={...a},this.$alert.dialogPrompt("Nueva contrase\xF1a","Ingrese la nueva contrase\xF1a","password").onOk(r=>{this.$axios.put("updatePassword/"+a.id,{password:r}).then(c=>{this.usersGet(),this.$alert.success("Contrase\xF1a actualizada")}).catch(c=>{this.$alert.error(c.response.data.message)})})},userEdit(a){this.user={...a},this.actionPeriodo="Editar",this.userDialog=!0},userDelete(a){this.$alert.dialog("\xBFDesea eliminar el user?").onOk(()=>{this.loading=!0,this.$axios.delete("users/"+a).then(r=>{this.usersGet(),this.$alert.success("Periodo eliminado")}).catch(r=>{this.$alert.error(r.response.data.message)}).finally(()=>{this.loading=!1})})}}},B={class:"text-right"};function A(a,r,c,O,l,t){return n(),u(z,{class:"q-pa-md"},{default:o(()=>[s(E,{rows:l.users,columns:l.columns,dense:"","wrap-cells":"",flat:"",bordered:"","rows-per-page-options":[0],title:"Usuarios",filter:l.filter},{"top-right":o(()=>[s(m,{color:"primary",label:"Nuevo",onClick:t.userNew,outline:"","no-caps":"",icon:"add_circle_outline",loading:l.loading},null,8,["onClick","loading"]),s(d,{modelValue:l.filter,"onUpdate:modelValue":r[0]||(r[0]=e=>l.filter=e),label:"Buscar",dense:"",outlined:""},{append:o(()=>[s(p,{name:"search"})]),_:1},8,["modelValue"])]),"body-cell-actions":o(e=>[s(v,{props:e},{default:o(()=>[s(y,{label:"Opciones","no-caps":"",size:"10px",dense:"",color:"primary"},{default:o(()=>[s(U,null,{default:o(()=>[f((n(),u(h,{clickable:"",onClick:C=>t.userEdit(e.row)},{default:o(()=>[s(i,{avatar:""},{default:o(()=>[s(p,{name:"edit"})]),_:1}),s(i,null,{default:o(()=>[s(b,null,{default:o(()=>[g("Editar")]),_:1})]),_:1})]),_:2},1032,["onClick"])),[[V]]),f((n(),u(h,{clickable:"",onClick:C=>t.userDelete(e.row.id)},{default:o(()=>[s(i,{avatar:""},{default:o(()=>[s(p,{name:"delete"})]),_:1}),s(i,null,{default:o(()=>[s(b,null,{default:o(()=>[g("Eliminar")]),_:1})]),_:1})]),_:2},1032,["onClick"])),[[V]]),f((n(),u(h,{clickable:"",onClick:C=>t.userEditPassword(e.row)},{default:o(()=>[s(i,{avatar:""},{default:o(()=>[s(p,{name:"edit"})]),_:1}),s(i,null,{default:o(()=>[s(b,null,{default:o(()=>[g("Cambiar contrase\xF1a")]),_:1})]),_:1})]),_:2},1032,["onClick"])),[[V]])]),_:2},1024)]),_:2},1024)]),_:2},1032,["props"])]),"body-cell-role":o(e=>[s(v,{props:e},{default:o(()=>[s(G,{label:e.row.role,color:t.colorGet(e.row.role),"text-color":"white",dense:"",size:"10px"},null,8,["label","color"])]),_:2},1032,["props"])]),_:1},8,["rows","columns","filter"]),s(_,{modelValue:l.userDialog,"onUpdate:modelValue":r[10]||(r[10]=e=>l.userDialog=e),persistent:""},{default:o(()=>[s(D,null,{default:o(()=>[s(Q,{class:"q-pb-none row items-center"},{default:o(()=>[w("div",null,x(l.actionPeriodo)+" user ",1),s(N),s(m,{icon:"close",flat:"",round:"",dense:"",onClick:r[1]||(r[1]=e=>l.userDialog=!1)})]),_:1}),s(Q,{class:"q-pt-none"},{default:o(()=>[s(q,{onSubmit:r[9]||(r[9]=e=>l.user.id?t.userPut():t.userPost())},{default:o(()=>[s(d,{modelValue:l.user.name,"onUpdate:modelValue":r[2]||(r[2]=e=>l.user.name=e),label:"Nombre",dense:"",outlined:"",rules:[e=>!!e||"Campo requerido"]},null,8,["modelValue","rules"]),s(d,{modelValue:l.user.username,"onUpdate:modelValue":r[3]||(r[3]=e=>l.user.username=e),label:"Usuario",dense:"",outlined:"",rules:[e=>!!e||"Campo requerido"]},null,8,["modelValue","rules"]),s(d,{modelValue:l.user.email,"onUpdate:modelValue":r[4]||(r[4]=e=>l.user.email=e),label:"Email",dense:"",outlined:"",hint:""},null,8,["modelValue"]),l.user.id?P("",!0):(n(),u(d,{key:0,modelValue:l.user.password,"onUpdate:modelValue":r[5]||(r[5]=e=>l.user.password=e),label:"Contrase\xF1a",type:"password",dense:"",outlined:"",rules:[e=>!!e||"Campo requerido"]},null,8,["modelValue","rules"])),s(k,{modelValue:l.user.role,"onUpdate:modelValue":r[6]||(r[6]=e=>l.user.role=e),label:"Rol",dense:"",outlined:"",options:l.roles,rules:[e=>!!e||"Campo requerido"]},null,8,["modelValue","options","rules"]),s(k,{modelValue:l.user.empresa,"onUpdate:modelValue":r[7]||(r[7]=e=>l.user.empresa=e),label:"Empresa",dense:"",outlined:"",options:["Glaztor","Valmar","Ambas"],rules:[e=>!!e||"Campo requerido"]},null,8,["modelValue","rules"]),w("div",B,[s(m,{color:"negative",label:"Cancelar",onClick:r[8]||(r[8]=e=>l.userDialog=!1),"no-caps":"",loading:l.loading},null,8,["loading"]),s(m,{color:"primary",label:"Guardar",type:"submit","no-caps":"",loading:l.loading,class:"q-ml-sm"},null,8,["loading"])])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}var se=S(I,[["render",A]]);export{se as default};
