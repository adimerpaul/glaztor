import{R as u,$ as m,U as o,T as i,aD as V,a1 as b,aC as _,aA as g,W as s,aB as h,V as p,S as x,Y as c,aE as w,a0 as E,M as z,Z as d,X as y}from"./index.fb39ef5c.js";import{d as P,e as f,a as F,C as I}from"./ClosePopup.128ae44a.js";import{Q as q,a as k}from"./QSelect.02a30944.js";import{Q as N}from"./QList.0be7a149.js";import{Q as S}from"./QPage.1546c910.js";import{Q as v,a as Q}from"./QForm.17abe237.js";import{Q as T}from"./QMarkupTable.47561889.js";import{h as C}from"./moment.40bc58bf.js";import{E as Y}from"./Excel.343f1006.js";import{_ as U}from"./plugin-vue_export-helper.21dcd24c.js";import"./index.a93ba69a.js";import"./_commonjsHelpers.a26ce4be.js";const M={name:"Pedidos",data(){return{loading:!1,dialog:!1,clientes:[],fechaInicio:C().startOf("month").format("YYYY-MM-DD"),fechaFin:C().endOf("month").format("YYYY-MM-DD"),zonas:[],pedidos:[],productos:[],pedido:{producto_id:null},dialogPagos:!1,pago:{monto:"",forma_pago:"EFECTIVO",numero_recibo:"",banco:""}}},mounted(){this.getZonas(),this.getPedidos(),this.getClientes(),this.getProductos()},methods:{exportExcel(){let l=[{sheet:"Cobranza",columns:[{label:"Fecha",value:"fecha"},{label:"Cliente",value:"cliente"},{label:"Producto",value:"producto"},{label:"Cantidad",value:"cantidad"},{label:"Precio",value:"precio"},{label:"Direccion",value:"direccion"},{label:"Observacion",value:"observacion"},{label:"Zona",value:"zona"},{label:"Total",value:"total"},{label:"Estado",value:"estado"},{label:"Fecha Pago",value:"fecha_pago"},{label:"User",value:"user_id"},{label:"Cliente",value:"cliente_id"},{label:"Estado Credito",value:"estadoCredito"},{label:"Total Pagado",value:"totalPagado"},{label:"Pagos",value:"pagosRealizados"}],content:this.pedidos}];Y.export(l,"Reporte de Cobranzas")},showPago(l){const a=this.$store.user;a.role==="Administrador"||a.role==="Ventas"||a.role==="Cobranza"||a.role==="Director"||a.role==="Supervisor"||(this.dialogPagos=!0,this.pago={...l})},updatePago(l){console.log(l),this.$axios.put("pagos/"+l.id,l).then(a=>{this.$alert.success("Pago actualizado correctamente"),this.getPedidos(),this.dialogPagos=!1,this.dialog=!1}).catch(a=>{console.log(a),this.$alert.error("Error al actualizar el pago")}).finally(()=>{this.loading=!1})},submitPago(){if(this.loading=!0,this.pago.id){this.updatePago(this.pago);return}this.$axios.post("pagos",{...this.pago,pedido_id:this.pedido.id}).then(l=>{this.dialogPagos=!1,this.$alert.success("Pago agregado correctamente"),this.pedido.pagos.push(l.data),this.getPedidos()}).catch(l=>{console.log(l),this.$alert.error("Error al agregar el pago")}).finally(()=>{this.loading=!1})},clickDialogPago(){this.dialogPagos=!0,this.pago={monto:"",forma_pago:"EFECTIVO",numero_recibo:"",banco:"",fecha_pago:C().format("YYYY-MM-DD")}},getZonas(){this.$axios.get("zonas").then(l=>{this.zonas=l.data}).catch(l=>{console.log(l)})},showPreventa(l){this.pedido={...l},this.dialog=!0},submit(){this.loading=!0,this.$axios.put("pedidos/"+this.pedido.id,this.pedido).then(l=>{this.dialog=!1,this.$alert.success("Pedido actualizado correctamente"),this.getPedidos()}).catch(l=>{console.log(l),this.$alert.error("Error al actualizar el pedido")}).finally(()=>{this.loading=!1})},getProductos(){this.$axios.get("productos").then(l=>{this.productos=l.data}).catch(l=>{console.log(l)})},getClientes(){this.$axios.get("clientes").then(l=>{this.clientes=l.data}).catch(l=>{console.log(l)})},addPedido(){this.$router.push({name:"pedidosPage"})},getPedidos(){this.loading=!0,this.$axios.get("pedidosEntregados",{params:{fechaInicio:this.fechaInicio,fechaFin:this.fechaFin}}).then(l=>{this.pedidos=l.data,this.loading=!1}).catch(l=>{console.log(l),this.loading=!1})}},computed:{esMovil(){return this.$q.screen.lt.md}}},A={class:"row"},B={class:"col-6 col-md-3"},R={class:"col-6 col-md-3"},O={class:"col-6 col-md-2 text-left"},Z={class:"col-6 col-md-4 text-right"},L={class:"text-h6"},G={class:"text-bold row items-center"},H={class:"text-bold q-pa-xs"},W=s("label",null,"Total",-1),X=s("thead",null,[s("tr",null,[s("th",null,"Fecha"),s("th",null,"Numero de Recibo"),s("th",null,"Banco"),s("th",null,"Subtotal")])],-1),j=["onClick"],J={class:"text-right"},K={colspan:"2"},$={class:"text-bold text-red"},ee=s("td",{class:"text-right"},"Total",-1),oe={class:"text-bold text-right"},le={class:"text-h6"};function te(l,a,ae,se,t,n){return u(),m(b,null,[o(S,{class:"bg-grey-3 q-pa-xs"},{default:i(()=>[o(_,null,{default:i(()=>[o(g,{class:"q-pa-xs"},{default:i(()=>[s("div",A,[s("div",B,[o(h,{outlined:"",modelValue:t.fechaInicio,"onUpdate:modelValue":a[0]||(a[0]=e=>t.fechaInicio=e),label:"Fecha Inicio",type:"date",color:"white",dense:""},null,8,["modelValue"])]),s("div",R,[o(h,{outlined:"",modelValue:t.fechaFin,"onUpdate:modelValue":a[1]||(a[1]=e=>t.fechaFin=e),label:"Fecha Fin",type:"date",color:"white",dense:""},null,8,["modelValue"])]),s("div",O,[o(p,{icon:"search",color:"primary",label:"Buscar",onClick:n.getPedidos,loading:t.loading,"no-caps":""},null,8,["onClick","loading"])]),s("div",Z,[o(p,{icon:"download",color:"green",label:"Exportar",onClick:n.exportExcel,"no-caps":""},null,8,["onClick"])])])]),_:1})]),_:1}),o(g,{class:"q-pa-none"},{default:i(()=>[o(N,{dense:"",class:"rounded-borders"},{default:i(()=>[t.pedidos.length===0?(u(),x(F,{key:0},{default:i(()=>[o(P,null,{default:i(()=>[o(f,{class:"text-h6 text-grey"},{default:i(()=>[c("No hay pedidos")]),_:1})]),_:1})]),_:1})):w("",!0),(u(!0),m(b,null,E(t.pedidos,e=>(u(),x(F,{key:e.id,onClick:r=>n.showPreventa(e),clickable:"",class:"q-my-sm bg-white hover-bg-light-blue",style:{border:"1px solid #e0e0e0","border-radius":"8px"}},{default:i(()=>[o(P,null,{default:i(()=>[o(f,{class:"text-h6"},{default:i(()=>[c(d(e.fecha.substring(0,10)||"Sin propietario")+" ",1),o(y,{name:"check_circle",color:e.estado==="PENDIENTE"?"red":e.estado==="ENTREGADO"?"green":"orange"},null,8,["color"])]),_:2},1024),o(f,{class:"text-subtitle1 text-grey"},{default:i(()=>[c(d(e.direccion)+" ",1),o(k,null,{default:i(()=>[c(d(e.total),1)]),_:2},1024),o(k,{color:e.totalPagado>=e.total?"positive":"negative",class:"text-white"},{default:i(()=>[c(d((e.total-e.pagos.reduce((r,D)=>r+parseFloat(D.monto),0)).toFixed(2)),1)]),_:2},1032,["color"])]),_:2},1024),o(f,{class:"text-caption text-positive"},{default:i(()=>{var r;return[c(d(e.cliente)+" - "+d(e.tipo_construccion)+" - "+d((r=e.user)==null?void 0:r.name)+" - "+d(e.fecha),1)]}),_:2},1024)]),_:2},1024),o(P,{side:""},{default:i(()=>[o(y,{name:"arrow_forward"})]),_:1})]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1})]),_:1}),o(V,{modelValue:t.dialog,"onUpdate:modelValue":a[2]||(a[2]=e=>t.dialog=e),position:n.esMovil?void 0:"right",maximized:!0,"transition-show":"slide-left","transition-hide":"slide-right"},{default:i(()=>[o(_,{style:{width:"450px","max-width":"100vw"}},{default:i(()=>[o(g,{class:"row items-center q-px-md bg-primary text-white q-px-none"},{default:i(()=>[z(o(p,{flat:"",round:"",dense:"",icon:"fa-solid fa-arrow-left"},null,512),[[I]]),o(v),s("div",L,d(t.pedido.id?"Editar":"Nuevo")+" Pedido",1)]),_:1}),o(g,null,{default:i(()=>[o(Q,{onSubmit:n.submit},{default:i(()=>[s("div",G,[s("div",null,"Pagos de "+d(t.pedido.cliente),1),o(v),l.$store.user.role==="Cobranza"||l.$store.user.role==="Admin"?(u(),x(p,{key:0,size:"11px",icon:"add_circle_outline",color:"green",dense:"",label:"Agregar Pago",onClick:n.clickDialogPago,"no-caps":""},null,8,["onClick"])):w("",!0)]),s("div",H,[W,s("div",null,d(t.pedido.total),1)]),o(T,{dense:"",flat:"",bordered:"","wrap-cells":""},{default:i(()=>[X,s("tbody",null,[(u(!0),m(b,null,E(t.pedido.pagos,e=>(u(),m("tr",{key:e.id,onClick:r=>n.showPago(e)},[s("td",null,d(e.fecha_pago)+" "+d(e.hora_pago),1),s("td",null,d(e.numero_recibo),1),s("td",null,d(e.banco),1),s("td",J,d(e.monto),1)],8,j))),128))]),s("tfoot",null,[s("tr",null,[s("td",K,[c(" Deuda "),s("span",$,d((t.pedido.total-t.pedido.pagos.reduce((e,r)=>e+parseFloat(r.monto),0)).toFixed(2)),1)]),ee,s("td",oe,d(t.pedido.pagos.reduce((e,r)=>e+parseFloat(r.monto),0).toFixed(2)),1)])])]),_:1})]),_:1},8,["onSubmit"])]),_:1})]),_:1})]),_:1},8,["modelValue","position"]),o(V,{modelValue:t.dialogPagos,"onUpdate:modelValue":a[9]||(a[9]=e=>t.dialogPagos=e)},{default:i(()=>[o(_,{style:{width:"450px","max-width":"100vw"}},{default:i(()=>[o(g,{class:"row items-center q-px-md bg-primary text-white q-px-none"},{default:i(()=>[o(p,{flat:"",round:"",dense:"",icon:"fa-solid fa-arrow-left",onClick:a[3]||(a[3]=e=>t.dialogPagos=!1)}),o(v),s("div",le,d(t.pago.id?"Editar":"Nuevo")+" Pago ",1)]),_:1}),o(g,null,{default:i(()=>[o(Q,{onSubmit:n.submitPago},{default:i(()=>[o(h,{modelValue:t.pago.fecha_pago,"onUpdate:modelValue":a[4]||(a[4]=e=>t.pago.fecha_pago=e),outlined:"",label:"Fecha de Pago",type:"date",rules:[e=>!!e||"Campo requerido"],dense:""},null,8,["modelValue","rules"]),o(h,{modelValue:t.pago.monto,"onUpdate:modelValue":a[5]||(a[5]=e=>t.pago.monto=e),outlined:"",label:"Monto",type:"number",rules:[e=>!!e||"Campo requerido"],dense:""},null,8,["modelValue","rules"]),o(q,{modelValue:t.pago.forma_pago,"onUpdate:modelValue":a[6]||(a[6]=e=>t.pago.forma_pago=e),outlined:"",label:"Forma de Pago",dense:"",options:["EFECTIVO","TRANSFERENCIA","CHEQUE"],rules:[e=>!!e||"Campo requerido"]},null,8,["modelValue","rules"]),o(h,{modelValue:t.pago.numero_recibo,"onUpdate:modelValue":a[7]||(a[7]=e=>t.pago.numero_recibo=e),outlined:"",label:"N\xFAmero de Recibo",rules:[e=>!!e||"Campo requerido"],dense:""},null,8,["modelValue","rules"]),o(h,{modelValue:t.pago.banco,"onUpdate:modelValue":a[8]||(a[8]=e=>t.pago.banco=e),outlined:"",label:"Banco",dense:"",hint:""},null,8,["modelValue"]),o(p,{type:"submit",class:"full-width",label:t.pago.id?"Actualizar":"Agregar",color:t.pago.id?"primary":"green",loading:t.loading,"no-caps":""},null,8,["label","color","loading"])]),_:1},8,["onSubmit"])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64)}var _e=U(M,[["render",te]]);export{_e as default};
