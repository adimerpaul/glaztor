import{_,$ as s,a7 as p,a2 as a,a1 as n,aJ as U,a9 as v,aI as C,aG as f,a4 as i,a3 as d,Q as z,a0 as g,a6 as h,aK as V,a8 as P,C as L,a5 as m,aH as u,b4 as x,F as w}from"./index.9c72f88d.js";import{b as y,a as k,Q as B}from"./format.89ba0050.js";import{Q as S}from"./QList.12c1a32d.js";import{Q as q}from"./QPage.215302fc.js";import{Q as T}from"./QPageSticky.7a385ea6.js";import{Q as N}from"./QSpace.41e1f98e.js";import{Q as b}from"./QSelect.d21464ce.js";import{Q as D}from"./QForm.a9dcb4d2.js";import{C as F}from"./ClosePopup.49e3c41f.js";import{h as O}from"./moment.40bc58bf.js";import{i as I,v as G,u as Y}from"./vue-leaflet.es.bfd35c92.js";import{E as R}from"./Excel.343f1006.js";import{_ as Z}from"./plugin-vue_export-helper.21dcd24c.js";import"./_commonjsHelpers.a26ce4be.js";import"./index.a93ba69a.js";const K={name:"Preventacemento",components:{LMap:I,LTileLayer:G,LMarker:Y},data(){return{tileProviders:[{name:"Mapa",visible:!0,url:"https://mt1.google.com/vt/lyrs=r&x={x}&y={y}&z={z}",attribution:"&copy; Google Maps"},{name:"Satelite",visible:!1,url:"https://mt1.google.com/vt/lyrs=s&x={x}&y={y}&z={z}",attribution:"&copy; Google Maps"}],location:[-17.969753,-67.114749],zoom:15,propietarioBtnBool:!0,encargadoBtnBool:!0,preventacementos:[],preventacemento:{},dialog:!1,loading:!1,productosAll:[],products:[],marcas:[]}},mounted(){this.getPreventas(),this.getProductos()},methods:{exportExcel(){let e=[{sheet:"Preventacemento",columns:[{label:"Fecha",value:"fecha"},{label:"Propietario",value:"propietario"},{label:"Tel\xE9fono del propietario",value:"telefono_propietario"},{label:"Contratista",value:"contratista"},{label:"Tel\xE9fono del contratista",value:"telefono_contratista"},{label:"Direcci\xF3n",value:"direccion"},{label:"Ubicaci\xF3n",value:"ubicacion"},{label:"Zona",value:"zona"},{label:"Tipo de construcci\xF3n",value:"tipo_construccion"},{label:"Cantidad",value:"volumen"},{label:"Medida",value:"medida"},{label:"Marca",value:"marca"},{label:"Producto",value:"producto"},{label:"Observaci\xF3n",value:"observacion"}],content:this.preventacementos}];R.export(e,"Reporte de Prospecciones")},filterProducts(e){console.log(e),e!==null&&(this.products=this.productosAll.filter(o=>(o==null?void 0:o.marca_pro)===e))},getProductos(){this.$axios.get("productos").then(e=>{this.productosAll=e.data,this.products=this.productosAll,this.products.forEach(o=>{this.marcas.includes(o.marca_pro)||this.marcas.push(o.marca_pro)})}).catch(e=>{console.log(e)})},onMapClick(e){this.location=[e.latlng.lat,e.latlng.lng],this.preventacemento.ubicacion=`${e.latlng.lat.toFixed(7)}, ${e.latlng.lng.toFixed(7)}`},openGoogleMaps(){const[e,o]=this.preventacemento.ubicacion.split(",").map(Number);window.open(`https://www.google.com/maps/search/?api=1&query=${e},${o}`)},deletePreventa(e){this.$alert.dialog("\xBFDesea eliminar la preventa?").onOk(()=>{this.$axios.delete(`preventas/${e.id}`).then(()=>{this.preventacementos=this.preventacementos.filter(o=>o.id!==e.id),this.dialog=!1}).catch(o=>{console.log(o)})})},showPreventa(e){this.preventacemento=e,this.dialog=!0;const o=e.ubicacion.split(",").map(Number);console.log(o),this.location=o},onMarkerMoveEnd(e){const c=e.target.getLatLng();this.location=[c.lat,c.lng],this.preventacemento.ubicacion=`${c.lat.toFixed(7)}, ${c.lng.toFixed(7)}`},myLocation(){navigator.geolocation&&navigator.geolocation.getCurrentPosition(e=>{this.location=[e.coords.latitude,e.coords.longitude],this.preventacemento.ubicacion=`${e.coords.latitude}, ${e.coords.longitude}`})},submit(){this.preventacemento.id?this.updatePreventa():this.createPreventa()},updatePreventa(){this.loading=!0,this.$axios.put(`preventacementos/${this.preventacemento.id}`,this.preventacemento).then(()=>{const e=this.preventacementos.findIndex(o=>o.id===this.preventacemento.id);this.preventacementos.splice(e,1,this.preventacemento),this.dialog=!1}).catch(e=>{console.log(e)}).finally(()=>{this.loading=!1})},createPreventa(){this.loading=!0,this.$axios.post("preventacementos",this.preventacemento).then(e=>{this.preventacementos.unshift(e.data),this.dialog=!1}).catch(e=>{console.log(e)}).finally(()=>{this.loading=!1})},dialogClick(){this.dialog=!0,this.preventacemento={fecha:O().format("YYYY-MM-DD"),propietario:"",contratista:"",telefono_propietario:"",telefono_contratista:"",ubicacion:"-17.969753, -67.114749",zona:"",observacion:"",tipo_construccion:"",volumen:"",marca:"",direccion:""}},getPreventas(){this.$axios.get("preventacementos").then(e=>{this.preventas=e.data}).catch(e=>{console.log(e)})}},computed:{esMovil(){return this.$q.screen.lt.md}}},H=i("div",{class:"text-h5 text-primary"},"Lista de Preventas CEMENTO",-1),J={class:"text-h6"},j={class:"row"},W={class:"col-12"},X={class:"col-6 q-pa-xs"},$={class:"col-6 q-pa-xs"},ee={class:"col-12"},oe={class:"col-12"},le={class:"col-12"},te={class:"col-12"},ae={class:"col-12"},ne={class:"col-12"},ie={style:{height:"250px",width:"100%"}},re={class:"div"},se={class:"col-12"},de={class:"col-12"},ue={class:"col-12"},me={class:"col-12"},ce={class:"col-12"},pe={class:"col-12"},ve={class:"col-12"},be={class:"col-12"};function fe(e,o,c,ge,t,r){const E=_("l-tile-layer"),M=_("l-marker"),Q=_("l-map");return s(),p(v,null,[a(q,{class:"bg-grey-2 q-pa-md"},{default:n(()=>[a(C,{flat:"",bordered:"",class:"q-pa-md"},{default:n(()=>[a(f,null,{default:n(()=>[H,i("div",null,[a(d,{icon:"download",color:"green",label:"Exportar",onClick:r.exportExcel,"no-caps":""},null,8,["onClick"])])]),_:1}),a(z,{spaced:""}),a(f,{class:"q-pa-none"},{default:n(()=>[a(S,{dense:"",class:"rounded-borders"},{default:n(()=>[t.preventacementos.length===0?(s(),g(B,{key:0},{default:n(()=>[a(y,null,{default:n(()=>[a(k,{class:"text-h6 text-grey"},{default:n(()=>[h("No hay preventas")]),_:1})]),_:1})]),_:1})):V("",!0),(s(!0),p(v,null,P(t.preventacementos,l=>(s(),g(B,{key:l.id,onClick:A=>r.showPreventa(l),clickable:"",class:"q-my-sm bg-white hover-bg-light-blue",style:{border:"1px solid #e0e0e0","border-radius":"8px"}},{default:n(()=>[a(y,{avatar:""},{default:n(()=>[a(w,{name:"home",color:"grey",size:"md"})]),_:1}),a(y,null,{default:n(()=>[a(k,{class:"text-h6"},{default:n(()=>[h(m(l.propietario||"Sin propietario")+" "+m(l.telefono_propietario?`(${l.telefono_propietario})`:""),1)]),_:2},1024),a(k,{class:"text-subtitle1 text-grey"},{default:n(()=>[h(m(l.direccion),1)]),_:2},1024),a(k,{class:"text-caption text-positive"},{default:n(()=>{var A;return[h(m(l.zona)+" - "+m(l.tipo_construccion)+" - "+m((A=l.user)==null?void 0:A.name)+" - "+m(l.fecha),1)]}),_:2},1024)]),_:2},1024),a(y,{side:""},{default:n(()=>[a(w,{name:"arrow_forward"})]),_:1})]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1})]),_:1})]),_:1}),a(T,{position:"bottom-right",class:"text-bold",offset:[18,18]},{default:n(()=>[a(d,{fab:"",icon:"add",color:"primary",onClick:r.dialogClick},null,8,["onClick"])]),_:1}),a(U,{modelValue:t.dialog,"onUpdate:modelValue":o[18]||(o[18]=l=>t.dialog=l),position:r.esMovil?void 0:"right",maximized:!0,"transition-show":"slide-left","transition-hide":"slide-right"},{default:n(()=>[a(C,{style:{width:"450px","max-width":"100vw"}},{default:n(()=>[a(f,{class:"row items-center q-px-md bg-primary text-white q-px-none"},{default:n(()=>[L(a(d,{flat:"",round:"",dense:"",icon:"fa-solid fa-arrow-left"},null,512),[[F]]),a(N),i("div",J,m(t.preventacemento.id?"Editar":"Nueva")+" preventa",1)]),_:1}),a(f,null,{default:n(()=>[a(D,{onSubmit:r.submit},{default:n(()=>[i("div",j,[i("div",W,[a(u,{dense:"",modelValue:t.preventacemento.fecha,"onUpdate:modelValue":o[0]||(o[0]=l=>t.preventacemento.fecha=l),outlined:"",label:"Fecha",type:"date",disable:e.$store.user.role!=="Admin"&&e.$store.user.role!=="Administrador"},null,8,["modelValue","disable"])]),i("div",X,[a(d,{label:"Propietario",outline:t.propietarioBtnBool,class:"full-width","no-caps":"",color:"primary",onClick:o[1]||(o[1]=l=>t.propietarioBtnBool=!t.propietarioBtnBool),disable:e.$store.user.role!=="Admin"&&e.$store.user.role!=="Administrador"},null,8,["outline","disable"])]),i("div",$,[a(d,{label:"Encargado",outline:t.encargadoBtnBool,class:"full-width","no-caps":"",color:"primary",onClick:o[2]||(o[2]=l=>t.encargadoBtnBool=!t.encargadoBtnBool),disable:e.$store.user.role!=="Admin"&&e.$store.user.role!=="Administrador"},null,8,["outline","disable"])]),t.propietarioBtnBool?V("",!0):(s(),p(v,{key:0},[i("div",ee,[a(u,{dense:"",modelValue:t.preventacemento.propietario,"onUpdate:modelValue":o[3]||(o[3]=l=>t.preventacemento.propietario=l),outlined:"",label:"Propietario",rules:[l=>!!l||"Este campo es requerido"],disable:e.$store.user.role!=="Admin"&&e.$store.user.role!=="Administrador"},null,8,["modelValue","rules","disable"])]),i("div",oe,[a(u,{dense:"",modelValue:t.preventacemento.telefono_propietario,"onUpdate:modelValue":o[4]||(o[4]=l=>t.preventacemento.telefono_propietario=l),outlined:"",label:"Telefono Propietario",type:"number",disable:e.$store.user.role!=="Admin"&&e.$store.user.role!=="Administrador"},null,8,["modelValue","disable"])])],64)),t.encargadoBtnBool?V("",!0):(s(),p(v,{key:1},[i("div",le,[a(u,{dense:"",modelValue:t.preventacemento.contratista,"onUpdate:modelValue":o[5]||(o[5]=l=>t.preventacemento.contratista=l),outlined:"",label:"Encargado",disable:e.$store.user.role!=="Admin"&&e.$store.user.role!=="Administrador"},null,8,["modelValue","disable"])]),i("div",te,[a(u,{dense:"",modelValue:t.preventacemento.telefono_contratista,"onUpdate:modelValue":o[6]||(o[6]=l=>t.preventacemento.telefono_contratista=l),outlined:"",label:"Telefono Encargado",disable:e.$store.user.role!=="Admin"&&e.$store.user.role!=="Administrador",type:"number"},null,8,["modelValue","disable"])])],64)),i("div",ae,[a(u,{dense:"",modelValue:t.preventacemento.ubicacion,"onUpdate:modelValue":o[7]||(o[7]=l=>t.preventacemento.ubicacion=l),outlined:"",label:"Ubicacion",disable:e.$store.user.role!=="Admin"&&e.$store.user.role!=="Administrador"},{append:n(()=>[a(d,{flat:"",icon:"fa-solid fa-map-marker-alt",onClick:r.myLocation},null,8,["onClick"])]),_:1},8,["modelValue","disable"])]),i("div",ne,[i("div",ie,[i("div",re,[a(d,{icon:"my_location",color:"primary",onClick:r.openGoogleMaps,dense:"",flat:""},null,8,["onClick"])]),a(Q,{ref:"map",zoom:t.zoom,"onUpdate:zoom":o[8]||(o[8]=l=>t.zoom=l),"use-global-leaflet":!1,center:t.location,onClick:r.onMapClick},{default:n(()=>[(s(!0),p(v,null,P(t.tileProviders,l=>(s(),g(E,{key:l.name,name:l.name,visible:l.visible,url:l.url,attribution:l.attribution,"layer-type":"base"},null,8,["name","visible","url","attribution"]))),128)),a(M,{"lat-lng":t.location,onMoveend:r.onMarkerMoveEnd,ref:"marker",draggable:!0},null,8,["lat-lng","onMoveend"])]),_:1},8,["zoom","center","onClick"])])]),i("div",se,[a(u,{dense:"",modelValue:t.preventacemento.direccion,"onUpdate:modelValue":o[9]||(o[9]=l=>t.preventacemento.direccion=l),outlined:"",label:"Direccion",rules:[l=>!!l||"Este campo es requerido"],disable:e.$store.user.role!=="Admin"&&e.$store.user.role!=="Administrador"},null,8,["modelValue","rules","disable"])]),i("div",de,[a(b,{dense:"",modelValue:t.preventacemento.zona,"onUpdate:modelValue":o[10]||(o[10]=l=>t.preventacemento.zona=l),options:["NORTE","ESTE","SUD","OESTE","CENTRO"],outlined:"",rules:[l=>!!l||"Este campo es requerido"],disable:e.$store.user.role!=="Admin"&&e.$store.user.role!=="Administrador",label:"Zona"},null,8,["modelValue","rules","disable"])]),i("div",ue,[a(b,{dense:"",modelValue:t.preventacemento.tipo_construccion,"onUpdate:modelValue":o[11]||(o[11]=l=>t.preventacemento.tipo_construccion=l),outlined:"",label:"Estado de la Obra","use-input":"",options:["Inicio Obra","Columnas","Muralla","Zapata","Sobrecimiento","Losa","Paralizada","Concluida"],disable:e.$store.user.role!=="Admin"&&e.$store.user.role!=="Administrador"},null,8,["modelValue","disable"])]),i("div",me,[a(u,{dense:"",modelValue:t.preventacemento.volumen,"onUpdate:modelValue":o[12]||(o[12]=l=>t.preventacemento.volumen=l),outlined:"",label:"Cantidad",type:"number",disable:e.$store.user.role!=="Admin"&&e.$store.user.role!=="Administrador"},null,8,["modelValue","disable"])]),i("div",ce,[a(b,{dense:"",modelValue:t.preventacemento.medida,"onUpdate:modelValue":o[13]||(o[13]=l=>t.preventacemento.medida=l),outlined:"",label:"Medida","use-input":"",options:["Un","tra","Kg"],disable:e.$store.user.role!=="Admin"&&e.$store.user.role!=="Administrador"},null,8,["modelValue","disable"])]),i("div",pe,[a(b,{dense:"",modelValue:t.preventacemento.marca,"onUpdate:modelValue":[o[14]||(o[14]=l=>t.preventacemento.marca=l),r.filterProducts],outlined:"",label:"Marca","use-input":"",disable:e.$store.user.role!=="Admin"&&e.$store.user.role!=="Administrador",options:t.marcas},null,8,["modelValue","onUpdate:modelValue","disable","options"])]),i("div",ve,[a(b,{dense:"",modelValue:t.preventacemento.producto,"onUpdate:modelValue":o[15]||(o[15]=l=>t.preventacemento.producto=l),outlined:"",label:"Producto","use-input":"","option-label":"nombre_pro","option-value":"nombre_pro","emit-value":"","map-options":"",disable:e.$store.user.role!=="Admin"&&e.$store.user.role!=="Administrador",options:t.products},null,8,["modelValue","disable","options"])]),i("div",be,[a(u,{dense:"",modelValue:t.preventacemento.observacion,"onUpdate:modelValue":o[16]||(o[16]=l=>t.preventacemento.observacion=l),outlined:"",label:"Observacion",disable:e.$store.user.role!=="Admin"&&e.$store.user.role!=="Administrador"},null,8,["modelValue","disable"])]),e.$store.user.role==="Admin"||e.$store.user.role==="Administrador"?(s(),g(x,{key:2,align:"right"},{default:n(()=>[a(d,{label:"Cancelar",color:"negative",onClick:o[17]||(o[17]=l=>t.dialog=!1),loading:t.loading},null,8,["loading"]),a(d,{label:"Guardar",color:"primary",type:"submit",loading:t.loading},null,8,["loading"])]),_:1})):V("",!0)])]),_:1},8,["onSubmit"])]),_:1})]),_:1})]),_:1},8,["modelValue","position"])],64)}var Le=Z(K,[["render",fe]]);export{Le as default};
