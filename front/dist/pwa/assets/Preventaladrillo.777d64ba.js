import{_,$ as n,a7 as c,a2 as i,a1 as r,aJ as U,a9 as v,aI as C,aG as f,a4 as t,a3 as d,Q as L,a0 as g,a6 as h,aK as V,a8 as P,C as z,a5 as p,aH as u,b4 as x,F as w}from"./index.9c72f88d.js";import{b as y,a as k,Q as B}from"./format.89ba0050.js";import{Q as S}from"./QList.12c1a32d.js";import{Q as q}from"./QPage.215302fc.js";import{Q as T}from"./QPageSticky.7a385ea6.js";import{Q as D}from"./QSpace.41e1f98e.js";import{Q as b}from"./QSelect.d21464ce.js";import{Q as N}from"./QForm.a9dcb4d2.js";import{C as F}from"./ClosePopup.49e3c41f.js";import{h as I}from"./moment.40bc58bf.js";import{i as O,v as G,u as R}from"./vue-leaflet.es.bfd35c92.js";import{E as Y}from"./Excel.343f1006.js";import{_ as Z}from"./plugin-vue_export-helper.21dcd24c.js";import"./_commonjsHelpers.a26ce4be.js";import"./index.a93ba69a.js";const K={name:"Preventaladrillo",components:{LMap:O,LTileLayer:G,LMarker:R},data(){return{tileProviders:[{name:"Mapa",visible:!0,url:"https://mt1.google.com/vt/lyrs=r&x={x}&y={y}&z={z}",attribution:"&copy; Google Maps"},{name:"Satelite",visible:!1,url:"https://mt1.google.com/vt/lyrs=s&x={x}&y={y}&z={z}",attribution:"&copy; Google Maps"}],location:[-17.969753,-67.114749],zoom:15,propietarioBtnBool:!0,encargadoBtnBool:!0,preventaladrillos:[],preventaladrillo:{},dialog:!1,loading:!1,productosAll:[],products:[],marcas:[]}},mounted(){this.getPreventas(),this.getProductos()},methods:{exportExcel(){let e=[{sheet:"Preventaladrillo",columns:[{label:"Fecha",value:"fecha"},{label:"Propietario",value:"propietario"},{label:"Tel\xE9fono del propietario",value:"telefono_propietario"},{label:"Contratista",value:"contratista"},{label:"Tel\xE9fono del contratista",value:"telefono_contratista"},{label:"Direcci\xF3n",value:"direccion"},{label:"Ubicaci\xF3n",value:"ubicacion"},{label:"Zona",value:"zona"},{label:"Tipo de construcci\xF3n",value:"tipo_construccion"},{label:"Cantidad",value:"volumen"},{label:"Medida",value:"medida"},{label:"Marca",value:"marca"},{label:"Producto",value:"producto"},{label:"Observaci\xF3n",value:"observacion"}],content:this.preventaladrillos}];Y.export(e,"Reporte de Prospecciones")},filterProducts(e){console.log(e),e!==null&&(this.products=this.productosAll.filter(l=>(l==null?void 0:l.marca_pro)===e))},getProductos(){this.$axios.get("productos").then(e=>{this.productosAll=e.data,this.products=this.productosAll,this.products.forEach(l=>{this.marcas.includes(l.marca_pro)||this.marcas.push(l.marca_pro)})}).catch(e=>{console.log(e)})},onMapClick(e){this.location=[e.latlng.lat,e.latlng.lng],this.preventaladrillo.ubicacion=`${e.latlng.lat.toFixed(7)}, ${e.latlng.lng.toFixed(7)}`},openGoogleMaps(){const[e,l]=this.preventaladrillo.ubicacion.split(",").map(Number);window.open(`https://www.google.com/maps/search/?api=1&query=${e},${l}`)},deletePreventa(e){this.$alert.dialog("\xBFDesea eliminar la preventa?").onOk(()=>{this.$axios.delete(`preventas/${e.id}`).then(()=>{this.preventaladrillo=this.preventaladrillos.filter(l=>l.id!==e.id),this.dialog=!1}).catch(l=>{console.log(l)})})},showPreventaladrillo(e){this.preventaladrillo=e,this.dialog=!0;const l=e.ubicacion.split(",").map(Number);console.log(l),this.location=l},onMarkerMoveEnd(e){const m=e.target.getLatLng();this.location=[m.lat,m.lng],this.preventaladrillo.ubicacion=`${m.lat.toFixed(7)}, ${m.lng.toFixed(7)}`},myLocation(){navigator.geolocation&&navigator.geolocation.getCurrentPosition(e=>{this.location=[e.coords.latitude,e.coords.longitude],this.preventaladrillo.ubicacion=`${e.coords.latitude}, ${e.coords.longitude}`})},submit(){this.preventaladrillo.id?this.updatePreventa():this.createPreventa()},updatePreventa(){this.loading=!0,this.$axios.put(`preventaladrillos/${this.preventaladrillo.id}`,this.preventaladrillo).then(()=>{const e=this.preventaladrillos.findIndex(l=>l.id===this.preventaladrillo.id);this.preventaladrillos.splice(e,1,this.preventaladrillo),this.dialog=!1}).catch(e=>{console.log(e)}).finally(()=>{this.loading=!1})},createPreventa(){this.loading=!0,this.$axios.post("preventaladrillos",this.preventaladrillo).then(e=>{this.preventaladrillos.unshift(e.data),this.dialog=!1}).catch(e=>{console.log(e)}).finally(()=>{this.loading=!1})},dialogClick(){this.dialog=!0,this.preventaladrillo={fecha:I().format("YYYY-MM-DD"),propietario:"",contratista:"",telefono_propietario:"",telefono_contratista:"",ubicacion:"-17.969753, -67.114749",zona:"",observacion:"",tipo_construccion:"",volumen:"",marca:"",direccion:""}},getPreventas(){this.$axios.get("preventaladrillos").then(e=>{this.preventas=e.data}).catch(e=>{console.log(e)})}},computed:{esMovil(){return this.$q.screen.lt.md}}},H=t("div",{class:"text-h5 text-primary"},"Lista de Preventas LADRILLO",-1),J={class:"text-h6"},j={class:"row"},W={class:"col-12"},X={class:"col-6 q-pa-xs"},$={class:"col-6 q-pa-xs"},ee={class:"col-12"},le={class:"col-12"},oe={class:"col-12"},ae={class:"col-12"},ie={class:"col-12"},re={class:"col-12"},te={style:{height:"250px",width:"100%"}},se={class:"div"},ne={class:"col-12"},de={class:"col-12"},ue={class:"col-12"},pe={class:"col-12"},me={class:"col-12"},ce={class:"col-12"},ve={class:"col-12"},be={class:"col-12"};function fe(e,l,m,ge,a,s){const Q=_("l-tile-layer"),M=_("l-marker"),E=_("l-map");return n(),c(v,null,[i(q,{class:"bg-grey-2 q-pa-md"},{default:r(()=>[i(C,{flat:"",bordered:"",class:"q-pa-md"},{default:r(()=>[i(f,null,{default:r(()=>[H,t("div",null,[i(d,{icon:"download",color:"green",label:"Exportar",onClick:s.exportExcel,"no-caps":""},null,8,["onClick"])])]),_:1}),i(L,{spaced:""}),i(f,{class:"q-pa-none"},{default:r(()=>[i(S,{dense:"",class:"rounded-borders"},{default:r(()=>[a.preventaladrillos.length===0?(n(),g(B,{key:0},{default:r(()=>[i(y,null,{default:r(()=>[i(k,{class:"text-h6 text-grey"},{default:r(()=>[h("No hay preventas")]),_:1})]),_:1})]),_:1})):V("",!0),(n(!0),c(v,null,P(a.preventaladrillos,o=>(n(),g(B,{key:o.id,onClick:A=>s.showPreventaladrillo(o),clickable:"",class:"q-my-sm bg-white hover-bg-light-blue",style:{border:"1px solid #e0e0e0","border-radius":"8px"}},{default:r(()=>[i(y,{avatar:""},{default:r(()=>[i(w,{name:"home",color:"grey",size:"md"})]),_:1}),i(y,null,{default:r(()=>[i(k,{class:"text-h6"},{default:r(()=>[h(p(o.propietario||"Sin propietario")+" "+p(o.telefono_propietario?`(${o.telefono_propietario})`:""),1)]),_:2},1024),i(k,{class:"text-subtitle1 text-grey"},{default:r(()=>[h(p(o.direccion),1)]),_:2},1024),i(k,{class:"text-caption text-positive"},{default:r(()=>{var A;return[h(p(o.zona)+" - "+p(o.tipo_construccion)+" - "+p((A=o.user)==null?void 0:A.name)+" - "+p(o.fecha),1)]}),_:2},1024)]),_:2},1024),i(y,{side:""},{default:r(()=>[i(w,{name:"arrow_forward"})]),_:1})]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1})]),_:1})]),_:1}),i(T,{position:"bottom-right",class:"text-bold",offset:[18,18]},{default:r(()=>[i(d,{fab:"",icon:"add",color:"primary",onClick:s.dialogClick},null,8,["onClick"])]),_:1}),i(U,{modelValue:a.dialog,"onUpdate:modelValue":l[18]||(l[18]=o=>a.dialog=o),position:s.esMovil?void 0:"right",maximized:!0,"transition-show":"slide-left","transition-hide":"slide-right"},{default:r(()=>[i(C,{style:{width:"450px","max-width":"100vw"}},{default:r(()=>[i(f,{class:"row items-center q-px-md bg-primary text-white q-px-none"},{default:r(()=>[z(i(d,{flat:"",round:"",dense:"",icon:"fa-solid fa-arrow-left"},null,512),[[F]]),i(D),t("div",J,p(a.preventaladrillo.id?"Editar":"Nueva")+" preventa",1)]),_:1}),i(f,null,{default:r(()=>[i(N,{onSubmit:s.submit},{default:r(()=>[t("div",j,[t("div",W,[i(u,{dense:"",modelValue:a.preventaladrillo.fecha,"onUpdate:modelValue":l[0]||(l[0]=o=>a.preventaladrillo.fecha=o),outlined:"",label:"Fecha",type:"date",disable:e.$store.user.role!=="Admin"&&e.$store.user.role!=="Administrador"},null,8,["modelValue","disable"])]),t("div",X,[i(d,{label:"Propietario",outline:a.propietarioBtnBool,class:"full-width","no-caps":"",color:"primary",onClick:l[1]||(l[1]=o=>a.propietarioBtnBool=!a.propietarioBtnBool),disable:e.$store.user.role!=="Admin"&&e.$store.user.role!=="Administrador"},null,8,["outline","disable"])]),t("div",$,[i(d,{label:"Encargado",outline:a.encargadoBtnBool,class:"full-width","no-caps":"",color:"primary",onClick:l[2]||(l[2]=o=>a.encargadoBtnBool=!a.encargadoBtnBool),disable:e.$store.user.role!=="Admin"&&e.$store.user.role!=="Administrador"},null,8,["outline","disable"])]),a.propietarioBtnBool?V("",!0):(n(),c(v,{key:0},[t("div",ee,[i(u,{dense:"",modelValue:a.preventaladrillo.propietario,"onUpdate:modelValue":l[3]||(l[3]=o=>a.preventaladrillo.propietario=o),outlined:"",label:"Propietario",rules:[o=>!!o||"Este campo es requerido"],disable:e.$store.user.role!=="Admin"&&e.$store.user.role!=="Administrador"},null,8,["modelValue","rules","disable"])]),t("div",le,[i(u,{dense:"",modelValue:a.preventaladrillo.telefono_propietario,"onUpdate:modelValue":l[4]||(l[4]=o=>a.preventaladrillo.telefono_propietario=o),outlined:"",label:"Telefono Propietario",type:"number",disable:e.$store.user.role!=="Admin"&&e.$store.user.role!=="Administrador"},null,8,["modelValue","disable"])])],64)),a.encargadoBtnBool?V("",!0):(n(),c(v,{key:1},[t("div",oe,[i(u,{dense:"",modelValue:a.preventaladrillo.contratista,"onUpdate:modelValue":l[5]||(l[5]=o=>a.preventaladrillo.contratista=o),outlined:"",label:"Encargado",disable:e.$store.user.role!=="Admin"&&e.$store.user.role!=="Administrador"},null,8,["modelValue","disable"])]),t("div",ae,[i(u,{dense:"",modelValue:a.preventaladrillo.telefono_contratista,"onUpdate:modelValue":l[6]||(l[6]=o=>a.preventaladrillo.telefono_contratista=o),outlined:"",label:"Telefono Encargado",disable:e.$store.user.role!=="Admin"&&e.$store.user.role!=="Administrador",type:"number"},null,8,["modelValue","disable"])])],64)),t("div",ie,[i(u,{dense:"",modelValue:a.preventaladrillo.ubicacion,"onUpdate:modelValue":l[7]||(l[7]=o=>a.preventaladrillo.ubicacion=o),outlined:"",label:"Ubicacion",disable:e.$store.user.role!=="Admin"&&e.$store.user.role!=="Administrador"},{append:r(()=>[i(d,{flat:"",icon:"fa-solid fa-map-marker-alt",onClick:s.myLocation},null,8,["onClick"])]),_:1},8,["modelValue","disable"])]),t("div",re,[t("div",te,[t("div",se,[i(d,{icon:"my_location",color:"primary",onClick:s.openGoogleMaps,dense:"",flat:""},null,8,["onClick"])]),i(E,{ref:"map",zoom:a.zoom,"onUpdate:zoom":l[8]||(l[8]=o=>a.zoom=o),"use-global-leaflet":!1,center:a.location,onClick:s.onMapClick},{default:r(()=>[(n(!0),c(v,null,P(a.tileProviders,o=>(n(),g(Q,{key:o.name,name:o.name,visible:o.visible,url:o.url,attribution:o.attribution,"layer-type":"base"},null,8,["name","visible","url","attribution"]))),128)),i(M,{"lat-lng":a.location,onMoveend:s.onMarkerMoveEnd,ref:"marker",draggable:!0},null,8,["lat-lng","onMoveend"])]),_:1},8,["zoom","center","onClick"])])]),t("div",ne,[i(u,{dense:"",modelValue:a.preventaladrillo.direccion,"onUpdate:modelValue":l[9]||(l[9]=o=>a.preventaladrillo.direccion=o),outlined:"",label:"Direccion",rules:[o=>!!o||"Este campo es requerido"],disable:e.$store.user.role!=="Admin"&&e.$store.user.role!=="Administrador"},null,8,["modelValue","rules","disable"])]),t("div",de,[i(b,{dense:"",modelValue:a.preventaladrillo.zona,"onUpdate:modelValue":l[10]||(l[10]=o=>a.preventaladrillo.zona=o),options:["NORTE","ESTE","SUD","OESTE","CENTRO"],outlined:"",rules:[o=>!!o||"Este campo es requerido"],disable:e.$store.user.role!=="Admin"&&e.$store.user.role!=="Administrador",label:"Zona"},null,8,["modelValue","rules","disable"])]),t("div",ue,[i(b,{dense:"",modelValue:a.preventaladrillo.tipo_construccion,"onUpdate:modelValue":l[11]||(l[11]=o=>a.preventaladrillo.tipo_construccion=o),outlined:"",label:"Estado de la Obra","use-input":"",options:["Inicio Obra","Columnas","Muralla","Zapata","Sobrecimiento","Losa","Paralizada","Concluida"],disable:e.$store.user.role!=="Admin"&&e.$store.user.role!=="Administrador"},null,8,["modelValue","disable"])]),t("div",pe,[i(u,{dense:"",modelValue:a.preventaladrillo.volumen,"onUpdate:modelValue":l[12]||(l[12]=o=>a.preventaladrillo.volumen=o),outlined:"",label:"Cantidad",type:"number",disable:e.$store.user.role!=="Admin"&&e.$store.user.role!=="Administrador"},null,8,["modelValue","disable"])]),t("div",me,[i(b,{dense:"",modelValue:a.preventaladrillo.medida,"onUpdate:modelValue":l[13]||(l[13]=o=>a.preventaladrillo.medida=o),outlined:"",label:"Medida","use-input":"",options:["Un","tra","Kg"],disable:e.$store.user.role!=="Admin"&&e.$store.user.role!=="Administrador"},null,8,["modelValue","disable"])]),t("div",ce,[i(b,{dense:"",modelValue:a.preventaladrillo.marca,"onUpdate:modelValue":[l[14]||(l[14]=o=>a.preventaladrillo.marca=o),s.filterProducts],outlined:"",label:"Marca","use-input":"",disable:e.$store.user.role!=="Admin"&&e.$store.user.role!=="Administrador",options:a.marcas},null,8,["modelValue","onUpdate:modelValue","disable","options"])]),t("div",ve,[i(b,{dense:"",modelValue:a.preventaladrillo.producto,"onUpdate:modelValue":l[15]||(l[15]=o=>a.preventaladrillo.producto=o),outlined:"",label:"Producto","use-input":"","option-label":"nombre_pro","option-value":"nombre_pro","emit-value":"","map-options":"",disable:e.$store.user.role!=="Admin"&&e.$store.user.role!=="Administrador",options:a.products},null,8,["modelValue","disable","options"])]),t("div",be,[i(u,{dense:"",modelValue:a.preventaladrillo.observacion,"onUpdate:modelValue":l[16]||(l[16]=o=>a.preventaladrillo.observacion=o),outlined:"",label:"Observacion",disable:e.$store.user.role!=="Admin"&&e.$store.user.role!=="Administrador"},null,8,["modelValue","disable"])]),e.$store.user.role==="Admin"||e.$store.user.role==="Administrador"?(n(),g(x,{key:2,align:"right"},{default:r(()=>[i(d,{label:"Cancelar",color:"negative",onClick:l[17]||(l[17]=o=>a.dialog=!1),loading:a.loading},null,8,["loading"]),i(d,{label:"Guardar",color:"primary",type:"submit",loading:a.loading},null,8,["loading"])]),_:1})):V("",!0)])]),_:1},8,["onSubmit"])]),_:1})]),_:1})]),_:1},8,["modelValue","position"])],64)}var ze=Z(K,[["render",fe]]);export{ze as default};
