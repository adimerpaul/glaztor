import{$ as b,a7 as _,a2 as a,a1 as r,aJ as ue,a9 as x,aI as C,aG as h,a4 as n,aH as g,F as V,a3 as p,a0 as F,a6 as d,aK as ge,a8 as be,C as _e,a5 as i}from"./index.9c72f88d.js";import{b as E,a as v,Q as de}from"./format.89ba0050.js";import{Q as ve,a as me}from"./QSelect.d21464ce.js";import{Q as Pe}from"./QList.12c1a32d.js";import{Q as xe}from"./QPage.215302fc.js";import{Q as w}from"./QSpace.41e1f98e.js";import{Q as Ce}from"./QMarkupTable.cfe36cec.js";import{Q as he}from"./QForm.a9dcb4d2.js";import{C as Ve}from"./ClosePopup.49e3c41f.js";import{h as P}from"./moment.40bc58bf.js";import{E as Fe}from"./Excel.343f1006.js";import{_ as Ee}from"./plugin-vue_export-helper.21dcd24c.js";import"./index.a93ba69a.js";import"./_commonjsHelpers.a26ce4be.js";const we={name:"Pedidos",data(){return{loading:!1,dialog:!1,clientes:[],fechaInicio:P().startOf("month").format("YYYY-MM-DD"),fechaFin:P().endOf("month").format("YYYY-MM-DD"),zonas:[],pedidosCemento:[],pedidosCementoAll:[],productos:[],filter:"",pedido:{producto_id:null},dialogPagos:!1,pago:{monto:"",forma_pago:"EFECTIVO",numero_recibo:"",banco:"",observacion:""}}},mounted(){this.getZonas(),this.getPedidos(),this.getClientes(),this.getProductos()},methods:{exportExcel(){let t=[];this.pedidosCemento.forEach(e=>{e.detalles.forEach(m=>{var u,o,c,f,y,k,Q,N,D,O,B,I,z,Y,q,R,S,M,T,U,A,H,G,L,Z,J,K,j,W,X,$,ee,oe,ae,le,te,se,ne,re,ie,ce;const l=e.total-e.pagos.reduce((pe,fe)=>pe+parseFloat(fe.monto),0);t.push({created_at:P(e.created_at).format("YYYY-MM-DD HH:mm:ss"),fecha:e.fecha,cliente:e.cliente,producto:m.producto.nombre_pro,cantidad:m.cantidad,precio:m.precio,subtotal:m.cantidad*m.precio,factura:e.factura,nombre_factura:e.nombre_factura,nit_factura:e.nit_factura,direccion:e.direccion,contacto:e.contacto,telefono:e.telefono,telefono2:e.telefono2,observacion:e.observacion,chofer:e.chofer,zona:e.zona,totalPagado:e.totalPagado,pagos:e.pagos.length,estado:e.estado,fecha_pago:e.fecha_pago,user:(u=e.user)==null?void 0:u.name,total:e.total,pago1:(o=e.pagos[0])==null?void 0:o.monto,pago2:(c=e.pagos[1])==null?void 0:c.monto,pago3:(f=e.pagos[2])==null?void 0:f.monto,pago4:(y=e.pagos[3])==null?void 0:y.monto,pago5:(k=e.pagos[4])==null?void 0:k.monto,pago6:(Q=e.pagos[5])==null?void 0:Q.monto,pago7:(N=e.pagos[6])==null?void 0:N.monto,pago8:(D=e.pagos[7])==null?void 0:D.monto,numero_recibo1:(O=e.pagos[0])==null?void 0:O.numero_recibo,numero_recibo2:(B=e.pagos[1])==null?void 0:B.numero_recibo,numero_recibo3:(I=e.pagos[2])==null?void 0:I.numero_recibo,numero_recibo4:(z=e.pagos[3])==null?void 0:z.numero_recibo,numero_recibo5:(Y=e.pagos[4])==null?void 0:Y.numero_recibo,numero_recibo6:(q=e.pagos[5])==null?void 0:q.numero_recibo,numero_recibo7:(R=e.pagos[6])==null?void 0:R.numero_recibo,numero_recibo8:(S=e.pagos[7])==null?void 0:S.numero_recibo,fecha_pago1:(M=e.pagos[0])==null?void 0:M.fecha_pago,fecha_pago2:(T=e.pagos[1])==null?void 0:T.fecha_pago,fecha_pago3:(U=e.pagos[2])==null?void 0:U.fecha_pago,fecha_pago4:(A=e.pagos[3])==null?void 0:A.fecha_pago,fecha_pago5:(H=e.pagos[4])==null?void 0:H.fecha_pago,fecha_pago6:(G=e.pagos[5])==null?void 0:G.fecha_pago,fecha_pago7:(L=e.pagos[6])==null?void 0:L.fecha_pago,fecha_pago8:(Z=e.pagos[7])==null?void 0:Z.fecha_pago,banco1:(J=e.pagos[0])==null?void 0:J.banco,observacion1:(K=e.pagos[0])==null?void 0:K.observacion,banco2:(j=e.pagos[1])==null?void 0:j.banco,observacion2:(W=e.pagos[1])==null?void 0:W.observacion,banco3:(X=e.pagos[2])==null?void 0:X.banco,observacion3:($=e.pagos[2])==null?void 0:$.observacion,banco4:(ee=e.pagos[3])==null?void 0:ee.banco,observacion4:(oe=e.pagos[3])==null?void 0:oe.observacion,banco5:(ae=e.pagos[4])==null?void 0:ae.banco,observacion5:(le=e.pagos[4])==null?void 0:le.observacion,banco6:(te=e.pagos[5])==null?void 0:te.banco,observacion6:(se=e.pagos[5])==null?void 0:se.observacion,banco7:(ne=e.pagos[6])==null?void 0:ne.banco,observacion7:(re=e.pagos[6])==null?void 0:re.observacion,banco8:(ie=e.pagos[7])==null?void 0:ie.banco,observacion8:(ce=e.pagos[7])==null?void 0:ce.observacion,deudaPendiente:l.toFixed(2)})})});let s=[{sheet:"Cobranza",columns:[{label:"Fecha del pedido",value:"created_at"},{label:"Fecha de Entrega",value:"fecha"},{label:"Cliente",value:"cliente"},{label:"Producto",value:"producto"},{label:"Cantidad",value:"cantidad"},{label:"Precio",value:"precio"},{label:"Direccion",value:"direccion"},{label:"Observacion",value:"observacion"},{label:"Zona",value:"zona"},{label:"Total",value:"total"},{label:"Estado",value:"estado"},{label:"Fecha Pago",value:"fecha_pago"},{label:"User",value:"user"},{label:"Pago 1",value:"pago1"},{label:"Numero Recibo 1",value:"numero_recibo1"},{label:"Fecha Pago 1",value:"fecha_pago1"},{label:"Banco 1",value:"banco1"},{label:"Observaci\xF3n 1",value:"observacion1"},{label:"Pago 2",value:"pago2"},{label:"Numero Recibo 2",value:"numero_recibo2"},{label:"Fecha Pago 2",value:"fecha_pago2"},{label:"Banco 2",value:"banco2"},{label:"Observaci\xF3n 2",value:"observacion2"},{label:"Pago 3",value:"pago3"},{label:"Numero Recibo 3",value:"numero_recibo3"},{label:"Fecha Pago 3",value:"fecha_pago3"},{label:"Banco 3",value:"banco3"},{label:"Observaci\xF3n 3",value:"observacion3"},{label:"Pago 4",value:"pago4"},{label:"Numero Recibo 4",value:"numero_recibo4"},{label:"Fecha Pago 4",value:"fecha_pago4"},{label:"Banco 4",value:"banco4"},{label:"Observaci\xF3n 4",value:"observacion4"},{label:"Pago 5",value:"pago5"},{label:"Numero Recibo 5",value:"numero_recibo5"},{label:"Fecha Pago 5",value:"fecha_pago5"},{label:"Banco 5",value:"banco5"},{label:"Observaci\xF3n 5",value:"observacion5"},{label:"Pago 6",value:"pago6"},{label:"Numero Recibo 6",value:"numero_recibo6"},{label:"Fecha Pago 6",value:"fecha_pago6"},{label:"Banco 6",value:"banco6"},{label:"Observaci\xF3n 6",value:"observacion6"},{label:"Pago 7",value:"pago7"},{label:"Numero Recibo 7",value:"numero_recibo7"},{label:"Fecha Pago 7",value:"fecha_pago7"},{label:"Banco 7",value:"banco7"},{label:"Observaci\xF3n 7",value:"observacion7"},{label:"Pago 8",value:"pago8"},{label:"Numero Recibo 8",value:"numero_recibo8"},{label:"Fecha Pago 8",value:"fecha_pago8"},{label:"Banco 8",value:"banco8"},{label:"Observaci\xF3n 8",value:"observacion8"},{label:"Total Pagado",value:"totalPagado"},{label:"Pagos",value:"pagos"},{label:"Deuda Pendiente",value:"deudaPendiente"}],content:t}];Fe.export(s,"Reporte de Cobranzas")},showPago(t){const s=this.$store.user;s.role==="Administrador"||s.role==="Ventas"||s.role==="Director"||s.role==="Supervisor"||(this.dialogPagos=!0,this.pago={...t})},updatePago(t){console.log(t),this.$axios.put("pagosCemento/"+t.id,t).then(s=>{this.$alert.success("Pago actualizado correctamente"),this.getPedidos(),this.dialogPagos=!1,this.dialog=!1}).catch(s=>{console.log(s),this.$alert.error("Error al actualizar el pago")}).finally(()=>{this.loading=!1})},submitPago(){if(this.loading=!0,this.pago.id){this.updatePago(this.pago);return}this.$axios.post("pagosCemento",{...this.pago,pedido_id:this.pedido.id}).then(t=>{this.dialogPagos=!1,this.$alert.success("Pago agregado correctamente"),this.pedido.pagos.push(t.data),this.getPedidos()}).catch(t=>{console.log(t),this.$alert.error("Error al agregar el pago")}).finally(()=>{this.loading=!1})},clickDialogPago(){this.dialogPagos=!0,this.pago={monto:"",forma_pago:"EFECTIVO",numero_recibo:"",banco:"",fecha_pago:P().format("YYYY-MM-DD")}},getZonas(){this.$axios.get("zonas").then(t=>{this.zonas=t.data}).catch(t=>{console.log(t)})},showPreventa(t){this.pedido={...t},this.dialog=!0},submit(){this.loading=!0,this.$axios.put("pedidosCemento/"+this.pedido.id,this.pedido).then(t=>{this.dialog=!1,this.$alert.success("Pedido actualizado correctamente"),this.getPedidos()}).catch(t=>{console.log(t),this.$alert.error("Error al actualizar el pedido")}).finally(()=>{this.loading=!1})},getProductos(){this.$axios.get("productos").then(t=>{this.productos=t.data}).catch(t=>{console.log(t)})},getClientes(){this.$axios.get("clientes").then(t=>{this.clientes=t.data}).catch(t=>{console.log(t)})},addPedido(){this.$router.push({name:"pedidosCementoPage"})},getPedidos(){this.loading=!0,this.$axios.get("pedidosCementoEntregados",{params:{fechaInicio:this.fechaInicio,fechaFin:this.fechaFin,filter:this.filter}}).then(t=>{this.pedidosCemento=t.data,this.pedidosCementoAll=t.data,this.loading=!1}).catch(t=>{console.log(t),this.loading=!1})}},computed:{esMovil(){return this.$q.screen.lt.md}}},ye={class:"row"},ke=n("div",{class:"col-12 bg-black text-white q-pa-xs text-bold text-center"}," PAGOS CEMENTO ",-1),Qe={class:"col-6 col-md-3"},Ne={class:"col-6 col-md-3"},De={class:"col-6 col-md-2 text-right"},Oe={class:"col-6 col-md-2 text-left"},Be={class:"col-6 col-md-2 text-right"},Ie={class:"text-h6"},ze={class:"text-bold row items-center"},Ye={class:"text-bold q-pa-xs"},qe=n("label",null,"Total",-1),Re=n("thead",null,[n("tr",null,[n("th",null,"Fecha"),n("th",null,"Numero de Recibo"),n("th",null,"Banco"),n("th",null,"Subtotal")])],-1),Se=["onClick"],Me={class:"text-right"},Te={colspan:"2"},Ue={class:"text-bold text-red"},Ae=n("td",{class:"text-right"},"Total",-1),He={class:"text-bold text-right"},Ge={class:"text-h6"};function Le(t,s,e,m,l,u){return b(),_(x,null,[a(xe,{class:"bg-grey-3 q-pa-xs"},{default:r(()=>[a(C,null,{default:r(()=>[a(h,{class:"q-pa-xs"},{default:r(()=>[n("div",ye,[ke,n("div",Qe,[a(g,{outlined:"",modelValue:l.fechaInicio,"onUpdate:modelValue":s[0]||(s[0]=o=>l.fechaInicio=o),label:"Fecha Inicio",type:"date",color:"white",dense:""},null,8,["modelValue"])]),n("div",Ne,[a(g,{outlined:"",modelValue:l.fechaFin,"onUpdate:modelValue":s[1]||(s[1]=o=>l.fechaFin=o),label:"Fecha Fin",type:"date",color:"white",dense:""},null,8,["modelValue"])]),n("div",De,[a(g,{modelValue:l.filter,"onUpdate:modelValue":s[2]||(s[2]=o=>l.filter=o),outlined:"",label:"Buscar",dense:""},{prepend:r(()=>[a(V,{name:"search"})]),_:1},8,["modelValue"])]),n("div",Oe,[a(p,{icon:"search",color:"primary",label:"Buscar",onClick:u.getPedidos,loading:l.loading,"no-caps":""},null,8,["onClick","loading"])]),n("div",Be,[a(p,{icon:"download",color:"green",label:"Exportar",onClick:u.exportExcel,"no-caps":""},null,8,["onClick"])])])]),_:1})]),_:1}),a(h,{class:"q-pa-none"},{default:r(()=>[a(Pe,{dense:"",class:"rounded-borders"},{default:r(()=>[l.pedidosCemento.length===0?(b(),F(de,{key:0},{default:r(()=>[a(E,null,{default:r(()=>[a(v,{class:"text-h6 text-grey"},{default:r(()=>[d("No hay pedidosCemento")]),_:1})]),_:1})]),_:1})):ge("",!0),(b(!0),_(x,null,be(l.pedidosCemento,o=>(b(),F(de,{key:o.id,onClick:c=>u.showPreventa(o),clickable:"",class:"q-my-sm bg-white hover-bg-light-blue",style:{border:"1px solid #e0e0e0","border-radius":"8px"}},{default:r(()=>[a(E,null,{default:r(()=>[a(v,{class:"text-h6"},{default:r(()=>[d(i(o.fecha.substring(0,10)||"Sin propietario")+" ",1),a(V,{name:"check_circle",color:o.estado==="PENDIENTE"?"red":o.estado==="ENTREGADO"?"green":"blue"},null,8,["color"])]),_:2},1024),a(v,{class:"text-subtitle1 text-grey"},{default:r(()=>[d(i(o.direccion)+" ",1),a(me,null,{default:r(()=>[d(i(o.total),1)]),_:2},1024),a(me,{color:o.totalPagado>=o.total?"positive":"negative",class:"text-white"},{default:r(()=>[d(i((o.total-o.pagos.reduce((c,f)=>c+parseFloat(f.monto),0)).toFixed(2)),1)]),_:2},1032,["color"])]),_:2},1024),a(v,{class:"text-caption text-positive"},{default:r(()=>{var c;return[d(i(o.cliente)+" - "+i(o.tipo_construccion)+" - "+i((c=o.user)==null?void 0:c.name)+" - "+i(o.fecha),1)]}),_:2},1024)]),_:2},1024),a(E,{side:""},{default:r(()=>[a(V,{name:"arrow_forward"})]),_:1})]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1})]),_:1}),a(ue,{modelValue:l.dialog,"onUpdate:modelValue":s[3]||(s[3]=o=>l.dialog=o),position:u.esMovil?void 0:"right",maximized:!0,"transition-show":"slide-left","transition-hide":"slide-right"},{default:r(()=>[a(C,{style:{width:"450px","max-width":"100vw"}},{default:r(()=>[a(h,{class:"row items-center q-px-md bg-primary text-white q-px-none"},{default:r(()=>[_e(a(p,{flat:"",round:"",dense:"",icon:"fa-solid fa-arrow-left"},null,512),[[Ve]]),a(w),n("div",Ie,i(l.pedido.id?"Editar":"Nuevo")+" Pedido",1)]),_:1}),a(h,null,{default:r(()=>[a(he,{onSubmit:u.submit},{default:r(()=>[n("div",ze,[n("div",null,"Pagos de "+i(l.pedido.cliente),1),a(w),t.$store.user.role==="Cobranza"||t.$store.user.role==="Admin"?(b(),F(p,{key:0,size:"11px",icon:"add_circle_outline",color:"green",dense:"",label:"Agregar Pago",onClick:u.clickDialogPago,"no-caps":""},null,8,["onClick"])):ge("",!0)]),n("div",Ye,[qe,n("div",null,i(l.pedido.total),1)]),a(Ce,{dense:"",flat:"",bordered:"","wrap-cells":""},{default:r(()=>[Re,n("tbody",null,[(b(!0),_(x,null,be(l.pedido.pagos,o=>(b(),_("tr",{key:o.id,onClick:c=>u.showPago(o)},[n("td",null,i(o.fecha_pago)+" "+i(o.hora_pago),1),n("td",null,i(o.numero_recibo),1),n("td",null,i(o.banco),1),n("td",Me,i(o.monto),1)],8,Se))),128))]),n("tfoot",null,[n("tr",null,[n("td",Te,[d(" Deuda "),n("span",Ue,i((l.pedido.total-l.pedido.pagos.reduce((o,c)=>o+parseFloat(c.monto),0)).toFixed(2)),1)]),Ae,n("td",He,i(l.pedido.pagos.reduce((o,c)=>o+parseFloat(c.monto),0).toFixed(2)),1)])])]),_:1})]),_:1},8,["onSubmit"])]),_:1})]),_:1})]),_:1},8,["modelValue","position"]),a(ue,{modelValue:l.dialogPagos,"onUpdate:modelValue":s[11]||(s[11]=o=>l.dialogPagos=o)},{default:r(()=>[a(C,{style:{width:"450px","max-width":"100vw"}},{default:r(()=>[a(h,{class:"row items-center q-px-md bg-primary text-white q-px-none"},{default:r(()=>[a(p,{flat:"",round:"",dense:"",icon:"fa-solid fa-arrow-left",onClick:s[4]||(s[4]=o=>l.dialogPagos=!1)}),a(w),n("div",Ge,i(l.pago.id?"Editar":"Nuevo")+" Pago ",1)]),_:1}),a(h,null,{default:r(()=>[a(he,{onSubmit:u.submitPago},{default:r(()=>[a(g,{modelValue:l.pago.fecha_pago,"onUpdate:modelValue":s[5]||(s[5]=o=>l.pago.fecha_pago=o),outlined:"",label:"Fecha de Pago",type:"date",rules:[o=>!!o||"Campo requerido"],dense:""},null,8,["modelValue","rules"]),a(g,{modelValue:l.pago.monto,"onUpdate:modelValue":s[6]||(s[6]=o=>l.pago.monto=o),outlined:"",label:"Monto",type:"number",rules:[o=>!!o||"Campo requerido"],dense:""},null,8,["modelValue","rules"]),a(ve,{modelValue:l.pago.forma_pago,"onUpdate:modelValue":s[7]||(s[7]=o=>l.pago.forma_pago=o),outlined:"",label:"Forma de Pago",dense:"",options:["EFECTIVO","TRANSFERENCIA","CHEQUE"],rules:[o=>!!o||"Campo requerido"]},null,8,["modelValue","rules"]),a(g,{modelValue:l.pago.numero_recibo,"onUpdate:modelValue":s[8]||(s[8]=o=>l.pago.numero_recibo=o),outlined:"",label:"N\xFAmero de Recibo",rules:[o=>!!o||"Campo requerido"],dense:""},null,8,["modelValue","rules"]),a(g,{modelValue:l.pago.banco,"onUpdate:modelValue":s[9]||(s[9]=o=>l.pago.banco=o),outlined:"",label:"Banco",dense:"",hint:""},null,8,["modelValue"]),a(g,{modelValue:l.pago.observacion,"onUpdate:modelValue":s[10]||(s[10]=o=>l.pago.observacion=o),outlined:"",label:"Observacion",dense:"",hint:""},null,8,["modelValue"]),a(p,{type:"submit",class:"full-width",label:l.pago.id?"Actualizar":"Agregar",color:l.pago.id?"primary":"green",loading:l.loading,"no-caps":""},null,8,["label","color","loading"])]),_:1},8,["onSubmit"])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64)}var ro=Ee(we,[["render",Le]]);export{ro as default};
